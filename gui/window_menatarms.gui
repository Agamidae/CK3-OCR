######################################################
################# MEN-AT-ARMS VIEW ###################
######################################################

window = {
	name = "menatarms_view"
	datacontext = "[MenAtArmsView.GetMaaGuiItem]"
	datacontext = "[MenAtArmsView.GetMaaGuiItem.GetRegiment]"
	datacontext = "[Regiment.GetMAAType]"
	using = TooltipFocus

	size = { 600 200 }
	parentanchor = top|right
	position = { -30 170 }
	movable = no
	layer = middle

	using = Window_Background_Subwindow

	state = {
		name = _show
		using = Animation_FadeIn_Quick
		position = { -30 170 }
		on_start = "[GetVariableSystem.Set( 'menatarms_open', 'true'  )]"
	}

	state = {
		name = _hide
		using = Animation_FadeOut_Quick
		position_x = -30
		on_start = "[GetVariableSystem.Clear( 'menatarms_open' )]"
	}

	vbox = {
		set_parent_size_to_minimum = yes
		margin = { 4 4 }
		margin_left = 10

		state = {
			name = "menatarms_refresh"
			alpha = 0.5
			duration = 0.2
			next = "b"
			using = Animation_Curve_Default
		}

		state = {
			name = "b"
			alpha = 1
			duration = 0.2
			using = Animation_Curve_Default
		}

		header_pattern = {
			layoutpolicy_horizontal = expanding

			blockoverride "header_text"
			{
			}

			blockoverride "button_close"
			{
				onclick = "[MenAtArmsView.Close]"
			}


			hbox = {
				layoutpolicy_horizontal = expanding

				text_single = {
					raw_text = "[Regiment.GetNameNoTooltip]"
				}

				text_single = {
					raw_text = ", [Regiment.BuildCurrentRegimentCountString],"
				}

				space = { }

				text_single = {
					text = "MAA_CURRENT_SIZE"
				}

				dot = { }

				expand = { }
			}
		}

		vbox = {
			layoutpolicy_horizontal = expanding
			margin = { 0 0 }
			min_width = 580

			vbox = {
				layoutpolicy_horizontal = expanding
				background = {
					name = "image"
					datacontext = "[Regiment.GetMAAType]"
					texture = "[MenAtArmsType.GetHorizontalImage]"
					fittype = centercrop
					alpha = 0.1

					using = Mask_Rough_Edges
				}

				vbox = {
					name = "soldiers"
					layoutpolicy_horizontal = expanding
					margin = { 5 0 }
					spacing = 3

					button_text_cant = {
						layoutpolicy_horizontal = expanding

						onclick = "[MenAtArmsView.BuyMaa]"
						enabled = "[MenAtArmsView.CanBuyMaa]"
						visible = "[NotEqualTo_int32( MAAItem.GetCurrentSize, MAAItem.GetMaxSize )]"
						shortcut = confirm
						blockoverride "disabled" {
							visible = "[Not(MenAtArmsView.CanBuyMaa)]"
						}
						blockoverride "text" {
							text = "MAA_INCREASE_SIZE_TOOLTIP"
						}
					}

					button_text_cant = {
						layoutpolicy_horizontal = expanding

						onclick = "[MenAtArmsView.SellMaa]"
						enabled = "[MenAtArmsView.CanSellMaa]"
						visible = "[GreaterThan_int32(MAAItem.GetCurrentSize, '(int32)1')]"
						blockoverride "disabled" {
							visible = "[Not(MenAtArmsView.CanSellMaa)]"
						}
						blockoverride "text" {
							text = "MAA_DECREASE_SIZE_TOOLTIP"
						}
					}

					text_single = {
						name = "max_size_text"
						layoutpolicy_horizontal = expanding
						visible = "[EqualTo_int32( MAAItem.GetCurrentSize, MAAItem.GetMaxSize )]"
						margin = { 10 6 }

						using = Background_Area

						text = "MAA_AT_MAX_SIZE"
					}
				}

				button_text = {
					layoutpolicy_horizontal = expanding
					onclick = "[MenAtArmsView.DestroyMAARegiment]"
					blockoverride "text" {
						margin_left = 5
						raw_text = "Destroy regiment."
					}
				}
			}

			### Soldiers
			hbox = {
				layoutpolicy_horizontal = expanding
				margin = { 15 10 }
				spacing = 3

				background = {
					using = Background_Area
					margin = { 5 5 }
				}
			}

			vbox = {
				layoutpolicy_horizontal = expanding
				margin = { 20 10 }
				spacing = 2

				### INFO TEXT
				hbox = {
					layoutpolicy_horizontal = expanding

					text_single = {
						visible = "[Not(Regiment.IsAtFullStength)]"
						text = "MAA_REINFORCING"
						align = left
					}

					text_single = {
						visible = "[And(Regiment.IsAtFullStength, Regiment.IsRaised)]"
						text = "MAA_RAISED"
						align = left
					}

					text_single = {
						visible = "[And(Regiment.IsAtFullStength, Not( Regiment.IsRaised ) )]"
						text = "MAA_UNRAISED"
						align = left
					}

					expand = { }
				}

				spacer = {
					size = { 10 2 }
				}

				hbox = {
					spacing = 10
					layoutpolicy_horizontal = expanding

					divider_light = {
						layoutpolicy_vertical = expanding
					}

					text_single = {
						layoutpolicy_horizontal = expanding
						visible = "[Not(Regiment.IsAtFullStength)]"
						text = "MAA_REINFORCEMENT"
						align = left|nobaseline
					}

					text_single = {
						layoutpolicy_horizontal = expanding
						visible = "[And(Regiment.IsAtFullStength, Regiment.IsRaised)]"
						text = "MAA_RAISED_MAINTENTANCE"
						align = left|nobaseline
					}

					text_single = {
						layoutpolicy_horizontal = expanding
						visible = "[And(Regiment.IsAtFullStength, Not( Regiment.IsRaised ) )]"
						text = "MAA_UNRAISED_MAINTENANCE"
						align = left|nobaseline
					}
				}

				spacer = {
					size = { 10 2 }
				}

				vbox = {
					layoutpolicy_horizontal = expanding

					text_single = {
						layoutpolicy_horizontal = expanding
						text = "MAA_REINFORCEMENT_COST_ENTRY"
					}

					text_single = {
						layoutpolicy_horizontal = expanding
						text = "MAA_MAINTENANCE"
					}
				}
			}

			divider_light = {
				layoutpolicy_horizontal = expanding
			}

			vbox = {
				layoutpolicy_horizontal = expanding
				spacing = 2

				vbox_maa_stats_numbers = {
					layoutpolicy_horizontal = expanding
				}

				hbox_maa_type_text = {
					layoutpolicy_horizontal = expanding
				}

				vbox_maa_info = {
					layoutpolicy_horizontal = expanding
				}

				hbox = {
					layoutpolicy_horizontal = expanding

					text_multi = {
						margin_left = 5
						margin_bottom = 5
						max_width = 550
						text = "[MenAtArmsType.GetFlavorString]"
						autoresize = yes
					}

					expand = { }
				}
			}
		}
	}
}

