######################################################
##################### MY REALM #######################
######################################################

window = {
	name = "my_realm_window"
	datacontext = "[GetVariableSystem]"
	datacontext = "[GetPlayer]"
	parentanchor = top|right
	allow_outside = yes
	movable = no
	layer = windows_layer

	using = Window_Size_MainTab

	state = {
		name = _show
		using = Animation_FadeIn_Quick
		using = Sound_WindowShow_Standard
		using = Window_Position_MainTab
	}

	state = {
		name = _hide
		using = Animation_FadeOut_Quick
		using = Sound_WindowHide_Standard
		using = Window_Position_MainTab_Hide
	}

	state = {
		name = dismiss
		next = _hide

		trigger_when = "[GetVariableSystem.Exists( 'hide_right_windows' )]"
	}


	margin_widget = {
		visible = "[Not(GetVariableSystem.Exists('ocr'))]"
		size = { 100% 100% }
		# margin = { 0 26 }
		margin_right = 13

		widget = {
			size = { 100% 100% }

			### WINDOW CONTENT
			vbox = {
				using = Window_Margins

				button_close = {
					onclick = "[MyRealmWindow.Close]"
					shortcut = close_window

				}

				vbox = {
					layoutpolicy_horizontal = expanding
					#margin_bottom = 5

					hbox = {
						layoutpolicy_horizontal = expanding
						# spacing = 20

						text_single = {
							text = "[GetPlayer.GetPrimaryTitle.GetNameNoTooltip|U]"
							tooltip = "[Character.GetDefaultRealmFlagTooltip]"
						}

						text_single = {
							raw_text = ","
						}
						space = { }

						text_single = {
							name = "realm_type"
							text = "MY_REALM_WINDOW_TYPE"
						}

						text_single = {
							raw_text = ","
						}
						space = { }

						text_single = {
							raw_text = "[GetPlayer.RealmSize] counties."
							tooltip = "REALM_WINDOW_SIZE_TT"
						}

						expand = { }
					}

					vbox = {
						layoutpolicy_horizontal = expanding
						# margin_top = 10

						hbox = {
							# visible = "[Not(GetVariableSystem.Exists('realm_tabs'))]"
							name = "crown_authority"
							datamodel = "[MyRealmWindow.GetRealmLaws]"
							ignoreinvisible = yes
							margin_top = 5

							layoutpolicy_horizontal = expanding
							# margin_left = 10

							item = {
								vbox = {
									layoutpolicy_vertical = expanding
									layoutpolicy_horizontal = expanding
									datacontext = "[GuiLawGroup.GetLawGroup]"
									visible = "[And( GuiLawGroup.GetLawGroup.HasFlag( 'realm_law' ), GuiLawGroup.IsAvailable )]"
									ignoreinvisible = yes
									spacing = 3

									button_text = {
										layoutpolicy_horizontal = expanding
										blockoverride "text" {
											raw_text = "[Select_CString(GetVariableSystem.Exists('crown_law'), 'Click to show', 'Showing')] [LawGroup.GetName].[Select_CString(GetVariableSystem.Exists('crown_law'), '', ' Click to hide.')]"
											alwaystransparent = yes
										}
										onclick = "[GetVariableSystem.Toggle('crown_law')]"
									}

									flowcontainer = {
										visible = "[Not(GetVariableSystem.Exists('crown_law'))]"
										layoutpolicy_horizontal = expanding
										direction = vertical
										datamodel = "[GuiLawGroup.GetLaws]"

										item = {
											button_text = {
												datacontext = "[GuiLaw.GetLaw]"
												blockoverride "pre" {
													text_single = {
														raw_text = "Switch to  "
														align = nobaseline
														visible = "[GuiLaw.CanEnact]"
													}
													text_single = {
														raw_text = "Current:  "
														align = nobaseline
														visible = "[GuiLaw.IsEnacted]"
													}
												}
												blockoverride "text" {
													raw_text = "[GuiLaw.GetLaw.GetNameNoTooltip]"
												}

												blockoverride "dot_nb" {
													# visible = "[GuiLaw.IsEnacted]"
												}
												enabled = "[GuiLaw.CanEnact]"
												onclick = "[GuiLaw.Enact]"

												blockoverride "disabled" {
													visible = "[And(Not(GuiLaw.CanEnact), Not(GuiLaw.IsEnacted))]"
													align = nobaseline
												}
												tooltipwidget = { pass_law_tooltip = { } }
											}
										}
									}
								}
							}
						}

						text_single = {
							layoutpolicy_horizontal = expanding
							datacontext = "[MyRealmWindow.GetCharacter.GetLiege]"
							visible = "[GetPlayer.HasLiege]"
							datacontext = "[Character.GetActiveLawInGroupWithFlag( 'realm_law' )]"
							raw_text = "Liege's authority: [Law.GetName]."
						}
					}
				}

				flowcontainer = {
					name = "vassals_succession_tabs"
					layoutpolicy_horizontal = expanding
					spacing = 2

					button_text = {
						# onclick = "[MyRealmWindow.ShowDomain]"
						onclick = "[GetVariableSystem.Clear('realm_tabs')]"
						blockoverride "extra" {
							text_single = {
								raw_text = " tab 1"
							}
							text_single = {
								raw_text = ", selected"
								visible = "[Not(GetVariableSystem.Exists('realm_tabs'))]"
							}
							dot = { }
						}
					    blockoverride "text" {
					        text = "MY_REALM_WINDOW_DOMAIN_TAB"
							align = left
					    }
						shortcut = speed_1
					}

					button_text = {
						# onclick = "[MyRealmWindow.ShowVassals]"
						onclick = "[GetVariableSystem.Set('realm_tabs', 'vassals')]"
						blockoverride "extra" {
							text_single = {
								raw_text = " tab 2"
							}
							text_single = {
								raw_text = ", selected"
								visible = "[GetVariableSystem.HasValue('realm_tabs', 'vassals')]"
							}
							dot = { }
						}
					    blockoverride "text" {
					        text = "MY_REALM_WINDOW_VASSALS_TAB"
							align = left
					    }
						shortcut = speed_2
					}

					button_text = {
						# onclick = "[MyRealmWindow.ShowSuccession]"
						onclick = "[GetVariableSystem.Set('realm_tabs', 'succession')]"
						blockoverride "extra" {
							text_single = {
								raw_text = " tab 3"
							}
							text_single = {
								raw_text = ", selected"
								visible = "[GetVariableSystem.HasValue('realm_tabs', 'succession')]"
							}
							dot = { }
						}
					    blockoverride "text" {
					        text = "MY_REALM_WINDOW_SUCCESSION_TAB"
							align = left
					    }
						shortcut = speed_3
					}
				}

				### DOMAIN TAB
				vbox = {
					name = "tab_domain"
					layoutpolicy_horizontal = expanding
					layoutpolicy_vertical = expanding
					visible = "[Not(GetVariableSystem.Exists('realm_tabs'))]"

					using = Animation_Tab_Switch

					button_text = {
						layoutpolicy_horizontal = expanding
					    blockoverride "text" {
					        raw_text = "[Select_CString(GetVariableSystem.Exists('county_focus'), 'Show all', 'Show only counties')]."
					    }
						onclick = "[GetVariableSystem.Toggle('county_focus')]"
					}

					scrollbox = {
						layoutpolicy_horizontal = expanding
						layoutpolicy_vertical = expanding

						blockoverride "scrollbox_content" {
							vbox = {
								datamodel = "[MyRealmWindow.GetDomainItems]"
								layoutpolicy_horizontal = expanding

								item = {
									vbox = {
										layoutpolicy_horizontal = expanding
										name = "duchy_group"

										button_text = {
											layoutpolicy_horizontal = expanding
										    blockoverride "text" {
										        raw_text = "[DuchyGroup.GetDuchy.GetNameNoTooltip],"
										    }
											blockoverride "extra" {
												text_single = {
													raw_text = " [GetDataModelSize(DuchyGroup.GetCounties)] counties."
													align = nobaseline
												}
											}
											datacontext = "[DuchyGroup.GetDuchy]"
											using = title_click
										}

										vbox = {
											name = "county_group"
											datamodel = "[DuchyGroup.GetCounties]"
											layoutpolicy_horizontal = expanding

											item = {
												vbox = {
													layoutpolicy_horizontal = expanding
													datacontext = "[CountyGroup.GetCounty]"
													datacontext = "[CountyGroup.GetCapitalProvince.GetCounty]"

													hbox = {
														layoutpolicy_horizontal = expanding
														spacing = 5

														button_text = {
														    blockoverride "text" {
														        raw_text = "[Title.GetNameNoTooltip]."
																align = left
														    }
															using = title_click
														}

														flowcontainer = {
															text_single = {
																name = "development"
																text = "MY_REALM_WINDOW_DEVELOPMENT"
																tooltip = "COUNTY_DEVELOPMENT_TOOLTIP"
															}

															text_single = {
																raw_text = ","
															}
														}

														text_single = {
															raw_text = "Opinion [GuiScope.SetRoot( County.GetTitle.MakeScope ).ScriptValue('county_opinion_val')|0+],"
															# tooltip = "COUNTY_OPINION_TOOLTIP_REALM" #TODO
														}

														text_single = {
															name = "tutorial_highlight_control"
															raw_text = "[CountyGroup.GetCountyControlColored]."
															tooltip = "MY_REALM_WINDOW_CONTROL_TOOLTIP"
														}

														expand = { }
													}

													hbox = {
													    layoutpolicy_horizontal = expanding
														margin_left = 5
													    spacing = 5

														text_single = {
															raw_text = "[County.GetFaith.GetAdjective], "
														}

														text_single = {
															raw_text = "[County.GetCulture.GetNameNoTooltip]."
														}

													    expand = { }
													}

													vbox = {
														visible = "[Not(GetVariableSystem.Exists('county_focus'))]"
														datamodel = "[CountyGroup.GetHoldings]"
														layoutpolicy_horizontal = expanding


														item = {
															vbox = {
																layoutpolicy_horizontal = expanding
																datacontext = "[HoldingItem.GetHolding]"

																hbox = {
																    layoutpolicy_horizontal = expanding
																	spacing = 3
																	button_text = {
																		blockoverride "text" {
																			text = "MY_REALM_WINDOW_HOLDING_NAME"
																			align = left
																		}
																		blockoverride "extra" {
																			text_single = {
																				raw_text = ", Realm capital"
																				visible = "[HoldingItem.IsRealmCapital]"
																				tooltip = "REALM_CAPITAL_TOOLTIP"
																			}
																			dot = { }
																		}
																		onclick = "[HoldingItem.OnClick]"
																		# onclick = "[MyRealmWindow.Close]" #TODO
																	}

																	hbox = {
																		layoutpolicy_horizontal = expanding
																		spacing = 3
																		text_single = {
																			raw_text = "Tax [Holding.GetIncome|1V], "
																			tooltip = "[Holding.GetTaxTooltip]"
																		}

																		text_single = {
																			raw_text = "Levies [Holding.GetMaxLevySize|0]."
																			tooltip = "[Holding.GetLeviesTooltip]"
																		}

																		text_single = {
																			visible = "[LessThan_float(Holding.GetUnraisedLevyRatioPercent, '(float)1')]"
																			raw_text = "[Holding.GetUnraisedLevyRatioPercent|0]% of total"
																		}

																		expand = { }
																	}

																    expand = { }
																}

																hbox = {
																    layoutpolicy_horizontal = expanding
																	spacing = 5
																	text_single = {
																		raw_text = "Can construct,"
																		visible = "[HoldingItem.GetHolding.CanConstructAnyBuilding(GetPlayer)]"
																	}
																	text_single = {
																		raw_text = "Empty slots [GuiScope.SetRoot(HoldingItem.GetHolding.GetProvince.MakeScope).ScriptValue('free_building_slots_sval')],"
																	}

																	text_single = {
																		raw_text = "Buildings [GuiScope.SetRoot(HoldingItem.GetHolding.GetProvince.MakeScope).ScriptValue('num_buildings_sval')]."
																	}

																	hbox = {
																		spacing = 3
																		tooltip = "MY_REALM_WINDOW_BUILDING_CONSTRUCTION_TT"

																		text_single = {
																			raw_text = "[HoldingItem.GetStatusText]."
																		}

																		text_single = {
																			raw_text = "[HoldingItem.GetHolding.GetConstructionProgress|%0]."
																		}
																		visible = "[HoldingItem.GetHolding.IsConstructionInProgress]"
																	}

																    expand = { }
																}
															}
														}
													}

													vbox = {
														layoutpolicy_horizontal = expanding
														visible = "[Not(GetVariableSystem.Exists('county_focus'))]"

														flowcontainer = {
															visible = "[DataModelHasItems(CountyGroup.GetEmptyHoldings)]"
															datamodel = "[CountyGroup.GetEmptyHoldings]"
															layoutpolicy_horizontal = expanding
															spacing = 3

															text_single = {
																raw_text = "[GetDataModelSize(CountyGroup.GetEmptyHoldings)] empty holdings"
															}

															item = {
																button_text = {
																	blockoverride "text" {
																		margin_left = -3
																		raw_text = "[HoldingItem.GetBarony.GetNameNoTierNoTooltip],"
																		visible = "[Not(Or(HoldingItem.GetHolding.CanConstructAnyBuilding(GetPlayer), HoldingItem.GetHolding.IsConstructionInProgress))]"
																		align = left
																	}
																	blockoverride "extra" {
																		text_single = {
																			raw_text = "Build new."
																			visible = "[HoldingItem.GetHolding.CanConstructAnyBuilding(GetPlayer)]"
																		}
																		text_single = {
																			visible = "[HoldingItem.GetHolding.IsConstructionInProgress]"
																			raw_text = "Building, [HoldingItem.GetHolding.GetConstructionProgress|%0]."
																		}
																	}
																	datacontext = "[HoldingItem.GetHolding]"
																	onclick = "[HoldingItem.OnClick]"
																}
															}
														}
													}

													expand = { }
												}
											}
										}
									}
								}
							}
						}
					}
				}

				### VASSALS TAB
				vbox = {
					name = "tab_vassals"
					layoutpolicy_horizontal = expanding
					layoutpolicy_vertical = expanding
					visible = "[GetVariableSystem.HasValue('realm_tabs', 'vassals')]"

					state = {
						name = _show
						using = Animation_FadeIn_Quick
					}

					state = {
						name = _hide
						alpha = 0
					}

					hbox = {
						name = "government_filters_container"
						margin = { 0 7 }
						layoutpolicy_horizontal = expanding

						hbox = {
							name = "government_filters"
							datamodel = "[MyRealmWindow.GetGovernmentTypeHeaders]"
							spacing = 5

							button_text = {
							    blockoverride "text" {
									text = "MRW_GOVERNMENT_FILTER_ALL"
							    }
								blockoverride "extra" {
									text_single = {
										raw_text = ", selected"
										align = nobaseline
										visible = "[Not(MyRealmWindow.HasGovernmentTypeFilter)]"
									}
								}
								blockoverride "dot_nb" { }
								onclick = "[MyRealmWindow.ResetGovernmentTypeFilter]"
							}
							item = {
								button_text = {
								    blockoverride "text" {
										text = "MRW_GOVERNMENT_FILTER"
								    }
									blockoverride "extra" {
										text_single = {
											raw_text = ", selected"
											align = nobaseline
											visible = "[GovernmentTypeHeader.IsSelected]"
										}
									}
									blockoverride "dot_nb" { }
									onclick = "[GovernmentTypeHeader.OnClick]"
									datacontext = "[GovernmentTypeHeader.GetGovernmentType]"
								}
							}
						}

						expand = { }
					}

					text_single = {
						visible = "[MyRealmWindow.HasGovernmentTypeFilter]"
						margin_top = 5
						margin_bottom = 10

						text = "[MyRealmWindow.GetGovernmentTypeFilter.GetVassalsLabel]"
					}

					scrollbox = {
						layoutpolicy_horizontal = expanding
						layoutpolicy_vertical = expanding

						blockoverride "scrollbox_margins" {
							margin = { 5 5 }
							margin_top = 20
						}

						blockoverride "scrollbox_content"
						{
							visible = "[GreaterThan_int32( MyRealmWindow.GetVassalCount, '(int32)0' )]"

							fixedgridbox = {
								layoutpolicy_horizontal = expanding
								datacontext = "[MyRealmWindow.GetPowerfulVassals]"
								datamodel = "[CharacterSelectionList.GetList]"
								visible = "[Not(CharacterSelectionList.IsBuildingList)]"
								addcolumn = 545
								addrow = 115
								setitemsizefromcell = yes

								item = {
									widget_vassal_list_item = {
										datacontext = "[CharacterListItem.GetCharacter]"
										datacontext = "[MyRealmWindow.GetVassalInfo( Character.Self )]"
										datacontext = "[MyRealmWindowVassalItem.GetContract]"

										blockoverride "vassal_portrait"
										{
											portrait_shoulders = { }
										}
									}
								}
							}

							fixedgridbox = {
								layoutpolicy_horizontal = expanding
								datacontext = "[MyRealmWindow.GetRegularVassals]"
								datamodel = "[CharacterSelectionList.GetList]"
								visible = "[Not(CharacterSelectionList.IsBuildingList)]"
								addcolumn = 545
								addrow = 115
								setitemsizefromcell = yes

								item = {
									widget_vassal_list_item = {
										datacontext = "[CharacterListItem.GetCharacter]"
										datacontext = "[MyRealmWindow.GetVassalInfo( Character.Self )]"
										datacontext = "[MyRealmWindowVassalItem.GetContract]"
									}
								}
							}
							expand = { }
						}

						vbox = {
							visible = "[EqualTo_int32( MyRealmWindow.GetVassalCount, '(int32)0' )]"
							text_single = {
								text = "NO_VASSALS_TO_DISPLAY"
								default_format = "#weak"
							}
						}
					}

					vbox = {
						layoutpolicy_horizontal = expanding
						margin = { 15 0 }
						# margin_top = 15
						# margin_bottom = 15

						vbox = {
							layoutpolicy_horizontal = expanding
							# margin = { 0 5 }

							background = {
								using = Background_Area
								margin = { -20 0 }
								margin_bottom = 10
								margin_top = 3
							}

							hbox = {
								layoutpolicy_horizontal = expanding

								text_single = {
									default_format = "#high"
									text = "MY_REALM_WINDOW_VASSAL_OPINION"
									tooltip = "MY_REALM_WINDOW_VASSAL_OPINION_TT"
								}

								text_single = {
									raw_text = ",  "
								}

								hbox = {

									tooltip = "[GetPlayer.GetDreadBreakdown]"

									text_single = {
										name = "dread_name"
										text = "[dread|E]: [GetPlayer.GetDread|0]"
										default_format = "#high"
									}
								}

								text_single = {
									raw_text = ",  "
								}

								hbox = {
									spacing = 2
									tooltip = "[Character.GetVassalLimitTooltip]"
									name = "tutorial_highlight_vassal_limit"

									background = {
										visible = "[GreaterThan_int32( Character.GetNumVassalsTowardsLimit, Character.GetVassalLimit )]"
										using = Status_Bad
									}

									text_single = {
										text = "MY_REALM_WINDOW_VASSAL_LIMIT"
									}

									text_single = {
										text = "MY_REALM_WINDOW_VASSAL_LIMIT_VALUE"
									}
								}

								text_single = {
									raw_text = "."
								}
								expand = { }
							}
						}
					}
				}

				### SUCCESSION TAB
				vbox = {
					name = "tab_succession"
					visible = "[GetVariableSystem.HasValue('realm_tabs', 'succession')]"

					layoutpolicy_horizontal = expanding
					layoutpolicy_vertical = expanding

					state = {
						name = _show
						using = Animation_FadeIn_Quick
					}

					state = {
						name = _hide
						alpha = 0
					}

					vbox = {
						layoutpolicy_horizontal = expanding

						vbox = {
							datamodel = "[MyRealmWindow.GetRealmLaws]"
							ignoreinvisible = yes
							layoutpolicy_horizontal = expanding

							item = {
								vbox = {
									visible = "[And( Not( GuiLawGroup.GetLawGroup.HasFlag( 'realm_law' ) ), GuiLawGroup.IsAvailable )]"
									layoutpolicy_horizontal = growing

									hbox = {
										layoutpolicy_horizontal = expanding
										spacing = 3

										button_text = {
											onclick = "[OpenSuccessionLawChangeWindow(GuiLawGroup.Self)]"
											blockoverride "text" {
												text = "MRW_CHANGE_LAW"
												margin_top = 4
											}
											# tooltip = "MRW_CHANGE_LAW_TT"
											datacontext = "[GuiLawGroup]"
										}

										text_single = {
											raw_text = "[GuiLawGroup.GetLawGroup.GetNameSingular]:"
										}

										text_single = {
											raw_text = "[GuiLawGroup.GetCurrentLevel.GetLaw.GetName]."
										}

										expand = { }

									}

									text_single = {
										layoutpolicy_horizontal = expanding
										visible = "[GuiLawGroup.GetCurrentLevel.GetLaw.HasSubName]"
										raw_text = "[GuiLawGroup.GetCurrentLevel.GetLaw.GetSubName]."
									}
								}
							}
						}

						hbox = {
							layoutpolicy_horizontal = growing

							hbox = {
								layoutpolicy_horizontal = expanding
								spacing = 3


								button_text_cant = {
									blockoverride "text" {
										text = "MY_REALM_WINDOW_DESIGNATE_HEIR"
										margin_top = 3
									}
									blockoverride "disabled" {
										margin_top = 3
										visible = "[Not(MyRealmWindow.CanDesignateHeir)]"
									}
									tooltip = "MRW_DESIGNATE_HEIR_TT"
									enabled = "[MyRealmWindow.CanDesignateHeir]"
									onclick = "[OpenDesignateHeirWindow]"
								}

								text_single = {
									max_width = 350
									text = "MRW_DESIGNATED_HEIR_LABEL"
								}

								text_single = {
									visible = "[MyRealmWindow.GetCharacter.GetDesignatedHeir.IsValid]"
									text = "MRW_DESIGNATED_HEIR"
									max_width = 350
								}
								hbox = {
									text_single = {
										visible = "[Not(MyRealmWindow.GetCharacter.GetDesignatedHeir.IsValid)]"
										text = "MRW_NO_DESIGNATED_HEIR"
										max_width = 350
									}
									dot = { }
								}
								expand = { }
							}
						}
					}

					scrollbox = {
						name = "succession_scrollbox"
						layoutpolicy_horizontal = expanding
						layoutpolicy_vertical = expanding
						minimumsize = { 0 350 }
						blockoverride "scrollbox_margins" {
							margin_top = 20
							margin_left = 5
						}

						blockoverride "scrollbox_content"
						{
							hbox = {
								name = "current_heir"
								layoutpolicy_horizontal = expanding

								background = {
									using =  Background_Area_Dark
									alpha = 0.8

									modify_texture = {
										texture = "gfx/interface/component_masks/mask_fade_horizontal.dds"
										blend_mode = alphamultiply
										mirror = horizontal
									}
								}

								vbox = {
									layoutpolicy_vertical = expanding
									layoutpolicy_horizontal = expanding

									vbox = {
										layoutpolicy_horizontal = expanding

										text_single = {
											visible = "[MyRealmWindow.HasHeir]"
											layoutpolicy_horizontal = expanding

											raw_text = "[MyRealmWindow.GetCharacter.GetPlayerHeir.GetUINameNoTooltip]."
										}

										hbox = {
										    layoutpolicy_horizontal = expanding

											text_single = {
												visible = "[MyRealmWindow.HasHeir]"

												text = "MRW_YOUR_PLAYER_HEIR"
											}

											dot = { }

										    expand = { }
										}

									}

									vbox = {
										layoutpolicy_horizontal = expanding

										text_single = {
											name = "no_heir_warning"
											visible = "[Not( MyRealmWindow.HasHeir )]"
											layoutpolicy_horizontal = expanding
											text = "MY_REALM_WINDOW_NO_HEIR_FLAVOR"
										}

										text_single = {
											name = "not_primary_heir"
											visible = "[And( MyRealmWindow.HasHeir, Not( ObjectsEqual( MyRealmWindow.GetCharacter.GetPlayerHeir, MyRealmWindow.GetCharacter.GetPrimaryTitle.GetHeir.Self ) ) )]"
											layoutpolicy_horizontal = expanding
											text = "MY_REALM_WINDOW_NOT_PRIMARY_HEIR"
										}
									}

									expand = { }
								}
							}

							##### FROM REALM'S PARTITION #####
							vbox = {
								layoutpolicy_horizontal = expanding

								vbox = {
									name = "their_partition_share"
									visible = "[And(MyRealmWindow.HasPartition, DataModelHasItems(MyRealmWindow.GetMyPartitionShare))]"
									layoutpolicy_horizontal = expanding
									margin_left = 5

									hbox = {
										layoutpolicy_horizontal = expanding

										text_single = {
											raw_text = "You will inherit,  "
										}

										text_single = {
											# layoutpolicy_horizontal = expanding
											text = "MY_REALM_WINDOW_PARTITION_SHARE"
										}

										dot = { }

										expand = { }
									}

									vbox = {
										name = "partition_share_box"
										datamodel = "[MyRealmWindow.GetMyPartitionShare]"
										layoutpolicy_horizontal = expanding
										# size = { 460 55 }
										# spacing = 10

										item = {
											button = {
												onclick = "[DefaultOnCoatOfArmsClick(TitleItem.GetTitle.GetID)]"
												onclick = "[DefaultOnCoatOfArmsRightClick(TitleItem.GetTitle.GetID)]"
												button_ignore = none
												layoutpolicy_horizontal = expanding

												text_single = {
													layoutpolicy_horizontal = expanding
													raw_text = "[TitleItem.GetTitle.GetNameNoTooltip]."
													resizeparent = yes
													margin_left = 5
												}
											}
										}
									}
								}

								spacer = {
									size = { 5 5 }
								}

								hbox = {
									layoutpolicy_horizontal = expanding
									visible = "[DataModelHasItems(MyRealmWindow.GetTitleSuccession)]"
									margin = { 5 0 }

									button_group = {
										onclick = "[GetVariableSystem.Toggle( 'expand_partition' )]"

										flowcontainer = {
											ignoreinvisible = yes

											text_single = {
												text = "MY_REALM_WINDOW_TITLES_LOST_ON_SUCCESSION"
												align = nobaseline
											}

											dot = { }
										}
									}

									expand = { }
								}

								spacer = {
									# visible = "[GetVariableSystem.Exists( 'expand_partition' )]"
									size = { 5 5 }
								}

								vbox = {
									name = "title_succession"
									datamodel = "[MyRealmWindow.GetTitleSuccession]"
									# visible = "[GetVariableSystem.Exists( 'expand_partition' )]"
									layoutpolicy_horizontal = expanding

									item = {
										hbox = {
											# maximumsize = { -1 100 }
											layoutpolicy_horizontal = expanding
											margin_left = 10
											margin_bottom = 5
											datacontext = "[TitleSuccessionItem.GetHeir]"

											background = {
												using = Background_Area_With_Header
											}

											vbox = {
												layoutpolicy_horizontal = expanding
												layoutpolicy_vertical = growing
												# margin_bottom = 5

												button = {
													onclick = "[DefaultOnCharacterClick(Character.GetID)]"
													onclick = "[DefaultOnCharacterClick(Character.GetID)]"
													# onclick = "[DefaultOnCoatOfArmsRightClick(Character.CapitalLocation.GetCoATitle.GetID)]"
													onrightclick = "[DefaultOnCharacterRightClick(Character.GetID)]"
													button_ignore = none
													layoutpolicy_horizontal = expanding

													text_single = {
														name = "heir_name"
														raw_text = "To [Character.GetUINameNoTooltip],"
														layoutpolicy_horizontal = expanding
														margin_left = 5
														resizeparent = yes
														# using = Font_Size_Medium
														# max_width = 400
														# fontsize_min = 14
													}
												}

												text_single = {
													name = "heir_not_your_dynasty"
													layoutpolicy_horizontal = expanding

													text = "MY_REALM_WINDOW_HEIR_NOT_MY_DYNASTY"
													visible = "[Not(ObjectsEqual(Character.GetHouse.GetDynasty.Self, GetPlayer.GetHouse.GetDynasty.Self))]"
													using = Font_Size_Small
												}

												vbox = {
													name = "titles_box"
													layoutpolicy_horizontal = expanding
													datamodel = "[TitleSuccessionItem.GetPartitionTitles]"
													visible = "[DataModelHasItems(TitleSuccessionItem.GetPartitionTitles)]"
													# minimumsize = { 350 50 }
													spacing = 0

													item = {
														hbox = {
															layoutpolicy_horizontal = expanding

															button = {
																onclick = "[DefaultOnCoatOfArmsClick(TitleItem.GetTitle.GetID)]"
																onclick = "[DefaultOnCoatOfArmsRightClick(TitleItem.GetTitle.GetID)]"
																button_ignore = none
																layoutpolicy_horizontal = expanding
																text_single = {
																	layoutpolicy_horizontal = expanding
																	raw_text = "[TitleItem.GetTitle.GetNameNoTooltip]."
																	resizeparent = yes
																	margin_left = 5
																}
															}

															# coa_title_tiny_crown = {
															# 	datacontext = "[TitleItem.GetTitle]"
															# 	using = tooltip_ne
															# }

															# icon = {
															# 	name = "has_laws"
															# 	visible = "[TitleItem.GetTitle.HasLaws]"
															# 	parentanchor = bottom|right
															# 	size = { 25 25 }
															# 	position = { 5 0 }
															# 	texture = "gfx/interface/icons/title_status/icon_title_law.dds"
															# }
														}
													}
												}

												text_single = {
													name = "exception_label"
													visible = "[DataModelHasItems(TitleSuccessionItem.GetExceptionTitles)]"
													layoutpolicy_horizontal = expanding

													text = "MY_REALM_WINDOW_EXCEPTIONS"
												}

												vbox = {
													layoutpolicy_horizontal = expanding
													name = "exception_box"
													datamodel = "[TitleSuccessionItem.GetExceptionTitles]"
													visible = "[DataModelHasItems(TitleSuccessionItem.GetExceptionTitles)]"
													# minimumsize = { 350 50 }
													# spacing = 10

													item = {
														button = {
															onclick = "[DefaultOnCoatOfArmsClick(TitleItem.GetTitle.GetID)]"
															onclick = "[DefaultOnCoatOfArmsRightClick(TitleItem.GetTitle.GetID)]"
															button_ignore = none
															layoutpolicy_horizontal = expanding

															text_single = {
																layoutpolicy_horizontal = expanding
																raw_text = "[TitleItem.GetTitle.GetNameNoTooltip]."
																resizeparent = yes
																margin_left = 5
															}
														}
													}
												}
											}

											# vbox = {
											# 	portrait_head = {
											# 		name = "primary_spouse_portrait"
											# 		blockoverride "portrait_button" {
											# 			using = tooltip_ws
											# 		}
											# 	}
											#
											# 	expand = { }
											# }
										}
									}
								}
							}

							vbox = {
								name = "exceptions"
								layoutpolicy_horizontal = expanding
								layoutpolicy_vertical = growing
								margin_left = 5

								visible = "[DataModelHasItems(MyRealmWindow.GetSuccessionExceptions)]"

								hbox = {
									layoutpolicy_horizontal = expanding

									text_label_left = {
										layoutpolicy_horizontal = expanding
										text = "MY_REALM_WINDOW_EXCEPTIONS"
									}

									expand = { }
								}

								vbox = {
									name = "exceptions_box"
									layoutpolicy_horizontal = expanding
									# size = { 460 55 }
									# spacing = 10

									datamodel = "[MyRealmWindow.GetSuccessionExceptions]"

									item = {
										button = {
											onclick = "[DefaultOnCoatOfArmsClick(TitleItem.GetTitle.GetID)]"
											onclick = "[DefaultOnCoatOfArmsRightClick(TitleItem.GetTitle.GetID)]"
											button_ignore = none
											layoutpolicy_horizontal = expanding

											text_single = {
												layoutpolicy_horizontal = expanding
												raw_text = "[TitleItem.GetTitle.GetNameNoTooltip]."
												resizeparent = yes
												margin_left = 5
											}
										}
									}
								}
							}

							vbox = {
								name = "line_of_succession"
								visible = "[MyRealmWindow.HasSingleHeir]"
								layoutpolicy_horizontal = expanding
								layoutpolicy_vertical = growing
								spacing = 10

								hbox = {
									layoutpolicy_horizontal = expanding

									text_label_left = {
										name = "line_of_succession_label"
										layoutpolicy_horizontal = expanding
										text = "MY_REALM_WINDOW_LINE_OF_SUCCESSION"
									}

									expand = { }
								}

								flowcontainer = {
									name = "line_of_succession_box"
									layoutpolicy_horizontal = expanding
									spacing = 0
									margin_right = 10

									datamodel = "[MyRealmWindow.GetLineOfSuccession]"

									item = {
										portrait_head = {
											name = "heir_portrait"
										}
									}
								}
							}

							#### ELECTIONS ####
							vbox = {
								layoutpolicy_horizontal = expanding
								visible = "[MyRealmWindow.CanVote]"
								margin_left = 5

								hbox = {
									layoutpolicy_horizontal = expanding

									text_label_left = {
										layoutpolicy_horizontal = expanding
										text = "MY_REALM_WINDOW_ELECTIONS"
									}

									expand = { }
								}

								flowcontainer = {
									name = "elections"
									direction = vertical

									fixedgridbox = {
										name = "exceptions_box"
										addcolumn = 600
										addrow = 42
										datamodel = "[MyRealmWindow.GetTitlesCanVote]"

										item = {
											widget = {
												name = "election_title"
												size = { 510 40 }
												datacontext = "[TitleItem.GetTitle]"

												hbox = {

													vbox = {
														layoutpolicy_horizontal = expanding
														button_text = {
															layoutpolicy_horizontal = expanding
															using = title_click
														    blockoverride "text" {
														       text = "[Title.GetNameNoTooltip]"
														    }
														}
														hbox = {
															layoutpolicy_horizontal = expanding

															button_text = {
																layoutpolicy_horizontal = expanding
															    blockoverride "text" {
																	text = "MY_REALM_WINDOW_VOTE"
															    }
																onclick = "[OpenSuccessionElectionWindowForTitle(Title.Self)]"
															}

															expand = { }
														}
													}

													expand = { }
												}
											}
										}
									}
								}
							}

							expand = {
								layoutpolicy_vertical = expanding
							}
						}
					}
				}

				vbox = {
					visible = "[Or( Not(GetVariableSystem.Exists('realm_tabs')), GetVariableSystem.HasValue('realm_tabs', 'vassals'))]"
					layoutpolicy_horizontal = expanding
					# margin_bottom = 15
					spacing = 8

					hbox = {
						margin = { 10 0 }
						visible = "[Not(GetVariableSystem.Exists('realm_tabs'))]"
						tooltip = "[GetPlayer.GetDomainLimitTooltip]"
						spacing = 2
						layoutpolicy_horizontal = expanding

						text_single = {
							text = "[SelectLocalization(MyRealmWindow.IsOverDomainLimit, 'MY_REALM_WINDOW_DOMAIN_LIMIT_WARNING', 'MY_REALM_WINDOW_DOMAIN_LIMIT')]"
						}

						text_single = {
							text = "[SelectLocalization(MyRealmWindow.IsOverDomainLimit, 'MY_REALM_WINDOW_DOMAIN_LIMIT_VALUE_WARNING', 'MY_REALM_WINDOW_DOMAIN_LIMIT_VALUE')]"
						}
						dot = { }
						expand = { }
					}

					vbox = {
						layoutpolicy_horizontal = expanding
						margin = { 10 0 }

						background = {
							using = Background_Area
							margin = { -65 0 }
							margin_bottom = 8
							margin_top = 3
						}


						hbox = {
							name = "domain_income_row"
							layoutpolicy_horizontal = expanding

							# background = {
							# 	visible = "[Not(GetVariableSystem.Exists('realm_tabs'))]"
							# 	using = Status_Highlight
							# }
							spacing = 5

							flowcontainer = {

								text_single = {
									# layoutpolicy_horizontal = expanding
									text = "MY_REALM_WINDOW_FROM_HOLDINGS"
								}


								text_single = {
									raw_text = ", Over the limit!"
									visible = "[MyRealmWindow.IsOverDomainLimit]"
									tooltip = "[Character.GetDomainLimitTooltip]"
								}
							}

							text_single = {
								datacontext = "[MyRealmWindow.GetDomainIncome]"
								raw_text = "[ValueBreakdown.GetValue] gold,"
								# min_width = 100
								# max_width = 100
								# align = right

								tooltipwidget = {
									widget_gold_breakdown_tooltip = {
										blockoverride "income"
										{
											visible = no
										}
									}
								}
							}

							text_single = {
								datacontext = "[MyRealmWindow.GetDomainLevy]"
								raw_text = "[ValueBreakdown.GetValue] levies."
								# minimumsize = { 100 0 }
								# align = right
								tooltipwidget = {
									widget_gold_breakdown_tooltip = {
										blockoverride "income"
										{
											visible = no
										}
									}
								}
							}

							expand = { }
						}

						hbox = {
							name = "vassals_income_row"
							layoutpolicy_horizontal = expanding

							# background = {
							# 	visible = "[GetVariableSystem.HasValue('realm_tabs', 'vassals')]"
							# 	using = Status_Highlight
							# }
							spacing = 5

							flowcontainer = {

								text_single = {
									# layoutpolicy_horizontal = expanding
									text = "MY_REALM_WINDOW_FROM_VASSALS"
									# align = bottom
								}

								text_single = {
									raw_text = ", Over the limit!"
									visible = "[GreaterThan_int32( Character.GetNumVassalsTowardsLimit, Character.GetVassalLimit )]"
									tooltip = "[Character.GetVassalLimitTooltip]"
								}
							}

							text_single = {
								datacontext = "[MyRealmWindow.GetVassalsIncome]"
								raw_text = "[ValueBreakdown.GetValue] gold,"

								tooltipwidget = {
									widget_gold_breakdown_tooltip = {
										blockoverride "income"
										{
											visible = no
										}
									}
								}
							}

							text_single = {
								datacontext = "[MyRealmWindow.GetVassalsLevy]"
								raw_text = "[ValueBreakdown.GetValue] levies."

								tooltipwidget = {
									widget_gold_breakdown_tooltip = {
										blockoverride "income"
										{
											visible = no
										}
									}
								}
							}

							expand = { }
						}

						hbox = {
							layoutpolicy_horizontal = expanding
							visible = "[GetPlayer.HasLiege]"
							spacing = 5

							text_single = {
								# layoutpolicy_horizontal = expanding
								text = "MY_REALM_WINDOW_FROM_TO_LIEGE"
							}

							text_single = {
								datacontext = "[MyRealmWindow.GetIncomeTax]"
								raw_text = "[ValueBreakdown.GetValue] gold,"
								# min_width = 100
								# max_width = 100
								# align = right

								tooltipwidget = {
									my_realm_window_contribution_tooltip = {
										datacontext = "[MyRealmWindow.GetCharacter]"
										blockoverride "contribution_tooltip_header"
										{
											text = "MRW_TT_TAXES_TO_MY_LIEGE"
										}
										blockoverride "contribution_tooltip_content_suffix" { }
									}
								}
							}

							text_single = {
								datacontext = "[MyRealmWindow.GetLevyTax]"
								raw_text = "[ValueBreakdown.GetValue] levies."
								# min_width = 100
								# max_width = 100
								# align = right

								tooltipwidget = {
									my_realm_window_contribution_tooltip = {
										datacontext = "[MyRealmWindow.GetCharacter]"
										blockoverride "contribution_tooltip_header"
										{
											text = "MRW_TT_LEVIES_TO_MY_LIEGE"
										}
										blockoverride "contribution_tooltip_content_suffix" { }
									}
								}
							}

							expand = { }
						}

						hbox = {
							name = "vassal_contract"
							datacontext = "[MyRealmWindow.GetCharacter.GetLiege]"
							datacontext = "[MyRealmWindow.GetCharacter.GetVassalContract]"
							visible = "[Character.IsPlayerInteractionShown('vassal_modify_vassal_contract_interaction')]"
							margin_left = 3
							spacing = 10

							button_replace = {
								enabled = "[Character.IsPlayerInteractionValid('vassal_modify_vassal_contract_interaction')]"
								onclick = "[Character.OpenPlayerInteraction('vassal_modify_vassal_contract_interaction')]"
								tooltip = "[Character.GetPlayerInteractionTooltip('vassal_modify_vassal_contract_interaction')]"
							}

							text_single = {
								visible = "[VassalContract.UsesObligationLevels]"
								layoutpolicy_horizontal = expanding
								align = center
								text = "MY_REALM_WINDOW_MY_OBLIGATIONS"
							}

							vassal_contract_not_default_icon = { }
						}
					}
				}
			}
		}
	}

	window_realm_old = {
		visible = "[GetVariableSystem.Exists('ocr')]"
	}
}

######################################################
################ TYPES AND TEMPLATES #################
######################################################

types MyRealmWindow
{
	type my_realm_window_contribution_tooltip = container {
		alwaystransparent = no
		widget = {
			name = "background"
			using = Background_Tooltip
			size = { 100% 100% }
			alwaystransparent = no
		}

		flowcontainer = {
			margin = { 10 0 }
			margin_top = 10
			spacing = 15
			direction = vertical
			ignoreinvisible = yes

			text_single = {
				margin = { 5 0 }
				block "contribution_tooltip_header" { }
			}

			widget_gold_breakdown_tooltip = {
				layoutpolicy_horizontal = expanding
				blockoverride "income"
				{
					visible = no
				}

				blockoverride "background" { }
			}

			block "contribution_tooltip_content_suffix" {
				text_single = {
					multiline = yes
					maximumsize = { 250 -1 }
					text = "MY_REALM_WINDOW_CONTRIBUTION_TO_THEOCRATIC_LIEGE"
					visible = "[Character.IsTheocraticLessee]"
				}
			}

			flowcontainer = {
				spacing = 15
				direction = vertical
				ignoreinvisible = yes
				block "tax_info_visible" { }
				block "tax_info" { }
			}

			flowcontainer = {
				spacing = 15
				direction = vertical
				ignoreinvisible = yes
				block "levy_info_visible" { }
				block "levy_info" { }
			}
		}
	}

	type vassal_contract_not_default_icon = icon
	{
		texture = "gfx/interface/icons/icon_contract_modification.dds"
		framesize = { 60 60 }
		frame = 1
		name = "vassal_contract_not_default"
		size = { 25 25 }
		visible = "[Not( VassalContract.IsContractDefault )]"
		tooltip = "VASSAL_CONTRACT_NOT_DEFAULT"
	}
}
