######################################################
################### COUNTY VIEW ######################
######################################################

window = {
	name = "holding_view"
	widgetid = "holding_view"
	parentanchor = bottom|left
	allow_outside = yes
	movable = no
	layer = windows_layer
	maximumsize = { 700 -1 }
	scissor = yes
	size = { 700 100% }
	datacontext = "[HoldingView.GetProvince]"
	datacontext = "[HoldingView.GetHolding]"
	datacontext = "[HoldingView.GetHolder]"
	datacontext = "[Province.GetCounty]"

	state = {
		name = pan_to_previous_county
		delay = 0.1
		on_start = "[HoldingView.PanToCountyCapital]"
		on_finish = "[PdxGuiTriggerAllAnimations('adjacent_counties')]"
		on_start = "[GetVariableSystem.Clear( 'window_ruins_confirm' )]"
	}

	state = {
		name = _show
		on_start = "[HoldingView.PanToCountyCapital]"
		on_start = "[GetVariableSystem.Set( 'county_view_open', 'true' )]"
		on_start = "[GetVariableSystem.Set( 'hide_bottom_left_HUD', 'true' )]"
		on_finish = "[PdxGuiTriggerAllAnimations('adjacent_counties')]"
		on_start = "[GetVariableSystem.Clear( 'window_ruins_confirm' )]"

		# on_start = "[GetScriptedGui('county_controller').Execute( GuiScope.SetRoot( HoldingView.GetProvince.MakeScope ).End )]"

		using = Animation_FadeIn_Standard
		using = Sound_WindowShow_Standard
		using = Animation_FadeIn_BottomLeft
	}

	state = {
		name = adjacent_counties
		trigger_on_create = yes
		on_finish = "[Click('reset_lootable_sort')]"
		on_finish = "[GetScriptedGui('province_adjacencies').Execute( GuiScope.SetRoot( Province.MakeScope ).AddScope( 'player', GetPlayer.MakeScope).End )]"
		on_finish = "[PdxGuiTriggerAllAnimations('adjacent_counties_land')]"
	}

	state = {
		name = _hide
		on_start = "[GetVariableSystem.Clear( 'county_view_open' )]"
		on_start = "[GetVariableSystem.Clear( 'hide_bottom_left_HUD' )]"
		on_finish = "[Clear('county_tabs')]"
		on_finish = "[Clear('holding_tabs')]"
		on_finish = "[ClickAdd('last_view', GetPlayer, Province)]"
		on_finish = "[Clear('hide_grant_titles')]"

		using = Animation_FadeOut_Standard
		using = Sound_WindowHide_Standard
		using = Animation_FadeOut_BottomLeft
	}

	widget = {
		size = { 0 0 }
		scissor = yes

		buttons_window_control = {
			blockoverride "button_go_to" {
				onclick = "[HoldingView.PanToCountyCapital]"
			}

			blockoverride "button_back" {
				visible = "[HasViewHistory]"
				onclick = "[OpenFromViewHistory]"
				onclick = "[PdxGuiTriggerAllAnimations('pan_to_previous_county')]"
			}
			blockoverride "button_close" {
				onclick = "[HoldingView.Close]"
			}
		}
	}

	vbox = {
		layoutpolicy_vertical = expanding
		name = "window_content"
		using = ocr_margins
		using = ocr
		background = { using = Background_Area_Border_Solid }

		# button_text = {
		# 	layoutpolicy_horizontal = expanding
		# 	datacontext = "[GetPlayer.GetCapitalLocation]"
		# 	blockoverride "text" {
		# 		raw_text = "Capital"
		# 	}
		# 	onclick = "[OpenGameViewData('holding_view', Province.Self )]"
		# }

		error_button = {
			layoutpolicy_horizontal = expanding
		}

		# text_single = {
		# 	raw_text = "[Province.MakeScope.ScriptValue('county_control')] control"
		# }

		# debug
		# text_single = {
		# 	layoutpolicy_horizontal = expanding
		# 	raw_text = "Barony controller: [HoldingView.GetProvince.GetController.GetNameOrMeNoTooltip]"
		# }
		#
		# text_single = {
		# 	layoutpolicy_horizontal = expanding
		# 	raw_text = "Safe"
		#
		# 	visible = "[GetScriptedGui('safe_county').IsValid( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('target', HoldingView.GetProvince.MakeScope).End )]"
		# }
		#
		# text_single = {
		# 	layoutpolicy_horizontal = expanding
		# 	raw_text = "Hostile county!"
		# 	visible = "[GetScriptedGui('is_hostile_county').IsShown( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope( 'target', HoldingView.GetProvince.MakeScope ).End )]"
		# }
		#
		# text_multi = {
		# 	autoresize = yes
		# 	layoutpolicy_horizontal = expanding
		#
		# 	raw_text = "[GetScriptedGui('county_controller_test').BuildTooltip( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('target', HoldingView.GetProvince.MakeScope).End )]"
		# }
		vbox = {
			layoutpolicy_horizontal = expanding
			layoutpolicy_vertical = expanding
			visible = "[GetScriptedGui('is_land').IsShown( GuiScope.SetRoot( Province.MakeScope ).End )]"

			state = {
				name = "adjacent_counties_land"
				on_finish = "[GetScriptedGui('adjacent_counties').Execute( GuiScope.SetRoot( HoldingView.GetCountyTitle.MakeScope ).AddScope( 'player', GetPlayer.MakeScope).AddScope('target', HoldingView.GetProvince.MakeScope).End )]"
				on_finish = "[GetScriptedGui('county_holding_list').Execute( GuiScope.SetRoot( HoldingView.GetCountyTitle.MakeScope ).End )]"
				on_finish = "[GetScriptedGui('find_closest').Execute( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('target', HoldingView.GetProvince.MakeScope).End )]"
			}

			scrollbox = {
				layoutpolicy_horizontal = expanding
				layoutpolicy_vertical = expanding

				blockoverride "scrollbox_margins" {
					margin_top = 20

				}
				blockoverride "scrollbox_content" {
					#title
					vbox = {
						margin_left = 10
						# margin to avoid tooltips after selecting adjacent counties
						layoutpolicy_horizontal = expanding
						visible = "[Not(GetVariableSystem.Exists('county_tabs'))]"
						# spacing = 5

						## get controller, debug
						# button_text = {
						# 	datacontext = "[GetScriptedGui('county_controller')]"
						# 	onclick = "[ScriptedGui.Execute( GuiScope.SetRoot( HoldingView.GetProvince.MakeScope ).End )]"
						# 	layoutpolicy_horizontal = expanding
						# 	blockoverride "text" {
						# 		raw_text = "Controller: [HoldingView.GetProvince.MakeScope.Var('controller').GetCharacter.GetNameNoTooltip]"
						# 	}
						# }
						vbox = {
							layoutpolicy_horizontal = expanding

							button_text = {
								layoutpolicy_horizontal = expanding
								using = title_click
								datacontext = "[HoldingView.GetHolding.GetProvince.GetTitle]"
								blockoverride "pre" {
									text_single = {
										raw_text = "[HoldingView.GetProvince.GetTitle.GetNameNoTier],"
									}
									text_single = {
										raw_text = "[HoldingView.GetCountyTitle.GetNameNoTier],"
									}
									text_single = {
										raw_text = "held by [HoldingView.GetTopLiege.GetPrimaryTitle.GetNameNoTierNoTooltip]."
									}
									text_single = {
										margin_left = 3
										raw_text = "De jure"
									}
									text_single = {
										raw_text = "[HoldingView.GetCountyTitle.GetDeJureLiege.GetNameNoTierNoTooltip],"
									}
									text_single = {
										raw_text = "[HoldingView.GetCountyTitle.GetDeJureLiege.GetDeJureLiege.GetNameNoTierNoTooltip]."
									}

									text_single = {
										raw_text = "X Y:"
									}

									text_single = {
										raw_text = "[FixedPointToInt(Divide_CFixedPoint(County.GetCapital.MakeScope.Var('pos_x').GetValue, '(CFixedPoint)100'))|0],"
									}

									text_single = {
										raw_text = "[FixedPointToInt(Divide_CFixedPoint(County.GetCapital.MakeScope.Var('pos_y').GetValue, '(CFixedPoint)100'))|0]."
									}
								}
							}

							# holding
							hbox = {
								layoutpolicy_horizontal = expanding

								button_text = {
									using = title_click
									datacontext = "[HoldingView.GetHolding.GetProvince.GetTitle]"
									blockoverride "pre" {

										container = {
											ignoreinvisible = yes
											visible = "[ObjectsEqual(HoldingView.GetProvince, GetPlayer.GetCapitalLocation)]"

											text_single = {
												visible = "[Not( GetPlayer.IsLandlessRuler )]"
												raw_text = "Your Capital,"
											}
										}
										text_single = {
											raw_text = "Your"
											visible = "[And(And(HoldingView.GetTitle.GetLesseeOrHolder.IsLocalPlayer, Not( ObjectsEqual( HoldingView.GetProvince, GetPlayer.GetCapitalLocation ) ) ), Not(GetPlayer.IsLandlessRuler))]"
										}
										text_single = {
											raw_text = "Hostle"
											visible = "[GetScriptedGui('is_hostile_barony').IsShown( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope( 'target', Province.MakeScope ).End )]"
										}
										text_single = {
											raw_text = "border"
											visible = "[GetScriptedGui('is_border_province').IsShown( GuiScope.SetRoot( Province.MakeScope ).End )]"
										}
										text_single = {
											visible = "[HoldingView.GetHolding.IsEmpty]"
											raw_text = "[HoldingView.GetProvince.GetTerrain.GetNameNoTooltip] of"
										}
										text_single = {
											visible = "[Not(HoldingView.GetHolding.IsEmpty)]"
											raw_text = "[HoldingView.GetHolding.GetType.GetName] of"
										}
										text_single = {
											visible = "[Not(HoldingView.GetProvince.GetTitle.IsValid)]"
											raw_text = "[HoldingView.GetHolding.GetNameNoTooltip],"
										}
										text_single = {
											visible = "[HoldingView.GetProvince.GetTitle.IsValid]"
											raw_text = "[HoldingView.GetProvince.GetTitle.GetNameNoTier],"
										}

										button_text = {
											onclick = "[GetVariableSystem.Set('county_tabs', 'holding')]"
											visible = "[GetScriptedGui('is_province_infected').IsShown( GuiScope.SetRoot( Province.MakeScope ).End )]"
											blockoverride "text" {
												margin_left = -4
												margin_right = 2
												raw_text = "Infected!"
											}
										}

										# flowcontainer = {
										# 	name = "epidemics_here"
										# 	datamodel = "[HoldingView.GetHoldingStatuses]"
										# 	ignoreinvisible = yes
										#
										# 	item = {
										# 		container = {
										# 			visible = "[HoldingStatus.IsEpidemic]"
										# 			datacontext = "[HoldingStatus.GetEpidemic]"
										# 			ignoreinvisible = yes
										#
										# 			button_epidemic_ocr = {
										# 				blockoverride "epidemic" {
										# 					margin_left = -4
										# 					margin_right = 1
										# 					raw_text = "infected!"
										# 				}
										# 				onclick = "[ToggleGameView( 'epidemics' )]"
										#
										# 				blockoverride "extra_data"
										# 				{
										# 					spacer = { size = { 0 16 } }
										#
										# 					cooltip_paragraph = {
										# 						visible = "[EpidemicInfectionLevel.HasRealmModifier]"
										# 						text = "[EpidemicInfectionLevel.GetRealmModifierDesc]"
										# 					}
										# 					cooltip_paragraph = {
										# 						visible = "[Or( EpidemicInfectionLevel.HasProvinceModifier, EpidemicInfectionLevel.HasCountyModifier )]"
										# 						text = "EPIDEMIC_MODIFIERS_PROVINCE_AND_COUNTY"
										# 					}
										# 				}
										#
										# 				blockoverride "infection_chance_text"
										# 				{
										# 					text = "EPIDEMIC_TOOLTIP_CHANCE_OF_INFECTION_SPECIFIC_PROVINCE"
										# 				}
										#
										#
										# 				datacontext = "[Epidemic.GetInfectionLevelIn( HoldingView.GetProvince )]"
										# 			}
										# 		}
										# 	}
										# }
										text_single = {
											visible = "[Not(HoldingView.GetHolding.IsEmpty)]"
											raw_text = "[Province.GetTerrain.GetName],"
										}
										text_single = {
											datacontext = "[HoldingView.GetProvince]"
											visible = "[Not(ObjectsEqual(HoldingView.GetProvince, GetPlayer.GetCapitalLocation))]"
											raw_text = "[DistanceTo(MyCapital, Province)|0] [DaysTo(MyCapital, Province)] [Direction(MyCapital, Province)],"
										}
										button_shores = {
											blockoverride "and" {
												visible = "[DataModelHasItems(Province.MakeScope.GetList('adjacent_rivers'))]"
											}
										}
									}
								}

								hbox = {
									button_text = {
										datacontext = "[HoldingView.GetTitle]"
										datacontext = "[HoldingView.GetTitle.GetLesseeOrHolder]"
										visible = "[Or(And(And(Not(Character.IsLocalPlayer), Not(HoldingView.GetHolding.IsEmpty)), Not(ObjectsEqual(Character.Self, HoldingView.GetCountyTitle.GetHolder))), GetPlayer.IsLandlessRuler)]"
										using = char_click
										blockoverride "text" {
											margin_left = -3
											raw_text = "[Select_CString(Title.IsLeasedOut, 'leased by', 'held by')] [Character.GetFirstNameNoTooltip], i."
										}
									}
								}

								expand = { }
							}

							hbox = {
								layoutpolicy_horizontal = expanding
								spacing = 3

								flow_crossing_ocr = {
									visible = "[DataModelHasItems(Province.MakeScope.GetList('sea_crossings'))]"
									blockoverride "bridge" {
										raw_text = "strait crossing"
									}
									datamodel = "[Province.MakeScope.GetList('sea_crossings')]"
								}

								flow_crossing_ocr = {
									visible = "[DataModelHasItems(Province.MakeScope.GetList('river_large_crossings'))]"
									datamodel = "[Province.MakeScope.GetList('river_large_crossings')]"
								}

								flow_crossing_ocr = {
									visible = "[DataModelHasItems(Province.MakeScope.GetList('river_crossings'))]"
									datamodel = "[Province.MakeScope.GetList('river_crossings')]"
								}

								expand = {}
							}

							hbox = {
								layoutpolicy_horizontal = expanding

								visible = "[GetPlayer.HasDomicile]"

								button_text = {
									datacontext = "[GetPlayer.GetDomicile]"
									shortcut = map_mode_5
									layoutpolicy_horizontal = expanding

									onclick = "[ToggleGameViewData( 'domicile', Domicile.Self )]"

									visible = "[ObjectsEqual(HoldingView.GetProvince, Domicile.GetLocation)]"
									blockoverride "text" {
										raw_text = "[GetPlayer.GetFirstNamePossessiveOrMy] [Domicile.GetType.GetNameNoTooltip] is here,"
									}
									blockoverride "extra" {
										text_single = {
											raw_text = "Control Q."
										}
									}
								}

								expand = {}
							}

							# text_single = {
							# 	layoutpolicy_horizontal = expanding
							# 	visible = "[And(ObjectsEqual(HoldingView.GetProvince, GetPlayer.GetCapitalLocation), GetPlayer.HasDomicile)]"
							# 	raw_text = "Your [GetPlayer.GetDomicile.GetType.GetNameNoTooltip] is here,"
							# }

							hbox = {
								layoutpolicy_horizontal = expanding
								using = locr_county_not_wasteland

								button_primary_text = {
									layoutpolicy_horizontal = expanding
									blockoverride "text" {
										text = "CREATE_NEW_HOLDING_BUTTON"
									}
									blockoverride "hotkey" {
										visible = "[And(HoldingView.CanNewHoldingBeConstructed, Not(HoldingView.IsSelectingHoldingType))]"
									}
									blockoverride "disabled" {
										visible = "[Not(And(HoldingView.CanNewHoldingBeConstructed, Not(HoldingView.IsSelectingHoldingType)))]"
									}
									visible = "[And(And(Not(HoldingView.HasHolding), Not(HoldingView.IsBeingConstructed)), Or(HoldingView.GetHolder.IsLocalPlayer, HoldingView.GetHolder.IsVassalOf(GetPlayer.Self)))]"
									onclick = "[HoldingView.OnConstructHoldingClick]"
									tooltip = "[HoldingView.GetHoldingConstructionTooltip]"
									tooltip_visible = "[And(HoldingView.CanNewHoldingBeConstructed, Not(HoldingView.IsSelectingHoldingType))]"
									enabled = "[And(HoldingView.CanNewHoldingBeConstructed, Not(HoldingView.IsSelectingHoldingType))]"
								}

								expand = {}
							}

							locr_colonize_wasteland = {}

							# agot
							button_agot_restore_ruins = {
								layoutpolicy_horizontal = expanding
							}

							hbox = {
								layoutpolicy_horizontal = expanding

								visible = "[GetPlayer.HasDomicile]"



								button_text = {
									layoutpolicy_horizontal = expanding
									name = "move_domcicle_button"
									datacontext = "[GetPlayer.GetDomicile]"
									datacontext = "[HoldingView.GetProvince]"
									visible = "[And(Not(IsLandlessAdventurer( GetPlayer )), Not(ObjectsEqual(Province.Self, Domicile.GetLocation)))]"
									widgetid = "move_domcicle_button"

									onclick = "[Set('map_tip_ocr', 'select')]"
									onclick = "[Set('map_target_ocr', Province.GetNameNoTooltip)]"
									enabled = "[Domicile.CanMoveTo( Province.Self )]"
									onclick = "[OpenGameView( 'move_domicile_planner' )]"
									onclick = "[HoldingView.Close]"
									onclick = "[Set('map_tip_extra', Domicile.GetType.GetMoveTooltip( GetPlayer.Self ))]"

									tooltip = "[Domicile.GetType.GetMoveTooltip( Character.Self )]"
									tooltip_when_disabled = "[Domicile.GetMoveToTooltip( Province.Self )]"
									using = tooltip_ne
									blockoverride "text" {
										alwaystransparent = yes
										raw_text = "Move [Domicile.GetType.GetName] here."
									}
									blockoverride "disabled" {
										visible = "[Not(Domicile.CanMoveTo( Province.Self ))]"
									}
								}
								expand = {}
							}

							button_text = {
								layoutpolicy_horizontal = expanding
								name = "move_domcicle_button"
								datacontext = "[GetPlayer.GetDomicile]"
								datacontext = "[HoldingView.GetProvince]"
								visible = "[And(IsLandlessAdventurer( GetPlayer ), Not(ObjectsEqual(Province.Self, MyCapital)))]"
								widgetid = "move_domcicle_button"

								enabled = "[Domicile.CanMoveTo( Province.Self )]"
								onclick = "[OpenGameViewData( 'move_domicile_planner', Province.Self )]"
								onclick = "[HoldingView.Close]"

								# tooltip = "[Domicile.GetType.GetMoveTooltip( Character.Self )]"
								tooltip_when_disabled = "[Domicile.GetMoveToTooltip( Province.Self )]"
								using = tooltip_ne
								blockoverride "text" {
									alwaystransparent = yes
									raw_text = "Move [Domicile.GetType.GetName] here."
								}
								blockoverride "disabled" {
									visible = "[Not(Domicile.CanMoveTo( Province.Self ))]"
								}
							}

							# county
							hbox = {
								layoutpolicy_horizontal = expanding

								button_text = {
									datacontext = "[HoldingView.GetCountyTitle]"
									using = title_click
									blockoverride "pre" {
										spacing = 3
										text_single = {
											raw_text = "In"
										}
										text_single = {
											raw_text = "Your"
											visible = "[And(Title.GetHolder.IsLocalPlayer, Not(HoldingView.GetTitle.GetLesseeOrHolder.IsLocalPlayer) )]"
										}
										text_single = {
											raw_text = "Hostile"
											visible = "[GetScriptedGui('is_hostile_county').IsShown( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope( 'target', Province.MakeScope ).End )]"
										}
										text_single = {
											visible = "[GetScriptedGui('is_border_county').IsShown( GuiScope.SetRoot( Title.MakeScope ).End )]"
											raw_text = "[AddTextIf(Not(And(Title.GetHolder.IsLocalPlayer, Not(HoldingView.GetTitle.GetLesseeOrHolder.IsLocalPlayer) )), 'a ')]border"
										}
										text_single = {
											raw_text = "capital"
											visible = "[And(And(ObjectsEqual(HoldingView.GetCountyTitle, GetPlayer.GetCapitalLocation.GetCoATitle), Not( ObjectsEqual( HoldingView.GetProvince, GetPlayer.GetCapitalLocation ) ) ), Not(GetPlayer.IsLandlessRuler))]"
										}
									}
									blockoverride "text" {
										raw_text = "County of [Title.GetNameNoTierNoTooltip],"
									}
								}

								hbox = {
									spacing = 3
									using = agot_county_view_is_not_ruin
									using = locr_county_not_wasteland
									button_text = {
										datacontext = "[HoldingView.GetCountyTitle]"
										datacontext = "[Title.GetHolder]"
										using = char_click
										shortcut = mapmode_kingdoms_secondary
										visible = "[Not(Character.IsLocalPlayer)]"
										blockoverride "pre" {
											spacing = 3
											text_single = {
												visible = "[ObjectsEqual(Character.Self, HoldingView.GetHolding.GetLesseeOrHolder)]"
												raw_text = "both"
											}
										}
										blockoverride "text" {
											raw_text = "held by [Character.GetFirstNameNoTooltip], i:"
										}
									}
								}

								button_text = {
									onclick = "[GetVariableSystem.Set('county_tabs', 'holdings')]"
									shortcut = army_create_new
									blockoverride "text" {
										raw_text = "[GetDataModelSize(HoldingView.GetCountyTitle.MakeScope.GetList('county_holdings'))] holdings, H."
									}
								}

								expand = { }
							}

							button_text = {
								layoutpolicy_horizontal = expanding
								onclick = "[GetVariableSystem.Set('county_tabs', 'tasks')]"
								shortcut = map_mode_2
								datacontext = "[HoldingView.GetCountyTitle]"
								datacontext = "[Title.GetHolder]"
								visible = "[GetScriptedGui('any_task_active').IsShown( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('target_character', Character.MakeScope).AddScope('county', Title.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End )]"
								blockoverride "pre" {
									spacing = 3

									text_single = {
										raw_text = "[GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('target_character', Character.MakeScope).AddScope('county', Title.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).ScriptValue('active_tasks')] active"
									}
								}
								blockoverride "text" {
									raw_text = "tasks, hotkey T."
								}
							}
						}

						# button_text = {
						#   onclick = "[GetScriptedGui('open_map_grid').Execute( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('province', Province.MakeScope).End )]"
						# 	onclick = "[Set('extra_window', 'map_explorer')]"
						# 	onclick = "[CloseGameView('holding_view')]"
						# 	layoutpolicy_horizontal = expanding
						#   blockoverride "pre" {
						#     text_single = {
						#       raw_text = "[County.GetTitle.GetProvince.MakeScope.ScriptValue('rounded_x')] east, [County.GetTitle.GetProvince.MakeScope.ScriptValue('rounded_y')] north."
						#     }
						#   }
						#   blockoverride "text" {
						#     raw_text = "Open map grid."
						#   }
						# }

						button_text = {
							layoutpolicy_horizontal = expanding
							datacontext = [County.GetCountyOccupant]
							visible = [County.IsFullyOccupied]
							blockoverride "text" {
								raw_text = "County occupied by [Character.GetPrimaryTitle.GetNameNoTierNoTooltip]."
							}
							tooltip = "COUNTY_OCCUPIER_TOOLTIP"
							using = char_click
						}

						# claim
						hbox = {
							layoutpolicy_horizontal = expanding
							visible = "[Not(ObjectsEqual(HoldingView.GetCountyTitle.GetHolder, GetPlayer))]"

							text_single = {
								margin_left = 5
								datacontext = "[HoldingView.GetCountyTitle]"
								raw_text = "[Title.GetClaimStateFor(GetPlayer)]."
								visible = "[And(NotEqualTo_uint32( Title.GetHolder.GetID, GetPlayer.GetID ), GetPlayer.HasClaimOnTitle( Title.Self ))]"
							}

							expand = { }
						}

						# hostile
						hbox = {
							layoutpolicy_horizontal = expanding
							spacing = 3
							datacontext = "[HoldingView.GetProvince]"

							# text_single = {
							# 	margin_left = 5
							# 	raw_text = "Friendly"
							# 	visible = "[GetScriptedGui('is_friendly_county').IsShown( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope( 'target', Province.MakeScope ).End )]"
							# }


							### SIEGE AND RAID GOTO BUTTON ###
							button_group = {
								name = "open_siege_button"
								datacontext = "[HoldingView.GetProvince.GetSiege]"
								visible = "[HoldingView.GetProvince.HasActiveSiege]"
								onclick = "[DefaultOnSiegeClick(Siege.GetID)]"
								tooltip = "[Siege.GetSiegeDescription]"
								using = tooltip_se
								# shortcut = confirm
								shortcut = find_title_shortcut
								using = siege_goto_template
								blockoverride "key" {
									shortcut = find_title_shortcut
								}
								blockoverride "extra" {
									spacing = 3
									text_single = {
										raw_text = "hotkey V."
									}
									text_single = {
										raw_text = "[Siege.GetSiegingRealmCharacter.GetNameNoTooltip]."
									}
								}
							}

							button_group = {
								name = "open_raid_button"
								datacontext = "[HoldingView.GetProvince.GetRaid]"
								visible = "[HoldingView.GetProvince.HasActiveRaid]"
								onclick = "[DefaultOnRaidClick( Raid.Self )]"
								tooltip = "MAP_RAID_TOOLTIP"
								# shortcut = confirm
								shortcut = find_title_shortcut
								using = tooltip_se
								using = raid_goto_template
								blockoverride "tooltip" { }
								blockoverride "key" {
									shortcut = find_title_shortcut
								}
								blockoverride "extra" {
									text_single = {
										raw_text = " hotkey V."
									}
								}
							}

							# text_single = {
							# 	raw_text = "Adjacent to an allied county."
							# 	visible = "[GetScriptedGui('adjacent_to_ally').IsShown( GuiScope.SetRoot( HoldingView.GetProvince.MakeScope ).AddScope( 'me', GetPlayer.MakeScope ).End )]"
							# }

							button_text = {
								visible = "[Province.IsOccupied]"
								datacontext = "[Province.GetController]"
								blockoverride "text" {
									align = left
									raw_text = "Occupied by [Character.GetPrimaryTitle.GetNameNoTierNoTooltip]."
								}
								using = char_click
							}

							expand = { }
						}

						# holder
						vbox = {
							layoutpolicy_horizontal = expanding
							visible = "[Not(ObjectsEqual(HoldingView.GetCountyTitle.GetHolder, GetPlayer))]"

							hbox = {
								layoutpolicy_horizontal = expanding

								button_text = {
									using = char_click
									datacontext = "[HoldingView.GetTopLiege]"
									using = not_wasteland_locr
									using = agot_character_standard
									blockoverride "pre" {
										spacing = 3
										text_single = {
											raw_text = "Inside"
										}
										flowcontainer = {
											ignoreinvisible = yes
											visible = "[Not(Character.IsLocalPlayer)]"
											spacing = 3

											text_single = {
												raw_text = "[Character.GetPrimaryTitle.GetNameNoTooltip],"
											}
											text_single = {
												raw_text = "[Character.RealmSize] counties,"
											}
											text_single = {
												raw_text = "[Character.GetMilitaryStrengthText] soldiers."
											}
										}
										flowcontainer = {
											ignoreinvisible = yes
											visible = "[Character.IsLocalPlayer]"

											text_single = {
												raw_text = "your realm."
											}

										}
									}
								}

								expand = { }
							}

							# char_name = {
							# 	layoutpolicy_horizontal = expanding
							# 	datacontext = "[HoldingView.GetCountyTitle.GetHolder]"
							# 	blockoverride "pre" {
							# 		text_single = {
							# 			margin_right = 3
							# 			raw_text = "Holder,"
							# 		}
							# 	}
							#
							# 	blockoverride "extra" {
							# 		# text_single = {
							# 		# 	visible = "[Not(ObjectsEqual(Character.Self, GetPlayer ))]"
							# 		# 	raw_text = " Opinion [Character.GetOpinionOf( GetPlayer )]."
							# 		# }
							# 		flowcontainer = {
							# 		    ignoreinvisible = yes
							#
							# 			visible = "[Not(ObjectsEqual( Character.Self, GetPlayer ))]"
							#
							# 			text_single = {
							# 				visible = "[Character.HasRelationTo( GetPlayer )]"
							# 				raw_text = " [Character.GetRelationToString( GetPlayer )]."
							# 			}
							# 		}
							# 		# flowcontainer = {
							# 		#     ignoreinvisible = yes
							# 		# 	visible = "[Not(ObjectsEqual( Character.GetTopLiege, GetPlayer ))]"
							# 		#
							# 		# 	text_single = {
							# 		# 		visible = "[Character.HasRelationTo( Character.GetTopLiege )]"
							# 		# 		raw_text = " [Character.GetRelationToString( Character.GetTopLiege )]."
							# 		# 	}
							# 		#
							# 		# }
							# 	}
							# }
						}

						# enemies
						hbox = {
							layoutpolicy_horizontal = expanding
							visible = "[GetScriptedGui('is_county_not_in_fog').IsShown( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('this_county', HoldingView.GetCountyTitle.MakeScope).End )]"

							hbox = {
								visible = "[GreaterThan_CFixedPoint(GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('province', Province.MakeScope).ScriptValue('enemies_in_the_county'), '(CFixedPoint)0' )]"
								layoutpolicy_horizontal = expanding
								spacing = 3

								#TODO hide in the fog

								text_single = {
									visible = "[GreaterThan_CFixedPoint(GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('province', Province.MakeScope).ScriptValue('enemies_in_the_province'), '(CFixedPoint)0' )]"
									raw_text = "[GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('province', Province.MakeScope).ScriptValue('enemies_in_the_province')] enemies here."
								}

								text_single = {
									raw_text = "[GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('province', Province.MakeScope).ScriptValue('enemies_in_the_county')] enemies in the county."
									visible = "[GreaterThan_CFixedPoint(GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('province', Province.MakeScope).ScriptValue('enemies_in_the_county'), GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('province', Province.MakeScope).ScriptValue('enemies_in_the_province'))]"
								}

								expand = { }
							}

							expand = { }
						}

						# allies
						hbox = {
							layoutpolicy_horizontal = expanding
							spacing = 3
							visible = "[GreaterThan_CFixedPoint(GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('province', Province.MakeScope).ScriptValue('allies_in_the_county'), '(CFixedPoint)0' )]"

							text_single = {
								visible = "[GreaterThan_CFixedPoint(GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('province', Province.MakeScope).ScriptValue('allies_in_the_province'), '(CFixedPoint)0' )]"
								raw_text = "[GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('province', Province.MakeScope).ScriptValue('allies_in_the_province')] allies here."
							}

							text_single = {
								visible = "[GreaterThan_CFixedPoint( GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('province', Province.MakeScope).ScriptValue('allies_in_the_county'), GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('province', Province.MakeScope).ScriptValue('allies_in_the_province'))]"

								raw_text = "[GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('province', Province.MakeScope).ScriptValue('allies_in_the_county')] allies in the county."
							}

							expand = { }
						}

						# de jure
						hbox = {
							layoutpolicy_horizontal = expanding

							button_text = {
								using = title_click
								datacontext = "[HoldingView.GetCountyTitle.GetDeJureLiege]"
								blockoverride "text" {
									raw_text = "De jure in [Title.GetNameNoTierNoTooltip], [Title.GetDeJureLiege.GetNameNoTierNoTooltip], [Title.GetDeJureLiege.GetDeJureLiege.GetNameNoTierNoTooltip], Page Up."
								}
								shortcut = "zoom_out"
							}

							hbox = {
								visible = "[GreaterThan_CFixedPoint(Province.MakeScope.Var('is_in_regions').GetValue, '(CFixedPoint)0')]"

								button_text = {
									shortcut = map_mode_18
									blockoverride "text" {
										raw_text = "Belongs to [Province.MakeScope.Var('is_in_regions').GetValue] regions, Control R."
									}
									# onclick = "[GetScriptedGui('save_region_province').Execute( GuiScope.SetRoot( HoldingView.GetCountyTitle.MakeScope ).AddScope( 'player', GetPlayer.MakeScope).AddScope('target', HoldingView.GetProvince.MakeScope).End )]"
									onclick = "[Set('extra_window', 'window_province_regions')]"
								}

								expand = {}
							}
							expand = { }
						}


						# distance
						vbox = {
							layoutpolicy_horizontal = expanding

							button_text = {
								layoutpolicy_horizontal = expanding
								onclick = "[GetVariableSystem.Set('county_tabs', 'adjacent counties')]"
								shortcut = map_mode_6
								shortcut = editor_autosave
								onclick = "[GetScriptedGui('adjacent_counties').Execute( GuiScope.SetRoot( HoldingView.GetCountyTitle.MakeScope ).AddScope( 'player', GetPlayer.MakeScope).AddScope('target', HoldingView.GetProvince.MakeScope).End )]"
								# visible = "[Or(Or(DataModelHasItems( HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_seas') ), DataModelHasItems( HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_rivers') )), DataModelHasItems( HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_counties') ))]"
								blockoverride "text" {
									raw_text = "County is adjacent to"
								}
								blockoverride "extra" {
									flowcontainer = {
										ignoreinvisible = yes
										visible = "[DataModelHasItems(HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_seas'))]"
										spacing = 3

										flowcontainer = {
											datamodel = "[DataModelFirst(HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_seas'), '(int32)1')]"
											visible = "[EqualTo_int32(GetDataModelSize(HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_seas')), '(int32)1')]"

											item = {
												flowcontainer = {
													spacing = 3
													text_single = {
														raw_text = "[Scope.GetProvince.GetName]"
													}
												}
											}
										}

										text_single = {
											visible = "[GreaterThan_int32(GetDataModelSize(HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_seas')), '(int32)1')]"
											raw_text = "[GetDataModelSize(HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_seas'))] seas"
										}

										text_single = {
											visible = "[Or(DataModelHasItems(HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_counties')), DataModelHasItems(HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_rivers')))]"
											raw_text = "and"
										}
									}

									flowcontainer = {
										ignoreinvisible = yes
										visible = "[DataModelHasItems(HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_rivers'))]"
										spacing = 3

										flowcontainer = {
											datamodel = "[DataModelFirst(HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_rivers'), '(int32)1')]"
											visible = "[EqualTo_int32(GetDataModelSize(HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_rivers')), '(int32)1')]"

											item = {
												flowcontainer = {
													spacing = 3
													text_single = {
														raw_text = "[Scope.GetProvince.GetName] river"
													}
												}
											}
										}

										text_single = {
											visible = "[GreaterThan_int32(GetDataModelSize(HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_rivers')), '(int32)1')]"
											raw_text = "[GetDataModelSize(HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_rivers'))] rivers"
										}

										text_single = {
											visible = "[Or(DataModelHasItems(HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_rivers')), DataModelHasItems(HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_rivers')))]"
											raw_text = "and"
										}
									}

									text_single = {
										visible = "[DataModelHasItems(HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_counties'))]"
										raw_text = "[GetDataModelSize(HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_counties'))] counties"
									}

									text_single = {
										margin_left = -3
										raw_text = ", A."
									}
								}
							}

							# distance
							vbox = {
								margin_left = 3
								layoutpolicy_horizontal = expanding

								# text_single = {
								# 	raw_text = "Riverside county."
								# 	visible = "[GetScriptedGui('is_riverside_county').IsShown( GuiScope.SetRoot( HoldingView.GetCountyTitle.MakeScope ).End )]"
								# }

								hbox = {
									layoutpolicy_horizontal = expanding
									visible = "[GetScriptedGui('show_coordinates').IsShown( GuiScope.SetRoot( GetPlayer.MakeScope ).End )]"
									text_single = {
										raw_text = "X [HoldingView.GetProvince.MakeScope.Var('pos_x').GetValue|0], Y [HoldingView.GetProvince.MakeScope.Var('pos_y').GetValue|0]."
									}
									expand = { }

								}

								expand = { }
							}

							button_text = {
								layoutpolicy_horizontal = expanding
								blockoverride "text" {
									margin_left = -5
									raw_text = "Your closest county,"
								}
								datacontext = "[HoldingView.GetProvince.MakeScope.Var('closest_county').Title]"
								datacontext = "[HoldingView.GetProvince.MakeScope.Var('closest_county').Title.GetProvince]"
								blockoverride "extra" {
									text_single = {
										raw_text = " [Title.GetNameNoTierNoTooltip],"
									}
									text_distance_capital = {
									}
									text_single = {
										raw_text = "Home."
									}
								}
								using = prov_click
								visible = "[And(And(Not(Or(ObjectsEqual( Character.Self, GetPlayer ),Character.IsOtherLiegeOrAbove( GetPlayer ))), Not(GetPlayer.IsLandlessRuler)), HoldingView.GetProvince.MakeScope.Var('closest_county').IsSet)]"
								shortcut = go_to_capital
							}

							button_text = {
								layoutpolicy_horizontal = expanding
								using = char_click
								datacontext = "[HoldingView.GetCountyTitle.GetHolder]"
								datacontext = "[HoldingView.GetCountyTitle]"
								blockoverride "text" {
									raw_text = "[Character.GetFirstNameOrMeNoTooltip] hold[AddTextIf(Not(Character.IsLocalPlayer), 's')] [Title.GetHolder.MakeScope.ScriptValue('personal_counties')] personal counties."
								}
							}

							hbox = {
								layoutpolicy_horizontal = expanding
								button_text = {
									shortcut = decrease_speed_2
									datacontext = "[HoldingView.GetCountyTitle.MakeScope.Var('prev_county').Title]"
									onclick = "[OpenGameViewData('holding_view', Title.GetProvince.Self)]"
									onclick = "[DefaultOnCoatOfArmsRightClick(Title.GetID)]"
									onclick = "[PdxGuiTriggerAllAnimations('adjacent_counties')]"
									onrightclick = "[DefaultOnCoatOfArmsRightClick(Title.GetID)]"
									visible = "[HoldingView.GetCountyTitle.MakeScope.Var('prev_county').IsSet]"

									blockoverride "text" {
										raw_text = "Z, previous, [Title.GetNameNoTierNoTooltip],"
									}
									blockoverride "extra" {
										text_single = {
											datacontext = "[Title.GetProvince]"
											raw_text = "[DistanceTo(HoldingView.GetProvince, Province)|0] [DaysTo(HoldingView.GetProvince, Province)] [Direction(HoldingView.GetProvince, Province)]."
										}
									}
								}
								button_text = {
									shortcut = increase_speed_2
									onclick = "[OpenGameViewData('holding_view', Title.GetProvince.Self)]"
									onclick = "[DefaultOnCoatOfArmsRightClick(Title.GetID)]"
									onclick = "[PdxGuiTriggerAllAnimations('adjacent_counties')]"
									visible = "[HoldingView.GetCountyTitle.MakeScope.Var('next_county').IsSet]"

									onrightclick = "[DefaultOnCoatOfArmsRightClick(Title.GetID)]"
									datacontext = "[HoldingView.GetCountyTitle.MakeScope.Var('next_county').Title]"
									blockoverride "text" {
										raw_text = "X, next, [Title.GetNameNoTierNoTooltip],"
									}
									blockoverride "extra" {
										text_single = {
											datacontext = "[Title.GetProvince]"
											raw_text = "[DistanceTo(HoldingView.GetProvince, Province)|0] [DaysTo(HoldingView.GetProvince, Province)] [Direction(HoldingView.GetProvince, Province)]."
										}
									}
								}

								expand = {}
							}


						}


						# holding info
						vbox = {
							layoutpolicy_horizontal = expanding
							datacontext = "[HoldingView.GetProvince]"
							margin_top = 10
							button_text = {
								layoutpolicy_horizontal = expanding
								blockoverride "pre" {
									spacing = 3
									text_single = {
										raw_text = "Holding and buildings,"
									}
									text_single = {
										raw_text = "hotkey E."
									}
								}
								onclick = "[GetVariableSystem.Set('county_tabs', 'holding')]"
								shortcut = map_mode_1
							}

							hbox = {
								layoutpolicy_horizontal = expanding

								agot_county_view_dragonpit_button_ocr = {}

								expand = {}
							}


							hbox = {
								layoutpolicy_horizontal = expanding
								spacing = 3
								visible = "[HoldingView.HasHolding]"
								hbox = {
									spacing = 3
									tooltip = "[Holding.GetTaxTooltip]"

									text_single = {
										visible = "[Holding.LevyAndTaxIsAffectedByFixableSituation]"
										raw_text = "Low"
									}

									text_single = {
										raw_text = "Tax, [Holding.GetIncome|1]."
									}
								}

								hbox = {
									spacing = 3
									tooltip = "[Holding.GetLeviesTooltip]"
									visible = "[And( HoldingView.HasHolding, Not( Holding.GetType.HasParameter( 'no_levies' ) ) )]"

									text_single = {
										tooltip = "[Holding.GetTaxTooltip]"
										raw_text = "Levies, [Holding.GetMaxLevySize|0]."
									}
								}


								expand = { }
							}


							button_locr_road = {}

							button_text = {
								layoutpolicy_horizontal = expanding
								onclick = "[GetVariableSystem.Set('county_tabs', 'holding')]"
								visible = "[GreaterThan_int32(GetDataModelSize(HoldingView.GetHoldingStatuses), '(int32)1')]"
								blockoverride "extra" {

									text_single = {
										raw_text = "[CountItems] modifiers"
										alwaystransparent = yes

										hbox = {
											datamodel = "[HoldingView.GetHoldingStatuses]"
											name = "items"
											item = {
												container = {
													visible = "[Or(HoldingStatus.IsWinterLevel, Or(HoldingStatus.IsLegend, HoldingStatus.IsTimedModifier))]"
												}
											}
										}
									}
									# raw_text = "[Subtract_int32(GetDataModelSize(HoldingView.GetHoldingStatuses), '(int32)1')] modifiers."
								}
							}


							hbox = {
								layoutpolicy_horizontal = expanding
								spacing = 3


								# text_single = {
								# 	visible = "[Or(HoldingView.GetGUIDuchyCapitalBuilding.IsBuildNewIconShown, HoldingView.GetGUISpecialBuilding.IsBuildNewIconShown)]"
								# 	raw_text = "plus"
								# }
								# text_single = {
								# 	visible = "[HoldingView.GetGUIDuchyCapitalBuilding.IsBuildNewIconShown]"
								# 	raw_text = "ducal,"
								# }
								# text_single = {
								# 	visible = "[And(HoldingView.GetGUIDuchyCapitalBuilding.IsBuildNewIconShown, HoldingView.GetGUISpecialBuilding.IsBuildingSlotShown)]"
								# 	raw_text = "and"
								# }
								# text_single = {
								# 	visible = "[HoldingView.GetGUISpecialBuilding.IsBuildNewIconShown]"
								# 	raw_text = "special."
								# }

								expand = { }
							}

							button_text = {
								layoutpolicy_horizontal = expanding
								onclick = "[GetVariableSystem.Set('county_tabs', 'holding')]"
								onclick = "[GetVariableSystem.Set('holding_tabs', 'buildings')]"
								blockoverride "pre" {
									spacing = 3
									text_single = {
										raw_text = "[Province.MakeScope.ScriptValue('free_building_slots_sval')] empty slots,"
									}

									text_single = {
										visible = "[HoldingView.HasHolding]"
										raw_text = "[Province.MakeScope.ScriptValue('num_buildings_sval')] buildings,"
									}

									text_single = {
										visible = "[Or(HoldingView.GetGUIDuchyCapitalBuilding.HasLevel, HoldingView.GetGUISpecialBuilding.HasLevel)]"
										raw_text = "plus"
									}
									text_single = {
										visible = "[HoldingView.GetGUIDuchyCapitalBuilding.HasLevel]"
										raw_text = "ducal,"
									}
									text_single = {
										visible = "[And(HoldingView.GetGUIDuchyCapitalBuilding.HasLevel, HoldingView.GetGUISpecialBuilding.HasLevel)]"
										raw_text = "and"
									}
									text_single = {
										visible = "[HoldingView.GetGUISpecialBuilding.HasLevel]"
										raw_text = "special."
									}
								}
							}

							text_single = {
								layoutpolicy_horizontal = expanding
								raw_text = "This is a county capital, so its holder controls the county."
								visible = "[HoldingView.GetProvince.GetTitle.IsCountyCapital]"
							}

							# button_agot_abandon_ruin = { }

							button_text = {
								layoutpolicy_horizontal = expanding
								blockoverride "text" {
									raw_text = "Make realm capital."
								}
								using = agot_can_set_realm_capital
								visible = "[HoldingView.PotentialSetRealmCapital]"
								onclick = "[HoldingView.SetRealmCapital]"
								tooltip = "[HoldingView.GetSetRealmCapitalTooltip]"
							}
							hbox = {
								layoutpolicy_horizontal = expanding
								visible = "[Not(HoldingView.GetHolding.IsEmpty)]"

								button_text = {
									name = "toggle_find_vassal"
									blockoverride "text" {
										raw_text = "Grant [Select_CString(HoldingView.GetProvince.GetTitle.IsCountyCapital, 'holding and county', 'holding')], hotkey G."
									}
									shortcut = army_merge
									onclick = "[HoldingView.ToggleFindVassalListWindow]"
									visible = "[And( And( ObjectsEqual( Title.GetHolder, Character.Self ), Title.CanUseFindVassal( Character.Self ) ), Not( Title.IsLeasedOut ) )]"

									# visible = "[And(And( ObjectsEqual( HoldingView.GetTitle.GetHolder, GetPlayer ), Not(HoldingView.GetTitle.IsLeasedOut) ), Not(HoldingView.GetProvince.IsRealmCapital))]"
								}

								expand = { }
							}
						}

						# tasks
						hbox = {
							layoutpolicy_horizontal = expanding
							visible = "[Not(GetVariableSystem.Exists('county_tabs'))]"

							button_text = {
								onclick = "[GetVariableSystem.Set('county_tabs', 'tasks')]"
								shortcut = map_mode_2
								datacontext = "[HoldingView.GetCountyTitle]"
								datacontext = "[Title.GetHolder]"
								visible = "[Not(GetScriptedGui('any_task_active').IsShown( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('target_character', Character.MakeScope).AddScope('county', Title.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End ))]"
								blockoverride "pre" {
									spacing = 3
									text_single = {
										raw_text = "View"
										visible = "[Not(GetScriptedGui('any_task_active').IsShown( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('target_character', Character.MakeScope).AddScope('county', Title.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End ))]"
									}
								}
								blockoverride "text" {
									raw_text = "tasks, hotkey T."
								}
							}

							expand = { }
						}
					}

					# holding info
					vbox = {
						layoutpolicy_horizontal = expanding
						visible = "[GetVariableSystem.HasValue('county_tabs', 'holding')]"
						# name
						hbox = {
							layoutpolicy_horizontal = expanding
							spacing = 3
							datacontext = "[HoldingView.GetTitle.GetLesseeOrHolder]"

							text_single = {
								visible = "[Character.IsLocalPlayer]"
								raw_text = "Your"
							}

							text_single = {
								raw_text = "[AddTextIf(Not(HoldingView.GetHolding.IsEmpty), Concatenate(HoldingView.GetHolding.GetPrimaryBuildingType.GetTypeName, ' of '))][HoldingView.GetProvince.GetTitle.GetNameNoTierNoTooltip]."
								tooltip = "[HoldingView.GetProvince.GetTitle.GetNameNoTierNoTooltip]"
							}

							#button
							hbox = {
								visible = "[HoldingView.GetTitle.HasHolder]"

								text_single = {
									raw_text = "County capital."
									visible = "[And(HoldingView.GetProvince.GetTitle.IsCountyCapital, Not(HoldingView.GetProvince.IsRealmCapital))]"
									tooltip = "COUNTY_CAPITAL_TOOLTIP"
								}

								hbox = {
									using = agot_county_view_is_not_ruin
									using = locr_county_not_wasteland
									text_single = {
										raw_text = "Realm capital." #TODO what realm
										visible = "[HoldingView.GetProvince.IsRealmCapital]"
										tooltip = "REALM_CAPITAL_TOOLTIP"
									}
								}

							}

							expand = { }
						}

						vbox = {
							layoutpolicy_horizontal = expanding
							visible = "[Not(GetVariableSystem.HasValue('holding_tabs', 'buildings'))]"

							### info
							flowcontainer = {
								layoutpolicy_horizontal = expanding
								direction = vertical
								margin_top = 5
								ignoreinvisible = yes

								flowcontainer = {
									direction = vertical
									ignoreinvisible = yes

									#holder
									flowcontainer = {
										direction = vertical
										ignoreinvisible = yes

										button_text = {
											blockoverride "text" {
												raw_text = "Make realm capital."
											}
											blockoverride "disabled" {
												visible = "[Not(HoldingView.CanSetRealmCapital)]"
											}
											enabled = "[HoldingView.CanSetRealmCapital]"
											visible = "[HoldingView.PotentialSetRealmCapital]"
											onclick = "[HoldingView.SetRealmCapital]"
											tooltip = "[HoldingView.GetSetRealmCapitalTooltip]"
										}

										button_text = {
											blockoverride "text" {
												raw_text = "Make county capital."
											}
											visible = "[HoldingView.CanSetCountyCapital]"
											onclick = "[HoldingView.SetCountyCapital]"
											tooltip = "SET_COUNTY_CAPITAL_TOOLTIP"
										}

										button_text = {
											layoutpolicy_horizontal = expanding

											blockoverride "text" {
												text = "CREATE_NEW_HOLDING_BUTTON"
											}
											blockoverride "extra" {
												text_single = {
													raw_text = ", disabled"
													visible = "[Not(And(HoldingView.CanNewHoldingBeConstructed, Not(HoldingView.IsSelectingHoldingType)))]"
												}
											}
											blockoverride "dot" { }
											name = "construct_holding"
											visible = "[And(Not(HoldingView.HasHolding), Not(HoldingView.IsBeingConstructed))]"
											onclick = "[HoldingView.OnConstructHoldingClick]"
											# tooltip = "[HoldingView.GetHoldingConstructionTooltip]"
											enabled = "[And(HoldingView.CanNewHoldingBeConstructed, Not(HoldingView.IsSelectingHoldingType))]"
										}

										#TODO title buttons
										flow_title_shared_buttons_ocr = {
											datacontext = "[HoldingView.GetTitle]"
											datacontext = "[Title.GetHolder]"
										}

										flow_locr_feudalize_buttons = {}

										#construction
										flowcontainer = {
											direction = vertical
											ignoreinvisible = yes
											spacing = 3
											name = "constructing_holding"
											visible = "[HoldingView.IsBeingConstructed]"

											text_single = {
												raw_text = "Construction: [HoldingView.GetConstructionTimeLeftForSlot('(int32)0')], [HoldingView.GetConstructionProgressForSlot('(int32)0')|0]% done."
												tooltip = "[HoldingView.GetHoldingUnderConstructionTooltip]"
											}

											button_text = {
												blockoverride "text" {
													raw_text = "CANCEL_HOLDING_CONSTRUCTION"
													align = left
												}
												blockoverride "extra" {
													text_single = {
														raw_text = ", cost will be refunded."
													}
												}
												onclick = "[HoldingView.CancelHoldingConstruction]"
												visible = "[HoldingView.CanCancelConstruction]"
												# tooltip = "CANCEL_HOLDING_CONSTRUCTION_TOOLTIP"
											}
										}

										#occupation
										text_single = {
											visible = "[HoldingView.GetProvince.IsOccupied]"
											text = "[HoldingView.GetOccupiedInfo]"
										}
									}

									flowcontainer = {
										spacing = 3
										ignoreinvisible = yes
										using = locr_county_not_wasteland

										### Tax Income
										flowcontainer = {
											visible = "[HoldingView.HasHolding]"
											ignoreinvisible = yes
											tooltip = "[Holding.GetTaxTooltip]"

											text_single = {
												text = "HOLDING_TAX"
											}

											widget = {
												size = { 5 0 }
											}

											text_single = {
												text = "HOLDING_TAX_VALUE"
												default_format = "#V"
											}

											text_single = {
												raw_text = "."
												default_format = "#high"
											}

											text_single = {
												raw_text = " Reduced."
												visible = "[Holding.LevyAndTaxIsAffectedByFixableSituation]"
											}
										}

										### Raid loot
										flowcontainer = {
											name = "tutorial_highlight_holding_view_loot_box"
											visible = "[HoldingView.HasHolding]"
											margin = { 2 0 }
											tooltip = "[Holding.GetProvince.GetRaidLootTooltip]"
											ignoreinvisible = yes

											background = {
												visible = "[Holding.GetProvince.IsRecentlyLooted]"
												using = Status_Bad
											}

											text_single = {
												# layoutpolicy_horizontal = expanding
												text = "HOLDING_LOOT"
												default_format = "#high"
											}

											widget = {
												size = { 5 0 }
											}

											text_single = {
												text = "HOLDING_LOOT_VALUE"
											}

											text_single = {
												raw_text = "."
												default_format = "#high"
											}

											text_single = {
												raw_text = " Recently looted."
												visible = "[Holding.GetProvince.IsRecentlyLooted]"
											}
										}
									}

									### Levies
									flowcontainer = {
										visible = "[HoldingView.HasHolding]"
										ignoreinvisible = yes

										flowcontainer = {
											using = locr_county_not_wasteland
											ignoreinvisible = yes

											tooltip = "[Holding.GetLeviesTooltip]"

											text_single = {
												text = "LEVIES"
											}

											widget = {
												size = { 5 0 }
											}

											text_single = {
												raw_text = "[Holding.GetMaxLevySize|0],"
											}

											widget = {
												size = { 5 0 }
											}

											text_single = {
												raw_text = "[Holding.GetUnraisedLevyRatioPercent|0]% unraised."
											}

											text_single = {
												raw_text = " Reduced."
												visible = "[Holding.LevyAndTaxIsAffectedByFixableSituation]"
											}
										}
									}

									### Plague Resistance
									flowcontainer = {
										datacontext = "[Holding.GetProvince]"
										datacontext = "[HoldingView.AccessPlagueResistanceBreakdown]"
										ignoreinvisible = yes

										spacing = 3

										text_single = {
											text = "game_concept_epidemic_resistance"
											tooltip = "game_concept_epidemic_resistance_desc"
											tooltip_visible = "[Not(ValueBreakdown.HasTooltip)]"
										}

										text_single = {
											text = "HOLDING_VIEW_EPIDEMIC_RESISTANCE_VALUE"
										}

										dot_l = {}

										tooltip_visible = "[ValueBreakdown.HasTooltip]"
										tooltipwidget = {
											widget_value_breakdown_tooltip = {}
										}
									}

									flowcontainer = {
										name = "epidemics_here"
										datamodel = "[HoldingView.GetHoldingStatuses]"
										ignoreinvisible = yes
										direction = vertical

										item = {
											container = {
												visible = "[HoldingStatus.IsEpidemic]"
												datacontext = "[HoldingStatus.GetEpidemic]"
												ignoreinvisible = yes

												button_epidemic_ocr = {
													blockoverride "pre" {
														text_single = {
															raw_text = "Infected with"
														}
													}
													blockoverride "extra" {
														comma = {}
														text_single = {
															raw_text = "[EpidemicInfectionLevel.GetThreshold]%."
														}
													}
													# onclick = "[ToggleGameView( 'epidemics' )]"

													blockoverride "extra_data"
													{

														spacer = { size = { 0 16 } }

														cooltip_paragraph = {
															visible = "[EpidemicInfectionLevel.HasRealmModifier]"
															text = "[EpidemicInfectionLevel.GetRealmModifierDesc]"
														}
														cooltip_paragraph = {
															visible = "[Or( EpidemicInfectionLevel.HasProvinceModifier, EpidemicInfectionLevel.HasCountyModifier )]"
															text = "EPIDEMIC_MODIFIERS_PROVINCE_AND_COUNTY"
														}
													}

													blockoverride "infection_chance_text"
													{
														text = "EPIDEMIC_TOOLTIP_CHANCE_OF_INFECTION_SPECIFIC_PROVINCE"
													}


													datacontext = "[Epidemic.GetInfectionLevelIn( HoldingView.GetProvince )]"
												}
											}
										}
									}

									flowcontainer = {
										name = "terrain"
										datamodel = "[HoldingView.GetHoldingStatuses]"
										ignoreinvisible = yes
										direction = vertical

										item = {
											container = {
												ignoreinvisible = yes

												text_single = {
													raw_text = "Terrain: [Terrain.GetNameNoTooltip]."
													visible = "[HoldingStatus.IsTerrainType]"
													datacontext = "[HoldingStatus.GetTerrainType]"
													datacontext = "[HoldingView.GetProvince]"
													tooltip = "HOLDING_TERRAIN_TOTAL_TOOLTIP"
												}

												button_text = {
													visible = "[HoldingStatus.IsMAATypeOriginHere]"
													datacontext = "[HoldingStatus.GetMAATypeOriginHere]"
													datacontext = "[HoldingStatus.GetMAAOriginHere]"
													enabled = "[HoldingStatus.IsMAAOriginHere]"
													blockoverride "pre" {
														text_single = {
															raw_text = "[MenAtArmsType.GetNameNoTooltip] stationed here."
															tooltip = "SHOW_MAA_ORIGIN_TT"
														}
														text_single = {
															visible = "[HoldingStatus.IsMAAOriginHere]"

															raw_text = "Click to view."
														}
													}

													onclick = "[OpenGameView( 'military' )]"
													onclick = "[OpenGameViewData( 'men_at_arms', Regiment.GetID )]"
												}
											}
										}
									}

									flowcontainer = {
										name = "holding_statuses"
										datamodel = "[HoldingView.GetHoldingStatuses]"
										ignoreinvisible = yes
										direction = vertical

										item = {
											container = {
												ignoreinvisible = yes

												container = {
													ignoreinvisible = yes
													visible = "[HoldingStatus.IsWinterLevel]"
													text_single = {
														raw_text = "Mild winter."
														visible = "[Province.HasWinterLevel( '(int32)1' )]"
													}

													text_single = {
														raw_text = "Winter."
														visible = "[Province.HasWinterLevel( '(int32)2' )]"
													}

													text_single = {
														raw_text = "Harsh winter."
														visible = "[Province.HasWinterLevel( '(int32)3' )]"
													}
													tooltip = "PROVINCE_VIEW_TOOLTIP_WINTER"
												}

												container = {
													visible = "[HoldingStatus.IsLegend]"
													datacontext = "[HoldingStatus.GetLegend]"
													blockoverride "pre" {
														text_single = {
															raw_text = "Legend:"
														}
													}

													button_legend_ocr = {
														visible = "[Not( Or( Legend.IsCurrentlyPromotedInProvince( Province.Self ), Legend.WasPromotedOnCompletionInProvince( Province.Self ) ) )]"
														effectname = "GreyedOut"

														blockoverride "province_details" {
															text_multi = {
																layoutpolicy_horizontal = expanding
																autoresize = yes
																maximumsize = { 400 300 }

																text = "DISABLED_LEGEND_PROVINCE_MODIFIERS"
															}
														}
													}

													button_legend_ocr = {
														visible = "[Or( Legend.IsCurrentlyPromotedInProvince( Province.Self ), Legend.WasPromotedOnCompletionInProvince( Province.Self ) )]"
													}
												}

												container = {
													visible = "[HoldingStatus.IsTimedModifier]"
													datacontext = "[HoldingStatus.GetTimedModifier]"

													modifier_item_ocr = {
														blockoverride "icon_data"
														{
															using = tooltip_ne
														}
													}
												}
											}
										}
									}

									flowcontainer = {
										datacontext = "[HoldingView.GetProvince]"
										ignoreinvisible = yes
										spacing = 3

										### Supply Level
										flowcontainer = {
											tooltip = "[HoldingView.GetSupplyLimitTooltip]"
											layoutpolicy_horizontal = expanding
											spacing = 3

											text_single = {
												# layoutpolicy_horizontal = expanding
												text = "SUPPLY_LIMIT"
												default_format = "#high"
											}

											text_single = {
												raw_text = " [HoldingView.GetSupplyLimit|V]."
												default_format = "#high"
											}
										}
									}

									text_single = {
										visible = "[GreaterThan_CFixedPoint(Province.MakeScope.ScriptValue('armies_present_here'), '(CFixedPoint)0')]"
										raw_text = "Effective supply [GuiScope.SetRoot(HoldingView.GetProvince.MakeScope).AddScope('player', GetPlayer.MakeScope ).ScriptValue('supply_limit_true')], due to armies present."
									}
								}

								# holder
								flowcontainer = {
									visible = "[Not(HoldingView.GetHolding.IsEmpty)]"
									direction = vertical
									ignoreinvisible = yes

									#grant to
									button_text = {
										blockoverride "text" {
											raw_text = "Grant [Select_CString(HoldingView.GetProvince.GetTitle.IsCountyCapital, 'holding and county', 'holding')], hotkey V."
										}
										shortcut = "find_title_shortcut"
										onclick = "[HoldingView.ToggleFindVassalListWindow]"
										visible = "[And(And( ObjectsEqual( HoldingView.GetTitle.GetHolder, GetPlayer ), Not(HoldingView.GetTitle.IsLeasedOut) ), Not(HoldingView.GetProvince.IsRealmCapital))]"
									}

									container = {
										using = agot_county_view_is_not_ruin
										using = locr_county_not_wasteland
										flowcontainer = {
											visible = "[Not(Character.IsLocalPlayer)]"
											name = "theocracy_property"
											datacontext = "[HoldingView.GetTitle.GetLesseeOrHolder]"
											margin_left = 2
											ignoreinvisible = yes
											direction = vertical

											char_name = {
												blockoverride "pre" {
													spacing = 3
													text_single = {
														datacontext = "[HoldingView.GetTitle]"
														visible = "[Not(Title.IsLeasedOut)]"
														text = "HOLDING_VIEW_HOLDER"
													}

													text_single = {
														datacontext = "[HoldingView.GetTitle]"
														visible = "[Title.IsLeasedOut]"
														text = "HOLDING_VIEW_LESSEE"
													}
												}
												blockoverride "extra" {

													text_single = {
														raw_text = "[Character.RealmSize] counties."
													}
												}
											}

											text_single = {
												layoutpolicy_horizontal = expanding
												visible = "[Character.IsIndependentRuler]"
												raw_text = "Independent."
											}

											button_text = {
												using = char_click
												visible = "[Character.HasRelationTo( GetPlayer )]"
												tooltip = "EXTENDED_RELATIONS_TOOLTIP"
												blockoverride "text" {
													raw_text = "[Character.GetRelationToString( GetPlayer )]."
												}
											}

											button_text = {
												using = char_click
												visible = "[And(Character.HasLiege, Not(Character.GetLiege.IsLocalPlayer))]"
												tooltip = "EXTENDED_RELATIONS_TOOLTIP"

												blockoverride "text" {
													raw_text = "[Character.GetRelationToString( Character.GetLiege )]."
												}
											}

											flowcontainer = {
												layoutpolicy_horizontal = expanding

												container = {
													name = "revoke_lease_button"
													datacontext = "[HoldingView.GetTitle]"
													visible = "[Title.IsLeasedOut]"

													button_text = {
														blockoverride "text" {
															raw_text = "Revoke lease"
															align = left
														}
														blockoverride "extra" {
															text_single = {
																raw_text = ", disabled"
																visible = "[Not(Character.IsPlayerInteractionWithTargetTitleValid('revoke_leased_title_interaction', Title.Self))]"
															}
														}
														blockoverride "dot" { }
														datacontext = "[Title.GetLessee]"
														visible = "[And( Or(Title.GetHolder.IsLocalPlayer, Title.GetHolder.IsOtherLiegeOrAbove( GetPlayer )), Character.IsPlayerInteractionShownAndCanPickTitle('revoke_leased_title_interaction', Title.Self) )]"
														enabled = "[Character.IsPlayerInteractionWithTargetTitleValid('revoke_leased_title_interaction', Title.Self)]"
														tooltip = "[Character.GetPlayerInteractionWithTargetTitleTooltip('revoke_leased_title_interaction', Title.Self)]"
														onclick = "[Character.OpenPlayerInteractionWithTargetTitle('revoke_leased_title_interaction', Title.Self)]"
													}
												}

												text_single = {
													raw_text = "Church property."
													tooltip = "CHURCH_PROPERTY_TOOLTIP"
													datacontext = "[HoldingView.GetTitle]"
													visible = "[Title.IsUnderTheocraticLease]" #TODO
												}
											}
										}
									}

								}
							}
						}

						### buildings
						flowcontainer = {
							layoutpolicy_horizontal = expanding
							ignoreinvisible = yes
							direction = vertical

							flowcontainer = {
								@building_width = 500
								@building_height = 45 # breaks things, need to redo the whole thing
								direction = vertical
								margin_top = 5
								visible = "[HoldingView.GetTitle.HasHolder]"

								button_text = {
									layoutpolicy_horizontal = expanding
									blockoverride "pre" {
										spacing = 3
										text_single = {
											raw_text = "Buildings,"
										}
										text_single = {
											visible = "[Not(GetVariableSystem.HasValue('holding_tabs', 'buildings'))]"
											raw_text = "hotkey E"
										}
									}
									onclick = "[GetVariableSystem.Set('holding_tabs', 'buildings')]"
									shortcut = map_mode_1
								}

								button = {
									datacontext = "[HoldingView.GetGUIHoldingBuilding]"
									parentanchor = right
									size = { @building_width @building_height }
									allow_outside = yes
									onclick = "[GUIBuildingItem.OnClick]"
									down = "[GUIBuildingItem.IsHighlighted]"
									enabled = "[GUIBuildingItem.IsBuildingButtonEnabled]"

									vbox = {
										# resizeparent = yes
										hbox = {
											layoutpolicy_horizontal = expanding
											spacing = 5
											text_single = {
												raw_text = "Main,"
											}

											text_single = {
												text = "[HoldingView.GetHolding.GetPrimaryBuildingType.GetTypeName]"
											}

											text_single = {
												visible = "[GUIBuildingItem.HasLevel]"
												raw_text = "level [GUIBuildingItem.GetCurrentOrConstrucingBuilding.GetLevel]."
											}

											text_single = {
												raw_text = "Tooltip."
												tooltip = "[GUIBuildingItem.GetTooltip]"
											}

											text_single = {
												raw_text = "Construction: [GUIBuildingItem.GetConstructingProgress|0]%."
												tooltip = "[GUIBuildingItem.GetTooltip]"
												visible = "[GUIBuildingItem.IsConstructing]"
											}

											text_single = {
												datacontext = "[HoldingView.GetHolder]"
												raw_text = "Wrong type for the holder."
												visible = "[And( Not( Holding.IsEmpty ), Not( Holding.IsValidForLesseeOrHolder ) )]"
												tooltip = HOLDING_VIEW_WRONG_HOLDING_TYPE
											}

											text_single = {
												raw_text = "Disabled."
												visible = "[And( ObjectsEqual( GUIBuildingItem.Self, Holding.Self ), GUIBuildingItem.IsBuildingDisabled )]"
											}
											expand = { }
										}

										### Fort Info

										hbox = {
											layoutpolicy_horizontal = expanding

											hbox = {
												tooltip = "[HoldingView.GetGarrisonTooltip]"
												visible = "[HoldingView.GetProvince.HasFort]"
												spacing = 3
												text_single = {
													raw_text = "Fort level [HoldingView.GetProvince.GetFortLevel]."
													tooltip = "[Province.GetFortLevelTooltip]"
												}

												text_single = {
													using = agot_county_view_is_not_ruin
													using = locr_county_not_wasteland
													raw_text = "Garrison: [HoldingView.GetCurrentGarrisonSize],"
												}

												text_single = {
													using = agot_county_view_is_not_ruin
													using = locr_county_not_wasteland
													raw_text = "[HoldingView.GetGarrisonRatio|0]% of total."
												}
											}

											expand = { }
										}

										expand = { }
									}
								}

								flowcontainer = {
									ignoreinvisible = yes

									text_single = {
										raw_text = "[GuiScope.SetRoot(HoldingView.GetProvince.MakeScope).ScriptValue('num_buildings_sval')] buildings"
									}

									text_single = {
										raw_text = ", [GuiScope.SetRoot(HoldingView.GetProvince.MakeScope).ScriptValue('free_building_slots_sval')] empty slots"
										visible = "[GreaterThan_CFixedPoint(GuiScope.SetRoot(HoldingView.GetProvince.MakeScope).ScriptValue('free_building_slots_sval'), '(CFixedPoint)0')]"
									}

									dot = { }


									# text_single = {
									# 	raw_text = "[GetDataModelSize(HoldingView.GetBuildings)] Common buildings slots:"
									# 	visible = "[EqualTo_CFixedPoint(HoldingView.GetProvince.MakeScope.ScriptValue('free_building_slots_sval'), '(CFixedPoint)0')]"
									# }
								}


								flowcontainer = {
									name = "buildings_grid_special"
									ignoreinvisible = yes
									direction = vertical

									# Upgrade buildings
									flowcontainer = {
										visible = "[Not(HoldingView.GetHolding.GetType.HasParameter('no_buildings'))]"
										name = "buildings_grid"
										datamodel = "[HoldingView.GetBuildings]"
										ignoreinvisible = yes
										direction = vertical
										spacing = 2

										item = {
											widget_building_text = {
												blockoverride "special" { }
											}
										}
									}

									flowcontainer = {
										visible = "[Or(HoldingView.HasDuchyCapitalBuildingSlot, HoldingView.HasSpecialBuildingSlot )]"
										# spacing = 3
										ignoreinvisible = yes
										direction = vertical

										flowcontainer = {
											ignoreinvisible = yes
											direction = vertical
											visible = "[Not(HoldingView.GetHolding.GetType.HasParameter('no_buildings'))]"

											text_single = {
												raw_text = "Duchy capital building:"
												datacontext = "[HoldingView.GetGUIDuchyCapitalBuilding]"
												visible = "[HoldingView.HasDuchyCapitalBuildingSlot]"
											}

											widget_building_text = {
												blockoverride "normal" { }
												name = "duchy_capital_building"
												datacontext = "[HoldingView.GetGUIDuchyCapitalBuilding]"
												visible = "[HoldingView.HasDuchyCapitalBuildingSlot]"
											}
										}


										text_single = {
											raw_text = "Special building:"
											datacontext = "[HoldingView.GetGUISpecialBuilding]"
											visible = "[HoldingView.HasSpecialBuildingSlot]"
										}

										widget_building_text = {
											blockoverride "normal" { }
											name = "special_building"
											datacontext = "[HoldingView.GetGUISpecialBuilding]"
											visible = "[HoldingView.HasSpecialBuildingSlot]"
										}

										# widget = {
										# 	# This is needed to offset the building slots correctly when special building slots exist.
										# 	name = "Conditional_margin_widget"
										# 	size = { 0 0 }
										# 	visible = "[HoldingView.HasSpecialBuildingSlot]"
										# }
									}
								}
							}
						}
					}

					vbox_locr_rhun_road = {}

					# selected tab
					button_text = {
						layoutpolicy_horizontal = expanding
						onclick = "[GetVariableSystem.Clear('county_tabs')]"
						visible = "[GetVariableSystem.Exists('county_tabs')]"
						using = close_window_ocr

						# blockoverride "extra" {
						# 	text_single = {
						# 		visible = "[GetVariableSystem.HasValue('county_tabs', 'holdings')]"
						# 		raw_text = "[GetDataModelSize(HoldingView.GetCountyTitle.MakeScope.GetList('county_holdings'))]"
						# 		margin_right = 3
						# 	}
						# 	text_single = {
						# 		raw_text = "[GetVariableSystem.Get('county_tabs')]"
						# 	}
						# 	text_single = {
						# 		raw_text = " in [HoldingView.GetCountyTitle.GetNameNoTierNoTooltip]."
						# 	}
						#
						# 	text_single = {
						# 		visible = "[GetVariableSystem.HasValue('county_tabs', 'holdings')]"
						# 		raw_text = " Can select with hotkeys."
						# 	}
						# }
					}

					button = {
						visible = "[GetVariableSystem.Exists('holding_tabs')]"
						using = close_window_ocr
						onclick = "[GetVariableSystem.Clear('holding_tabs')]"
					}

					button_text = {
						layoutpolicy_horizontal = expanding
						shortcut = map_mode_1
						visible = "[GetVariableSystem.HasValue('county_tabs', 'holdings')]"
						onclick = "[Toggle('holding_buildings')]"
						blockoverride "extra" {
							text_single = {
								raw_text = "Holdings of [HoldingView.GetCountyTitle.GetNameNoTierNoTooltip]."
							}
							text_single = {
								raw_text = "[Select_CString(Is('holding_buildings'), 'Show', 'Hide')] buildings, E."
							}
						}
					}

					dynamicgridbox = {
						visible = "[GetVariableSystem.HasValue('county_tabs', 'holdings')]"
						layoutpolicy_horizontal = expanding
						# datamodel_wrap = 5
						# flipdirection = yes
						datamodel = "[HoldingView.GetCountyTitle.MakeScope.GetList('county_holdings')]"

						item = {
							flowcontainer = {
								ignoreinvisible = yes
								direction = vertical

								button_text = {
									datacontext = "[Scope.GetProvince.GetHolding]"
									blockoverride "text" {
										raw_text = "[AddTextIf(Not(Holding.IsEmpty), Concatenate(Holding.GetPrimaryBuildingType.GetTypeName, ' '))][Holding.GetNameNoTooltip],"
									}
									blockoverride "pre" {
										spacing = 3
										text_single = {
											raw_text = "[Scope.GetProvince.MakeScope.Var('order').GetValue],"
											visible = "[LessThan_CFixedPoint(Scope.GetProvince.MakeScope.Var('order').GetValue, '(CFixedPoint)6')]"
										}
										text_single = {
											raw_text = "T,"
											visible = "[EqualTo_CFixedPoint(Scope.GetProvince.MakeScope.Var('order').GetValue, '(CFixedPoint)6')]"
										}
										text_single = {
											raw_text = "Y,"
											visible = "[EqualTo_CFixedPoint(Scope.GetProvince.MakeScope.Var('order').GetValue, '(CFixedPoint)7')]"
										}

										text_single = {
											visible = "[Scope.GetProvince.GetHolding.GetLesseeOrHolder.IsLocalPlayer]"
											raw_text = "Your"
										}
									}
									blockoverride "extra" {
										text_single = {
											raw_text = "[Scope.GetProvince.GetTerrain.GetName]."
										}
										text_single = {
											visible = "[Not(Holding.IsEmpty)]"
											raw_text = "[Scope.GetProvince.MakeScope.ScriptValue('num_buildings_sval')] buildings,"
										}
										text_single = {
											visible = "[Not(ObjectsEqual(MyCapital.Self, Province.Self))]"
											datacontext = "[Scope.GetProvince]"
											raw_text = "[DistanceTo(MyCapital, Province)|0] [DaysTo(MyCapital, Province)] [Direction(MyCapital, Province)]."
										}
									}
									onclick = "[OpenGameViewData('holding_view', Scope.GetProvince)]"
									onclick = "[DefaultOnCoatOfArmsRightClick(Scope.GetProvince.GetTitle.GetID)]"
									onclick = "[GetVariableSystem.Clear('county_tabs')]"

									button = {
										onclick = "[OpenGameViewData('holding_view', Scope.GetProvince)]"
										onclick = "[DefaultOnCoatOfArmsRightClick(Scope.GetProvince.GetTitle.GetID)]"
										shortcut = speed_1
										visible = "[EqualTo_CFixedPoint(Scope.GetProvince.MakeScope.Var('order').GetValue, '(CFixedPoint)1')]"
										onclick = "[GetVariableSystem.Clear('county_tabs')]"
									}
									button = {
										onclick = "[OpenGameViewData('holding_view', Scope.GetProvince)]"
										onclick = "[DefaultOnCoatOfArmsRightClick(Scope.GetProvince.GetTitle.GetID)]"
										shortcut = speed_2
										visible = "[EqualTo_CFixedPoint(Scope.GetProvince.MakeScope.Var('order').GetValue, '(CFixedPoint)2')]"
										onclick = "[GetVariableSystem.Clear('county_tabs')]"
									}
									button = {
										onclick = "[OpenGameViewData('holding_view', Scope.GetProvince)]"
										onclick = "[DefaultOnCoatOfArmsRightClick(Scope.GetProvince.GetTitle.GetID)]"
										shortcut = speed_3
										visible = "[EqualTo_CFixedPoint(Scope.GetProvince.MakeScope.Var('order').GetValue, '(CFixedPoint)3')]"
										onclick = "[GetVariableSystem.Clear('county_tabs')]"
									}
									button = {
										onclick = "[OpenGameViewData('holding_view', Scope.GetProvince)]"
										onclick = "[DefaultOnCoatOfArmsRightClick(Scope.GetProvince.GetTitle.GetID)]"
										shortcut = speed_4
										visible = "[EqualTo_CFixedPoint(Scope.GetProvince.MakeScope.Var('order').GetValue, '(CFixedPoint)4')]"
										onclick = "[GetVariableSystem.Clear('county_tabs')]"
									}
									button = {
										onclick = "[OpenGameViewData('holding_view', Scope.GetProvince)]"
										onclick = "[DefaultOnCoatOfArmsRightClick(Scope.GetProvince.GetTitle.GetID)]"
										shortcut = speed_5
										visible = "[EqualTo_CFixedPoint(Scope.GetProvince.MakeScope.Var('order').GetValue, '(CFixedPoint)5')]"
										onclick = "[GetVariableSystem.Clear('county_tabs')]"
									}
									button = {
										onclick = "[OpenGameViewData('holding_view', Scope.GetProvince)]"
										onclick = "[DefaultOnCoatOfArmsRightClick(Scope.GetProvince.GetTitle.GetID)]"
										shortcut = map_mode_4
										visible = "[EqualTo_CFixedPoint(Scope.GetProvince.MakeScope.Var('order').GetValue, '(CFixedPoint)6')]"
										onclick = "[GetVariableSystem.Clear('county_tabs')]"
									}
									button = {
										onclick = "[OpenGameViewData('holding_view', Scope.GetProvince)]"
										onclick = "[DefaultOnCoatOfArmsRightClick(Scope.GetProvince.GetTitle.GetID)]"
										shortcut = mapmode_duchies_secondary
										visible = "[EqualTo_CFixedPoint(Scope.GetProvince.MakeScope.Var('order').GetValue, '(CFixedPoint)7')]"
										onclick = "[GetVariableSystem.Clear('county_tabs')]"
									}
								}

								flowcontainer = {
									ignoreinvisible = yes
									spacing = 3
									visible = "[Isnt('holding_buildings')]"

									flowcontainer = {
										ignoreinvisible = yes
										spacing = 3
										datamodel = "[Scope.Province.MakeScope.GetList('buildings_ledger')]"
										visible = "[DataModelHasItems(Scope.Province.MakeScope.GetList('buildings_ledger'))]"

										item = {
											text_single = {
												raw_text = "[Localize(Concatenate('building_', Scope.GetFlagName))],"
											}
										}
									}

									flowcontainer = {
										ignoreinvisible = yes
										spacing = 3
										datamodel = "[Scope.Province.MakeScope.GetList('duchy_building_ledger')]"
										visible = "[DataModelHasItems(Scope.Province.MakeScope.GetList('duchy_building_ledger'))]"

										item = {
											text_single = {
												raw_text = "[Localize(Concatenate('building_', Scope.GetFlagName))],"
											}
										}
									}

									text_single = {
										visible = "[Scope.Var('special_building').IsSet]"
										raw_text = "[Localize(Concatenate('building_', Scope.Var('special_building').GetFlagName))],"
									}
								}

							}
						}
					}

					# county info
					vbox = {
						margin_left = 15
						visible = "[Or(Not(GetVariableSystem.Exists('county_tabs')), GetVariableSystem.HasValue('county_tabs', 'county'))]"
						layoutpolicy_horizontal = expanding

						button_text = {
							layoutpolicy_horizontal = expanding
							shortcut = map_mode_11
							onclick = "[GetVariableSystem.Set('county_tabs', 'county')]"
							blockoverride "text" {
								raw_text = "County info, Shift E."
							}
						}

						vbox = {
							datacontext = "[HoldingView.GetProvince.GetCountyCapitalProvince]"
							layoutpolicy_horizontal = expanding
							spacing = 5

							hbox = {
								layoutpolicy_horizontal = expanding
								spacing = 3
								using = locr_county_not_wasteland

								flowcontainer = {
									datacontext = "[County.GetFaith]"
									spacing = 5
									using = tooltip_ne

									tooltipwidget = {
										faith_tooltip = {
											blockoverride "extra_info" {
												using = faith_tooltip_click_default_extra_info

												text_single = {
													margin = { 10 0 }
													layoutpolicy_horizontal = expanding
													fonttintcolor = "[TooltipInfo.GetTintColor]"
													using = DefaultTooltipText
													visible = "[Not( ObjectsEqual( Faith.Self, GetPlayer.GetFaith ) )]"
													text = "COUNTY_NOT_YOUR_FAITH"
												}
											}
										}
									}

									button_group = {
										shortcut = "army_split_half"
										onclick = "[OpenGameViewData( 'faith', Faith.GetID )]"

										text_single = {
											raw_text = "[Faith.GetAdjective], F."
										}
									}
								}

								flowcontainer = {
									layoutpolicy_horizontal = expanding
									datacontext = "[County.GetCulture]"

									using = tooltip_ne

									button_text = {

										tooltipwidget = {
											culture_tooltip = {
												blockoverride "extra_info"
												{
													text_single = {
														visible = "[Not( ObjectsEqual( Culture.Self, GetPlayer.GetCulture ) )]"
														text = "COUNTY_NOT_YOUR_CULTURE"
													}
												}
											}
										}
										shortcut = character_finder
										onclick = "[OpenGameViewData( 'culture_window', Culture.GetID )]"
										blockoverride "extra" {
											text_single = {
												raw_text = "game_concept_culture"
											}

											comma = {}

											text_single = {
												raw_text = "CULTURE_COUNTY_WINDOW"
											}

											dot_l = {}

											text_single = {
												visible = "[NotEqualTo_uint32(Culture.GetID, GetPlayer.GetCulture.GetID)]"
												text = "COUNTY_CULTURE_ACCEPTANCE_DIFF_CULTURE"

												tooltip = "CULTURE_ACCEPTANCE_TOOLTIP"
											}
											text_single = {
												raw_text = ", C."
											}
										}
									}
								}
							}

							vbox = {
								layoutpolicy_horizontal = expanding

								datacontext = "[HoldingView.GetProvince.GetCounty]"
								datacontext = "[HoldingView.AccessCountyBreakdowns]"

								#resources
								flowcontainer = {
									ignoreinvisible = yes
									layoutpolicy_horizontal = expanding
									direction = vertical

									flowcontainer = {
										spacing = 3
										# layoutpolicy_horizontal = expanding
										datacontext = "[HoldingView.GetProvince.GetCounty]"
										# expand = { }

										text_single = {
											# layoutpolicy_horizontal = expanding
											raw_text = "[control|E]:"
										}

										text_single = {
											raw_text = "[County.GetControlLevel],"
											tooltipwidget = {
												county_control_tooltip_container = {}
											}
										}

										text_single = {
											datacontext = "[CountyDataBreakdowns.AccessControl( County.Self )]"
											visible = "[Or( LessThan_CFixedPoint(County.GetControl, '(CFixedPoint)100'), LessThan_CFixedPoint(ValueBreakdown.GetFixedPointValue, '(CFixedPoint)0') )]"
											raw_text = "[ValueBreakdown.GetValue] change."
											tooltip_visible = "[ValueBreakdown.HasTooltip]"
											tooltipwidget = {
												widget_value_breakdown_tooltip = {}
											}
										}
									}


									flowcontainer = {
										spacing = 3
										datacontext = "[County.GetCount.GetGovernment]"
										datacontext = "[CountyDataBreakdowns.AccessDevelopmentChange( County.Self )]"

										text_single = {
											raw_text = "[development|E]:"
										}

										text_single = {
											raw_text = "[County.GetDevelopmentLevel],"

											tooltipwidget = {
												county_development_tooltip_container = {}
											}
										}

										text_single = {

											raw_text = "[ValueBreakdown.GetValue] change."

											tooltip_visible = "[ValueBreakdown.HasTooltip]"

											tooltipwidget = {
												widget_value_breakdown_tooltip = {}
											}
										}

										text_single = {
											visible = "[Not(GovernmentType.IsAffectedByDevelopment)]"
											raw_text = "not applied in this government."
										}
									}
								}

								flowcontainer = {
									layoutpolicy_horizontal = expanding
									ignoreinvisible = yes
									direction = vertical
									using = locr_county_not_wasteland
									flowcontainer = {
										spacing = 3
										ignoreinvisible = yes

										text_single = {
											raw_text = "[county_opinion|E]:"
										}

										text_single = {
											datacontext = "[CountyDataBreakdowns.AccessOpinion( County.Self )]"

											raw_text = "[ValueBreakdown.GetValue]."

											tooltip_visible = "[ValueBreakdown.HasTooltip]"

											tooltipwidget = {
												widget_value_breakdown_tooltip = {}
											}
										}

										button_text = {
											blockoverride "text" {
												margin_left = -3
												raw_text = "In a faction!"
											}
											visible = "[HoldingView.IsInFaction]"
											onclick = "[HoldingView.OnGotoFaction]"
											tooltip = "COUNTY_IN_FACTION_TOOLTIP"
										}
									}
								}
							}

							vbox = {
								visible = "[Not( IsDataModelEmpty(HoldingView.GetCountyModifiers))]"
								layoutpolicy_horizontal = expanding
								text_single = {
									layoutpolicy_horizontal = expanding
									raw_text = "[GetDataModelSize(HoldingView.GetCountyModifiers)] County modifiers:"
								}

								dynamicgridbox = {
									datamodel_wrap = 3
									datamodel = "[HoldingView.GetCountyModifiers]"

									item = {
										modifier_item_ocr = {}
									}
									layoutpolicy_horizontal = expanding
								}
							}
						}

						vbox = {
							layoutpolicy_horizontal = expanding
							datacontext = "[HoldingView.GetCountyTitle.GetHolder]"
							visible = "[And(GetVariableSystem.HasValue('county_tabs', 'county'), Not(Character.IsLocalPlayer))]"

							char_name = {
								layoutpolicy_horizontal = expanding
								blockoverride "pre" {
									spacing = 3
									text_single = {
										raw_text = "Holder,"
									}
								}
								blockoverride "extra" {

									text_single = {
										raw_text = "[Character.RealmSize] counties."
									}
								}
							}

							text_single = {
								layoutpolicy_horizontal = expanding
								visible = "[Character.IsIndependentRuler]"
								raw_text = "Independent."
							}

							button_text = {
								layoutpolicy_horizontal = expanding
								using = char_click
								visible = "[Character.HasRelationTo( GetPlayer )]"
								tooltip = "EXTENDED_RELATIONS_TOOLTIP"
								blockoverride "text" {
									raw_text = "[Character.GetRelationToString( GetPlayer )]."
								}
							}

							button_text = {
								layoutpolicy_horizontal = expanding
								using = char_click
								visible = "[And(Character.HasLiege, Not(Character.GetLiege.IsLocalPlayer))]"
								tooltip = "EXTENDED_RELATIONS_TOOLTIP"

								blockoverride "text" {
									raw_text = "[Character.GetRelationToString( Character.GetLiege )]."
								}
							}
						}

						button_text = {
							layoutpolicy_horizontal = expanding
							onclick = "[DefaultOnCoatOfArmsRightClick(HoldingView.GetProvince.GetCoATitle.GetID)]"
							onclick = "[PdxGuiTriggerAllAnimations('adjacent_counties')]"
							blockoverride "text" {
								raw_text = "Pan camera here and refresh, Shift Q."
							}
							shortcut = map_mode_9
						}

						expand = { }
					}

					# tasks
					vbox = {
						layoutpolicy_horizontal = expanding
						visible = "[GetVariableSystem.HasValue('county_tabs', 'tasks')]"


						# tasks
						vbox = {
							layoutpolicy_horizontal = expanding
							margin = { 0 5 }
							margin_left = 20
							spacing = 5

							# active
							vbox = {
								layoutpolicy_horizontal = expanding
								datacontext = "[HoldingView.GetCountyTitle]"
								visible = "[GetScriptedGui('any_task_active').IsShown( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('target_character', HoldingView.GetCountyTitle.GetHolder.MakeScope).AddScope('county', Title.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End )]"

								hbox = {
									layoutpolicy_horizontal = expanding
									spacing = 3

									text_single = {
										raw_text = "[GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('target_character', HoldingView.GetCountyTitle.GetHolder.MakeScope).AddScope('county', Title.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).ScriptValue('active_tasks')]"
									}

									text_single = {
										raw_text = "Active tasks,"
									}
									expand = { }
								}

								vbox = {
									layoutpolicy_horizontal = expanding
									visible = "[Character.IsValid]"
									datacontext = "[GetPlayer.GetCouncillor('councillor_court_chaplain')]"

									active_task_hbox = {
										datacontext = "[GetScriptedGui('is_fabricating_claim')]"

										blockoverride "task" {
											raw_text = "Fabricating a claim,"
										}
									}

									active_task_hbox = {
										datacontext = "[GetPlayer.GetCouncillor('councillor_court_chaplain')]"
										datacontext = "[GetScriptedGui('is_converting_faith')]"
									}
								}

								vbox = {
									layoutpolicy_horizontal = expanding
									visible = "[Character.IsValid]"
									datacontext = "[GetPlayer.GetCouncillor('councillor_chancellor')]"

									active_task_hbox = {
										datacontext = "[GetScriptedGui('is_integrating_title')]"

										blockoverride "task" {
											raw_text = "Integrating [Title.GetName],"
										}
										blockoverride "skill" {
											raw_text = "[Character.GetSkill('diplomacy')] diplomacy."
										}
									}
									active_court_task_hbox = {
										datacontext = "[GetScriptedGui('is_bestowing_favor')]"

										blockoverride "task" {
											raw_text = "Bestowing favor on [HoldingView.GetCountyTitle.GetHolder.GetFirstNameNoTooltip], opinion [HoldingView.GetCountyTitle.GetHolder.GetOpinionOf( GetPlayer )]."
										}
										blockoverride "skill" {
											raw_text = "[Character.GetSkill('diplomacy')] diplomacy."
										}
									}
								}

								vbox = {
									layoutpolicy_horizontal = expanding
									visible = "[Character.IsValid]"
									datacontext = "[GetPlayer.GetCouncillor('councillor_marshal')]"

									active_task_hbox = {
										datacontext = "[GetScriptedGui('is_increasing_control')]"

										blockoverride "task" {
											raw_text = "Increasing control, currently [HoldingView.GetCountyTitle.GetCountyData.GetControlLevel|0]."
										}
										blockoverride "skill" {
											raw_text = "[Character.GetSkill('martial')] martial."
										}
									}

									# debug
									button_text = {
										visible = no
										datacontext = "[GetPlayer.GetCouncillor('councillor_marshal')]"
										layoutpolicy_horizontal = expanding
										onclick = "[GetScriptedGui('finish_task').Execute( GuiScope.SetRoot( Character.MakeScope ).End )]"
										blockoverride "text" {
											raw_text = "Finish marshal's task"
										}
									}
								}

								vbox = {
									layoutpolicy_horizontal = expanding
									visible = "[Character.IsValid]"
									datacontext = "[GetPlayer.GetCouncillor('councillor_steward')]"

									active_task_hbox = {
										datacontext = "[GetScriptedGui('is_developing')]"

										blockoverride "task" {
											datacontext = "[CountyDataBreakdowns.AccessDevelopmentChange( County.Self )]"
											raw_text = "Developing, currently [County.GetDevelopmentLevel], [ValueBreakdown.GetValue] change."
											tooltip_visible = "[ValueBreakdown.HasTooltip]"
											tooltipwidget = {
												widget_value_breakdown_tooltip = {}
											}
										}
										blockoverride "skill" {
											raw_text = "[Character.GetSkill('stewardship')] stewardship."
										}
									}

									active_task_hbox = {
										datacontext = "[GetScriptedGui('is_promoting')]"

										blockoverride "task" {
											raw_text = "Promoting [GetPlayer.GetCulture.GetNameNoTooltip] culture,"
										}
										blockoverride "skill" {
											raw_text = "[Character.GetSkill('stewardship')] stewardship."
										}
									}

									active_task_hbox = {
										datacontext = "[GetScriptedGui('is_accepting')]"

										blockoverride "task" {
											raw_text = "Increasing [Title.GetCountyData.GetCulture.GetNameNoTooltip] acceptance, currently [Title.GetCountyData.GetCulture.GetAcceptance( GetPlayer.GetCulture )|0]%"
										}
										blockoverride "skill" {
											raw_text = "[Character.GetSkill('stewardship')] stewardship"
										}
									}

									active_task_hbox = {
										datacontext = "[GetScriptedGui('is_convincing_de_jure')]"

										blockoverride "task" {
											raw_text = "Convincing to join de jure liege."
										}
										blockoverride "skill" {
											raw_text = "[Character.GetSkill('stewardship')] stewardship"
										}
									}

									# debug
									button_text = {
										visible = no
										layoutpolicy_horizontal = expanding
										onclick = "[GetScriptedGui('finish_task').Execute( GuiScope.SetRoot( Character.MakeScope ).End )]"
										blockoverride "text" {
											raw_text = "Finish task"
										}
									}
								}

								vbox = {
									layoutpolicy_horizontal = expanding
									visible = "[Character.IsValid]"
									datacontext = "[GetPlayer.GetCouncillor('councillor_spymaster')]"

									active_court_task_hbox = {
										datacontext = "[GetScriptedGui('is_searching_for_secrets')]"

										blockoverride "task" {
											raw_text = "Finding secrets in [HoldingView.GetCountyTitle.GetHolder.GetFirstNamePossessiveOrMyNoTooltip] court."
										}
									}
								}

								# debug
								button_text = {
									visible = no
									datacontext = "[GetPlayer.GetCouncillor('councillor_court_chaplain')]"
									layoutpolicy_horizontal = expanding
									onclick = "[GetScriptedGui('finish_task').Execute( GuiScope.SetRoot( Character.MakeScope ).End )]"
									blockoverride "text" {
										raw_text = "Finish chaplain's task"
									}
								}
							}

							button_text = {
								layoutpolicy_horizontal = expanding
								blockoverride "text" {
									raw_text = "Grant [Select_CString(HoldingView.GetProvince.GetTitle.IsCountyCapital, 'holding and county', 'holding')], hotkey V."
								}
								shortcut = "find_title_shortcut"
								onclick = "[HoldingView.ToggleFindVassalListWindow]"
								visible = "[And(And( ObjectsEqual( HoldingView.GetTitle.GetHolder, GetPlayer ), Not(HoldingView.GetTitle.IsLeasedOut) ), Not(HoldingView.GetProvince.IsRealmCapital))]"
							}

							# available
							vbox = {
								layoutpolicy_horizontal = expanding

								datacontext = "[HoldingView.GetCountyTitle]"

								#TODO number of tasks and hide if none. Annoying to do because we need to account for whether a task is valid and not performed right now

								text_single = {
									layoutpolicy_horizontal = expanding
									raw_text = "Available tasks,"
								}

								vbox = {
									layoutpolicy_horizontal = expanding
									datacontext = "[GetPlayer.GetCouncillor('councillor_court_chaplain')]"
									visible = "[Character.IsValid]"

									county_task_button = {
										datacontext = "[GetScriptedGui('fabricate_claim_button')]"

										blockoverride "text" {
											alwaystransparent = yes
											raw_text = "Fabricate claim."
										}
									}

									county_task_button = {
										datacontext = "[GetScriptedGui('convert_faith_button')]"

										blockoverride "text" {
											alwaystransparent = yes
											raw_text = "Convert [Title.GetCountyData.GetFaith.GetAdjective] faith."
										}
									}
								}

								vbox = {
									layoutpolicy_horizontal = expanding
									datacontext = "[GetPlayer.GetCouncillor('councillor_chancellor')]"
									visible = "[Character.IsValid]"

									county_task_button = {
										datacontext = "[GetScriptedGui('task_integrate_title')]"

										blockoverride "text" {
											alwaystransparent = yes
											raw_text = "Integrate [Title.GetNameNoTierNoTooltip] into [GetPlayer.GetPrimaryTitle.GetNameNoTierNoTooltip]."
										}
									}

									court_task_button = {
										datacontext = "[GetScriptedGui('task_bestow_royal_favor')]"

										blockoverride "text" {
											alwaystransparent = yes
											raw_text = "Bestow favor on [HoldingView.GetCountyTitle.GetHolder.GetFirstNameNoTooltip], opinion [HoldingView.GetCountyTitle.GetHolder.GetOpinionOf( GetPlayer )]."
										}
									}
								}

								vbox = {
									layoutpolicy_horizontal = expanding
									datacontext = "[GetPlayer.GetCouncillor('councillor_marshal')]"
									visible = "[Character.IsValid]"
									datacontext = "[HoldingView.AccessCountyBreakdowns]"

									county_task_button = {
										datacontext = "[GetScriptedGui('task_increase_control')]"

										blockoverride "text" {
											alwaystransparent = yes
											raw_text = "Increase control,"
										}
										blockoverride "extra" {
											spacing = 3
											text_single = {
												datacontext = "[CountyDataBreakdowns.AccessControl( County.Self )]"
												visible = "[LessThan_CFixedPoint(Title.GetCountyData.GetControl, '(CFixedPoint)100')]"
												raw_text = "currently at [Title.GetCountyData.GetControlLevel], [ValueBreakdown.GetValue] change."
												tooltip_visible = "[ValueBreakdown.HasTooltip]"
												tooltipwidget = {
													widget_value_breakdown_tooltip = {}
												}
											}
											text_single = {
												visible = "[GetScriptedGui('has_county_corruption_trigger_sgui').IsShown( GuiScope.SetRoot( HoldingView.GetCountyTitle.MakeScope ).End )]"
												raw_text = "County has corruption modifiers."
											}
										}
									}
								}

								vbox = {
									layoutpolicy_horizontal = expanding
									datacontext = "[GetPlayer.GetCouncillor('councillor_steward')]"
									visible = "[Character.IsValid]"
									datacontext = "[County.GetCount.GetGovernment]"
									datacontext = "[HoldingView.AccessCountyBreakdowns]"

									county_task_button = {
										datacontext = "[GetScriptedGui('task_develop_county')]"

										blockoverride "text" {
											alwaystransparent = yes
											datacontext = "[CountyDataBreakdowns.AccessDevelopmentChange( County.Self )]"
											raw_text = "Increase development, currently [County.GetDevelopmentLevel], [ValueBreakdown.GetValue] change."
											tooltip_visible = "[ValueBreakdown.HasTooltip]"
											tooltipwidget = {
												widget_value_breakdown_tooltip = {}
											}
										}
									}
									county_task_button = {
										datacontext = "[GetScriptedGui('task_promote_culture')]"

										blockoverride "text" {
											alwaystransparent = yes
											raw_text = "Promote [GetPlayer.GetCulture.GetNameNoTooltip] culture over [Title.GetCountyData.GetCulture.GetNameNoTooltip]."
										}
									}
									county_task_button = {
										datacontext = "[GetScriptedGui('task_accept_culture')]"

										blockoverride "text" {
											alwaystransparent = yes
											raw_text = "Accept [Title.GetCountyData.GetCulture.GetNameNoTooltip] culture."
										}
									}

									county_task_button = {
										datacontext = "[GetScriptedGui('task_convince_dejure')]"

										blockoverride "text" {
											alwaystransparent = yes
											raw_text = "Convince to join de jure liege, [Title.GetDeJureLiege.GetHolder.GetNameNoTooltip]."
										}
									}
								}

								vbox = {
									layoutpolicy_horizontal = expanding
									datacontext = "[GetPlayer.GetCouncillor('councillor_spymaster')]"
									visible = "[Character.IsValid]"

									court_task_button = {
										datacontext = "[GetScriptedGui('task_find_secrets')]"

										blockoverride "text" {
											alwaystransparent = yes
											raw_text = "Find secrets in [HoldingView.GetCountyTitle.GetHolder.GetFirstNamePossessiveOrMyNoTooltip] court."
										}
									}
								}
							}

							vbox = {
								layoutpolicy_horizontal = expanding

								# button_agot_abandon_ruin = {}

								button_text = {
									layoutpolicy_horizontal = expanding
									blockoverride "text" {
										raw_text = "Make realm capital."
									}
									blockoverride "disabled" {
										visible = "[Not(HoldingView.CanSetRealmCapital)]"
									}
									enabled = "[HoldingView.CanSetRealmCapital]"
									visible = "[HoldingView.PotentialSetRealmCapital]"
									onclick = "[HoldingView.SetRealmCapital]"
									tooltip = "[HoldingView.GetSetRealmCapitalTooltip]"
								}

								button_text = {
									layoutpolicy_horizontal = expanding

									shortcut = mapmode_empires_secondary
									blockoverride "text" {
										raw_text = "[Select_CString(ShowAdd('is_in_outliner', GetPlayer, HoldingView.GetProvince), 'Unpin from', 'Pin to')] outliner, hotkey O."
									}
									onclick = "[ClickAdd('add_province_to_outliner', GetPlayer, HoldingView.GetProvince)]"
								}


								button_text = {
									layoutpolicy_horizontal = expanding
									blockoverride "text" {
										raw_text = "Rename holding."
									}
									visible = "[HoldingView.GetProvince.GetTitle.CanPlayerCustomizeTitle]"
									onclick = "[OpenTitleCustomizationWindow(HoldingView.GetProvince.GetTitle)]"
								}

								button_text = {
									layoutpolicy_horizontal = expanding
									visible = "[HoldingView.GetCountyTitle.CanPlayerCustomizeTitle]"
									onclick = "[OpenTitleCustomizationWindow(HoldingView.GetCountyTitle)]"
									blockoverride "text" {
										raw_text = "Rename county."
									}
								}

								# button_text = {
								# 	layoutpolicy_horizontal = expanding
								# 	onclick = "[DefaultOnCoatOfArmsClick(HoldingView.GetCountyTitle.GetID)]"
								# 	blockoverride "text" {
								# 		raw_text = "Open title window."
								# 	}
								# }

								text_single = {
									layoutpolicy_horizontal = expanding
									raw_text = "Settings:"
								}

								button_text = {
									layoutpolicy_horizontal = expanding
									onclick = "[GetScriptedGui('show_coordinates').Execute( GuiScope.SetRoot( GetPlayer.MakeScope ).End )]"
									blockoverride "text" {
										raw_text = "[Select_CString( GetPlayer.MakeScope.Var('show_coordinates').IsSet, 'Checked', 'Unchecked')], Show coordinates."
									}
								}
							}
						}
					}

					#navigation
					vbox = {
						layoutpolicy_horizontal = expanding
						visible = "[GetVariableSystem.HasValue('county_tabs', 'adjacent counties')]"
						spacing = 5

						button = {
							onclick = "[DefaultOnCoatOfArmsRightClick(HoldingView.GetProvince.GetCoATitle.GetID)]"
							onclick = "[PdxGuiTriggerAllAnimations('adjacent_counties')]"
							shortcut = map_mode_9
						}

						hbox = {
							layoutpolicy_horizontal = expanding
							spacing = 3
							margin_bottom = 5

							text_single = {
								raw_text = "[HoldingView.GetProvince.GetCoATitle.GetNameNoTierNoTooltip],"
							}

							text_single = {
								datacontext = "[HoldingView.GetProvince]"
								visible = "[Not(ObjectsEqual(HoldingView.GetProvince, GetPlayer.GetCapitalLocation))]"
								raw_text = "[DistanceTo(MyCapital, Province)|0] [DaysTo(MyCapital, Province)] [Direction(MyCapital, Province)],"
							}

							text_single = {
								raw_text = "held by [HoldingView.GetCountyTitle.GetHolder.GetFirstNameOrMeNoTooltip],"
							}

							hbox = {
								spacing = 3
								visible = "[Not(Character.IsLocalPlayer)]"
								datacontext = "[HoldingView.GetCountyTitle.GetHolder]"

								text_single = {
									visible = "[ObjectsEqual(Character.Self, Character.GetTopLiege)]"
									raw_text = "of"
								}

								text_single = {
									visible = "[Not(ObjectsEqual(Character.Self, Character.GetTopLiege))]"
									raw_text = "in"
								}
								text_single = {
									raw_text = "[HoldingView.GetCountyTitle.GetHolder.GetTopLiege.GetPrimaryTitle.GetNameNoTierNoTooltip]."
								}
							}


							text_single = {
								raw_text = "Adjacencies:"
							}

							expand = {}
						}

						vbox = {
							layoutpolicy_horizontal = expanding
							datacontext = "[HoldingView.GetCountyTitle]"

							hbox = {
								layoutpolicy_horizontal = expanding

								button_text = {
									shortcut = character_finder
									onclick = "[Toggle('culture_counties')]"
									blockoverride "pre" {
										text_single = {
											visible = "[Isnt('culture_counties')]"
											raw_text = "Not"
										}
									}
									blockoverride "text" {
										raw_text = "showing culture and faith, C."
									}
								}

								button_text = {
									shortcut = increase_speed_2
									onclick = "[AddFlag('sgui_flag', 'close_adjacencies')]"
									blockoverride "pre" {
										text_single = {
											raw_text = "Will"
										}
										text_single = {
											visible = "[ShowAddFlag('sgui_flag', 'close_adjacencies')]"
											raw_text = "not"
										}
									}
									blockoverride "text" {
										raw_text = "close on selection, X."
									}
								}

								expand = {}
							}

							vbox = {
								layoutpolicy_horizontal = expanding
								visible = "[And(Or(DataModelHasItems(Title.MakeScope.GetList('adjacent_rivers')), DataModelHasItems(Title.MakeScope.GetList('adjacent_seas'))), Isnt('adjacent_counties_ring'))]"

								button_text = {
									visible = "[Is('county_seas')]"
									layoutpolicy_horizontal = expanding
									onclick = "[Toggle('county_seas')]"
									shortcut = map_mode_1
									blockoverride "text" {
										raw_text = "Show seas and rivers, E."
									}
								}
								button_text = {
									visible = "[Isnt('county_seas')]"
									layoutpolicy_horizontal = expanding
									onclick = "[Toggle('county_seas')]"
									shortcut = map_mode_1
									blockoverride "text" {
										raw_text = "Hide seas and rivers, hotkey E."
									}
								}
							}
							vbox = {
								layoutpolicy_horizontal = expanding
								visible = "[And(Isnt('county_seas'), Isnt('adjacent_counties_ring'))]"
								# seas
								vbox = {
									visible = "[DataModelHasItems(Title.MakeScope.GetList('adjacent_seas'))]"
									layoutpolicy_horizontal = expanding
									button_text = {
										layoutpolicy_horizontal = expanding
										blockoverride "text" {
											raw_text = "[GetDataModelSize(Title.MakeScope.GetList('adjacent_seas'))] seas,"
										}
									}

									vbox = {
										layoutpolicy_horizontal = expanding

										datamodel = "[Title.MakeScope.GetList('adjacent_seas')]"
										item = {
											button_sea = {
												layoutpolicy_horizontal = expanding
											}
										}
									}
								}
								# rivers
								vbox = {
									visible = "[DataModelHasItems(Title.MakeScope.GetList('adjacent_rivers'))]"
									layoutpolicy_horizontal = expanding

									button_text = {
										layoutpolicy_horizontal = expanding
										blockoverride "text" {
											raw_text = "[GetDataModelSize(Title.MakeScope.GetList('adjacent_rivers'))] rivers,"
										}
									}

									vbox = {
										layoutpolicy_horizontal = expanding

										datamodel = "[Title.MakeScope.GetList('adjacent_rivers')]"
										item = {
											button_sea = {
												layoutpolicy_horizontal = expanding
											}
										}
									}
								}
							}
						}

						hbox = {
							layoutpolicy_horizontal = expanding
							spacing = 3

							button_text = {
								visible = "[GetPlayer.MakeScope.Var('county_direction').IsSet]"
								shortcut = map_mode_9
								onclick = "[GetScriptedGui('adjacent_counties').Execute( GuiScope.SetRoot( HoldingView.GetCountyTitle.MakeScope ).AddScope( 'player', GetPlayer.MakeScope).AddScope('target', HoldingView.GetProvince.MakeScope).AddScope('clear_direction', MakeScopeFlag('yes')).End )]"
								onclick = "[DefaultOnCoatOfArmsRightClick(HoldingView.GetProvince.GetCoATitle.GetID)]"
								blockoverride "text" {
									raw_text = "[GetPlayer.MakeScope.Var('county_direction').GetFlagName] direction, reset with Shift Q."
								}
							}

							text_single = {
								raw_text = "Filter by direction with Shift WASD."
							}

							expand = {}
						}


						button = {
							# shift w
							shortcut = map_mode_10
							onclick = "[GetScriptedGui('adjacent_counties').Execute( GuiScope.SetRoot( HoldingView.GetCountyTitle.MakeScope ).AddScope( 'player', GetPlayer.MakeScope).AddScope('target', HoldingView.GetProvince.MakeScope).AddScope('direction', MakeScopeFlag('north')).End )]"
						}

						button = {
							# shift a
							shortcut = mapmode_faith_secondary
							onclick = "[GetScriptedGui('adjacent_counties').Execute( GuiScope.SetRoot( HoldingView.GetCountyTitle.MakeScope ).AddScope( 'player', GetPlayer.MakeScope).AddScope('target', HoldingView.GetProvince.MakeScope).AddScope('direction', MakeScopeFlag('west')).End )]"
						}

						button = {
							# shift s
							shortcut = mapmode_culture_secondary
							onclick = "[GetScriptedGui('adjacent_counties').Execute( GuiScope.SetRoot( HoldingView.GetCountyTitle.MakeScope ).AddScope( 'player', GetPlayer.MakeScope).AddScope('target', HoldingView.GetProvince.MakeScope).AddScope('direction', MakeScopeFlag('south')).End )]"
						}

						button = {
							# shift d
							shortcut = mapmode_house_secondary
							onclick = "[GetScriptedGui('adjacent_counties').Execute( GuiScope.SetRoot( HoldingView.GetCountyTitle.MakeScope ).AddScope( 'player', GetPlayer.MakeScope).AddScope('target', HoldingView.GetProvince.MakeScope).AddScope('direction', MakeScopeFlag('east')).End )]"
						}

						container = {
							# button = {
							# 	shortcut = map_mode_6
							# 	onclick = "[Clear('county_tabs')]"
							# }

							button = {
								using = close_window_ocr
								visible = "[Is('adjacent_counties_ring')]"
								onclick = "[Clear('adjacent_counties_ring')]"
							}

							button = {
								shortcut = speed_1
								onclick = "[Set('adjacent_counties_ring', '1')]"
							}

							button = {
								shortcut = speed_2
								onclick = "[Set('adjacent_counties_ring', '2')]"
							}
							button = {
								shortcut = speed_3
								onclick = "[Set('adjacent_counties_ring', '3')]"
							}
							button = {
								visible =  "[Not(IsDataModelEmpty(HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_counties_across_water')))]"
								shortcut = map_mode_11
								onclick = "[Set('adjacent_counties_ring', 'across_water')]"
							}
						}


						hbox = {
							spacing = 3
							layoutpolicy_horizontal = expanding
							visible = "[Or(Isnt('adjacent_counties_ring'), Has('adjacent_counties_ring', '1'))]"

							button_text = {
								blockoverride "text" {
									raw_text = "  [GetDataModelSize(HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_counties'))] counties."
								}
								onclick = "[GetScriptedGui('adjacent_counties').Execute( GuiScope.SetRoot( HoldingView.GetCountyTitle.MakeScope ).AddScope( 'player', GetPlayer.MakeScope).AddScope('target', HoldingView.GetProvince.MakeScope).End )]"
							}
							expand = { }
						}

						state = {
							on_start = "[GetScriptedGui('adjacent_counties').Execute( GuiScope.SetRoot( HoldingView.GetCountyTitle.MakeScope ).AddScope( 'player', GetPlayer.MakeScope).AddScope('target', HoldingView.GetProvince.MakeScope).End )]"
							trigger_when = "[IsDataModelEmpty(HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_counties'))]"
						}


						vbox = {
							layoutpolicy_horizontal = expanding
							visible = "[Or(Isnt('adjacent_counties_ring'), Has('adjacent_counties_ring', '1'))]"

							datamodel = "[HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_counties')]"

							item = {
								adjacent_county_button = {
									layoutpolicy_horizontal = expanding
								}
							}
						}

						button_text = {
							shortcut = speed_2
							layoutpolicy_horizontal = expanding
							visible = "[Or(Isnt('adjacent_counties_ring'), Hasnt('adjacent_counties_ring', '3'))]"
							onclick = "[Set('adjacent_counties_ring', '2')]"
							blockoverride "text" {
								raw_text = "[GetDataModelSize(HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_counties_2'))] counties in the second ring, hotkey 2."
							}
						}

						vbox = {
							layoutpolicy_horizontal = expanding
							visible = "[Or(Isnt('adjacent_counties_ring'), Has('adjacent_counties_ring', '2'))]"
							# visible = "[Has('adjacent_counties_ring', '2')]"

							datamodel = "[HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_counties_2')]"

							item = {
								adjacent_county_button = {
									layoutpolicy_horizontal = expanding
									blockoverride "county_distance" {}
								}
							}
						}

						button_text = {
							shortcut = speed_3
							layoutpolicy_horizontal = expanding
							onclick = "[Set('adjacent_counties_ring', '3')]"
							blockoverride "text" {
								raw_text = "[GetDataModelSize(HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_counties_3'))] counties in the third ring, hotkey 3."
							}
						}

						vbox = {
							layoutpolicy_horizontal = expanding
							visible = "[Or(Isnt('adjacent_counties_ring'), Has('adjacent_counties_ring', '3'))]"
							# visible = "[Has('adjacent_counties_ring', '3')]"

							datamodel = "[HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_counties_3')]"

							item = {
								adjacent_county_button = {
									layoutpolicy_horizontal = expanding
									blockoverride "county_distance" {}
								}
							}
						}

						vbox = {
							visible =  "[Not(IsDataModelEmpty(HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_counties_across_water')))]"
							layoutpolicy_horizontal = expanding

							button = {
								size = { 400 22 }
								layoutpolicy_horizontal = expanding
								shortcut = map_mode_11
								onclick = "[Set('adjacent_counties_ring', 'across_water')]"

								flowcontainer = {
									ignoreinvisible = yes
									spacing = 5
									background = { using = Background_Area_Border_Solid }

									text_single = {
										layoutpolicy_horizontal = expanding
										raw_text = "  [GetDataModelSize(HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_counties_across_water'))] Across"
									}

									text_single = {
										raw_text = "sea,"
										visible = "[GetScriptedGui('is_coastal_county').IsShown( GuiScope.SetRoot( HoldingView.GetCountyTitle.MakeScope ).End )]"
									}
									text_single = {
										raw_text = "river,"
										visible = "[GetScriptedGui('is_riverside_county').IsShown( GuiScope.SetRoot( HoldingView.GetCountyTitle.MakeScope ).End )]"
									}
									text_single = {
										raw_text = "sea or river,"
										visible = "[GetScriptedGui('is_river_and_coastal').IsShown( GuiScope.SetRoot( HoldingView.GetCountyTitle.MakeScope ).End )]"
									}

									text_single = {
										raw_text = "Shift E."
									}
								}
							}

							dynamicgridbox = {
								layoutpolicy_horizontal = expanding
								visible = "[Or(Isnt('adjacent_counties_ring'), Has('adjacent_counties_ring', 'across_water'))]"
								datamodel = "[HoldingView.GetCountyTitle.MakeScope.GetList('adjacent_counties_across_water')]"

								item = {
									adjacent_county_button = {
										blockoverride "county_distance" {}
									}
								}
							}
						}
					}

					vbox = {
						layoutpolicy_horizontal = expanding
						margin_top = 5
						margin_left = 10
						visible = "[Not(GetVariableSystem.HasValue('county_tabs', 'holdings'))]"
						alpha = "[Select_float( GetVariableSystem.Exists('county_tabs'), '(float)0', '(float)1' )]"

						# holdings
						button_text = {
							layoutpolicy_horizontal = expanding
							onclick = "[GetVariableSystem.Set('county_tabs', 'holdings')]"
							shortcut = army_create_new
							blockoverride "text" {
								raw_text = "View [GetDataModelSize(HoldingView.GetCountyTitle.MakeScope.GetList('county_holdings'))] Holdings, hotkey H."
							}
						}

						dynamicgridbox = {
							visible = "[Not(GetVariableSystem.HasValue('county_tabs', 'adjacent counties'))]"
							layoutpolicy_horizontal = expanding
							# datamodel_wrap = 5
							# flipdirection = yes
							datamodel = "[HoldingView.GetCountyTitle.MakeScope.GetList('county_holdings')]"

							item = {
								button_text = {
									datacontext = "[Scope.GetProvince.GetHolding]"
									blockoverride "text" {
										raw_text = "[AddTextIf(Not(Holding.IsEmpty), Concatenate(Holding.GetPrimaryBuildingType.GetTypeName, ' '))][Holding.GetNameNoTooltip],"
									}
									blockoverride "pre" {
										spacing = 3
										text_single = {
											raw_text = "[Scope.GetProvince.MakeScope.Var('order').GetValue],"
											visible = "[LessThan_CFixedPoint(Scope.GetProvince.MakeScope.Var('order').GetValue, '(CFixedPoint)6')]"
										}
										text_single = {
											raw_text = "Y,"
											visible = "[EqualTo_CFixedPoint(Scope.GetProvince.MakeScope.Var('order').GetValue, '(CFixedPoint)6')]"
										}
										text_single = {
											raw_text = "U,"
											visible = "[EqualTo_CFixedPoint(Scope.GetProvince.MakeScope.Var('order').GetValue, '(CFixedPoint)7')]"
										}

										text_single = {
											visible = "[Scope.GetProvince.GetHolding.GetLesseeOrHolder.IsLocalPlayer]"
											raw_text = "Your"
										}
									}
									blockoverride "extra" {
										text_single = {
											raw_text = "[Scope.GetProvince.GetTerrain.GetName]."
										}
									}
									onclick = "[OpenGameViewData('holding_view', Scope.GetProvince)]"
									onclick = "[DefaultOnCoatOfArmsRightClick(Scope.GetProvince.GetTitle.GetID)]"
									onclick = "[PdxGuiTriggerAllAnimations('adjacent_counties')]"

									button = {
										onclick = "[OpenGameViewData('holding_view', Scope.GetProvince)]"
										onclick = "[DefaultOnCoatOfArmsRightClick(Scope.GetProvince.GetTitle.GetID)]"
										onclick = "[PdxGuiTriggerAllAnimations('adjacent_counties')]"
										shortcut = speed_1
										visible = "[EqualTo_CFixedPoint(Scope.GetProvince.MakeScope.Var('order').GetValue, '(CFixedPoint)1')]"
									}
									button = {
										onclick = "[OpenGameViewData('holding_view', Scope.GetProvince)]"
										onclick = "[DefaultOnCoatOfArmsRightClick(Scope.GetProvince.GetTitle.GetID)]"
										onclick = "[PdxGuiTriggerAllAnimations('adjacent_counties')]"
										shortcut = speed_2
										visible = "[EqualTo_CFixedPoint(Scope.GetProvince.MakeScope.Var('order').GetValue, '(CFixedPoint)2')]"
									}
									button = {
										onclick = "[OpenGameViewData('holding_view', Scope.GetProvince)]"
										onclick = "[DefaultOnCoatOfArmsRightClick(Scope.GetProvince.GetTitle.GetID)]"
										onclick = "[PdxGuiTriggerAllAnimations('adjacent_counties')]"
										shortcut = speed_3
										visible = "[EqualTo_CFixedPoint(Scope.GetProvince.MakeScope.Var('order').GetValue, '(CFixedPoint)3')]"
									}
									button = {
										onclick = "[OpenGameViewData('holding_view', Scope.GetProvince)]"
										onclick = "[DefaultOnCoatOfArmsRightClick(Scope.GetProvince.GetTitle.GetID)]"
										onclick = "[PdxGuiTriggerAllAnimations('adjacent_counties')]"
										shortcut = speed_4
										visible = "[EqualTo_CFixedPoint(Scope.GetProvince.MakeScope.Var('order').GetValue, '(CFixedPoint)4')]"
									}
									button = {
										onclick = "[OpenGameViewData('holding_view', Scope.GetProvince)]"
										onclick = "[DefaultOnCoatOfArmsRightClick(Scope.GetProvince.GetTitle.GetID)]"
										onclick = "[PdxGuiTriggerAllAnimations('adjacent_counties')]"
										shortcut = speed_5
										visible = "[EqualTo_CFixedPoint(Scope.GetProvince.MakeScope.Var('order').GetValue, '(CFixedPoint)5')]"
									}
									button = {
										onclick = "[OpenGameViewData('holding_view', Scope.GetProvince)]"
										onclick = "[DefaultOnCoatOfArmsRightClick(Scope.GetProvince.GetTitle.GetID)]"
										onclick = "[PdxGuiTriggerAllAnimations('adjacent_counties')]"
										shortcut = map_mode_4
										visible = "[EqualTo_CFixedPoint(Scope.GetProvince.MakeScope.Var('order').GetValue, '(CFixedPoint)6')]"
									}
									button = {
										onclick = "[OpenGameViewData('holding_view', Scope.GetProvince)]"
										onclick = "[DefaultOnCoatOfArmsRightClick(Scope.GetProvince.GetTitle.GetID)]"
										onclick = "[PdxGuiTriggerAllAnimations('adjacent_counties')]"
										shortcut = mapmode_duchies_secondary
										visible = "[EqualTo_CFixedPoint(Scope.GetProvince.MakeScope.Var('order').GetValue, '(CFixedPoint)7')]"
									}
								}
							}
						}
					}
				}
			}

			state = {
				name = holdings_check
				trigger_when = "[IsDataModelEmpty(HoldingView.GetCountyTitle.MakeScope.GetList('county_holdings'))]"
				on_finish = "[GetScriptedGui('county_holding_list').Execute( GuiScope.SetRoot( HoldingView.GetCountyTitle.MakeScope ).End )]"
			}
		}
	}

	window_ocr = {
		# datacontext = "[GetPlayer.MakeScope.Var('region_province').GetProvince]"
		button = {
			# visible = "[Isnt('province_region')]"
			using = close_window_ocr
			onclick = "[Clear('extra_window')]"
		}
		blockoverride "show_window" {
			visible = "[Has('extra_window', 'window_province_regions')]"
		}
		blockoverride "ocr_header" {
			button_text = {
				visible = "[Isnt('province_region')]"
				layoutpolicy_horizontal = expanding
				onclick = "[GetScriptedGui('refresh_region_province').Execute( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope( 'player', GetPlayer.MakeScope).AddScope('target', Province.MakeScope).End )]"
				shortcut = map_mode_11
				blockoverride "text" {
					raw_text = "[Province.MakeScope.Var('is_in_regions').GetValue] regions that [Province.GetNameNoTooltip] belongs to. Refresh with Shift E."
				}
			}
		}
		blockoverride "ocr_content" {
			vbox = {
				visible = "[Isnt('province_region')]"
				state = {
					name = _show
					on_finish = "[GetScriptedGui('refresh_region_province').Execute( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope( 'player', GetPlayer.MakeScope).AddScope('target', Province.MakeScope).End )]"
					trigger_when = "[Not(GetPlayer.MakeScope.Var('region_province').IsSet)]"
					trigger_on_create = yes
				}
			}
			vbox = {
				layoutpolicy_horizontal = expanding
				datamodel = "[GetPlayer.MakeScope.GetList('province_regions')]"

				item = {
					vbox = {
						layoutpolicy_horizontal = expanding
						visible = "[Or(Isnt('province_region'), Has('province_region', Scope.GetFlagName))]"

						button = {
							# using = close_window_ocr
							shortcut = go_back
							onclick = "[Clear('province_region')]"
						}

						vbox = {
							button = {
								shortcut = decrease_speed_2
								clicksound = ""
							}
							button = {
								shortcut = increase_speed_2
								clicksound = ""
							}
						}

						button_text = {
							datacontext = "[GetScriptedGui('province_region_page')]"
							using = sgui_click_reset
							onclick = "[Set('province_region', Scope.GetFlagName)]"
							layoutpolicy_horizontal = expanding
							blockoverride "text" {
								raw_text = "[Localize(Concatenate(Scope.GetFlagName, '_name'))],"
							}
							blockoverride "extra" {
								text_single = {
									raw_text = "[AddTextIf(IsIndexFirst, 'You control ')][GetDataModelSize(GetPlayer.MakeScope.GetList(Concatenate(Scope.GetFlagName, '_yours')))] [AddTextIf(IsIndexFirst, 'counties ')]out of [Add_int32(GetDataModelSize(GetPlayer.MakeScope.GetList(Concatenate(Scope.GetFlagName, '_yours'))), GetDataModelSize(GetPlayer.MakeScope.GetList(Concatenate(Scope.GetFlagName, '_foreign'))))]."
								}
								text_single = {
									visible = "[Is('province_region')]"
									raw_text = "Go back with B."
								}
							}
						}

						vbox = {
							layoutpolicy_horizontal = expanding
							visible = "[Has('province_region', Scope.GetFlagName)]"

							datacontext = "[GetScriptedGui('province_region_page')]"

							button_text = {
								using = sgui_click_reset
								layoutpolicy_horizontal = expanding
								onclick = "[Toggle(Concatenate(Scope.GetFlagName, '_foreign'))]"
								blockoverride "text" {
									raw_text = "[GetDataModelSize(GetPlayer.MakeScope.GetList(Concatenate(Scope.GetFlagName, '_foreign')))] counties you don't control, [Collapse(Concatenate(Scope.GetFlagName, '_foreign'))]"
								}
							}

							vbox = {
								layoutpolicy_horizontal = expanding
								visible = "[Isnt(Concatenate(Scope.GetFlagName, '_foreign'))]"

								state = {
								  name = "reset"
								  using = sgui_finish_reset
								  trigger_when = "[Or(Or(PageReset('province_region_page', GetPlayer.MakeScope.GetList(Concatenate(Scope.GetFlagName, '_foreign'))), Not(GetPlayer.MakeScope.Var('global_page_size').IsSet)), Not(GetPlayer.MakeScope.Var('province_region_page').IsSet))]"
									trigger_on_create = yes
								}

								hbox = {
									layoutpolicy_horizontal = expanding
								  spacing = 3

								  text_single = {
										datacontext = "[GetPlayer.MakeScope.Var('province_region_page')]"
								    raw_text = "Showing from [PageStartGlobal] to [Min_CFixedPoint(Add_CFixedPoint(Scope.GetValue, GlobalPageSize), IntToFixedPoint(PdxGuiWidget.AccessParent.AccessParent.FindChild('items').CountVisibleChildren))],"
								  }

								  button_resize_page_ocr = {}

									expand = {}
								}

								fixedgridbox = {
									datamodel = "[PageModel('province_region_page', FixedPointToInt(GetPlayer.MakeScope.Var('global_page_size').GetValue), GetPlayer.MakeScope.GetList(Concatenate(Scope.GetFlagName, '_foreign')))]"
									layoutpolicy_horizontal = expanding
									addrow = 25
									addcolumn = 600

									item = {
										adjacent_county_button = {
											blockoverride "pre" {
												text_single = {
											    alwaystransparent = yes
											    margin_left = 3
											    raw_text = "[Add_int32(PdxGuiWidget.GetIndexInDataModel, Add_int32(FixedPointToInt( GetPlayer.MakeScope.Var('province_region_page').GetValue ), '(int32)1'))],"
											  }
											}
											onclick = "[Clear('extra_window')]"
											blockoverride "county_distance" {}
											blockoverride "holder" {
												visible = no
											}
										}
									}
								}

								page_buttons_ocr = {
									datacontext = "[GetPlayer.MakeScope.Var('province_region_page')]"
								}

								fixedgridbox = {
									name = "items"
									datamodel = "[GetPlayer.MakeScope.GetList(Concatenate(Scope.GetFlagName, '_foreign'))]"
									addcolumn = 1
									addrow = 1
									flipdirection = yes
									item = {
										widget = {
										}
									}
								}
							}

							###

							button_text = {
								using = sgui_click_reset
								onclick = "[Toggle(Concatenate(Scope.GetFlagName, '_foreign'))]"
								layoutpolicy_horizontal = expanding
								blockoverride "text" {
									raw_text = "[GetDataModelSize(GetPlayer.MakeScope.GetList(Concatenate(Scope.GetFlagName, '_yours')))] counties you control, [CollapseIf(Isnt(Concatenate(Scope.GetFlagName, '_foreign')))]"
								}
							}

							vbox_paged_list = {
								visible = "[Is(Concatenate(Scope.GetFlagName, '_foreign'))]"
								blockoverride "var" {

								}
							  blockoverride "page_index" {
							    datacontext = "[GetPlayer.MakeScope.Var('province_region_page')]"
							  }
							  datacontext = "[GetScriptedGui('province_region_page')]"

							  blockoverride "full_datamodel" {
							    datamodel = "[GetPlayer.MakeScope.GetList(Concatenate(Scope.GetFlagName, '_yours'))]"
							  }
							  blockoverride "vbox_contents" {
									fixedgridbox = {
										datamodel = "[PageModel('province_region_page', FixedPointToInt(GetPlayer.MakeScope.Var('global_page_size').GetValue), GetPlayer.MakeScope.GetList(Concatenate(Scope.GetFlagName, '_yours')))]"
									  layoutpolicy_horizontal = expanding
									  addrow = 25
									  addcolumn = 600
									  item = {
											adjacent_county_button = {
												layoutpolicy_horizontal = expanding
												blockoverride "pre" {
													text_single = {
														alwaystransparent = yes
														margin_left = 3
														raw_text = "[Add_int32(PdxGuiWidget.GetIndexInDataModel, Add_int32(FixedPointToInt( GetPlayer.MakeScope.Var('province_region_page').GetValue ), '(int32)1'))],"
													}
												}
												onclick = "[Clear('extra_window')]"
												blockoverride "county_distance" {}
												blockoverride "holder" {
													visible = no
												}
											}
									  }
									}
							  }
							}
						}
					}
				}
			}
		}
	}

	old_county = { }

	#AGOT Added
	agot_county_view_ruins_blocker = {
		alpha = 1
	}
	agot_county_view_ruins_reconstruct_confirm = {
		position = { 0 0 }
		parentanchor = top|left
	}
}

######################################################
########### CONSTRUCT NEW BUILDING WINDOW ############
######################################################

window = {
	name = "holding_tracks_view"
	size = { 100% 100% }
	movable = no
	layer = middle
	datacontext = "[HoldingView.GetHolder]"
	alwaystransparent = yes

	# button = {
	# 	using = close_window_ocr
	# }

	window_ocr = {
		blockoverride "ocr_header" {
			header_text = {
				layoutpolicy_horizontal = expanding

				blockoverride "header_text"
				{
					text = "[HoldingView.GetTracksViewLabel]"
				}
				# blockoverride "extra" {
				# 	text_single = {
				# 		datacontext = "[HoldingView.GetTrack]"
				# 		datacontext = "[GUITrackItem.GetCurrentBuilding]"
				# 		raw_text = "[Building.GetNameNoTooltip]."
				# 	}
				# }

				blockoverride "button_close"
				{
					onclick = "[HoldingView.CloseSubwindows]"
				}
			}
		}
		blockoverride "ocr_content" {
			vbox = {
				layoutpolicy_horizontal = expanding

				vbox = {
					layoutpolicy_horizontal = expanding

					## New Building
					vbox = {
						visible = "[Not(HoldingView.IsSelectingBuildingToConstruct)]"
						layoutpolicy_horizontal = expanding

						building_in_vassal_warning_hbox = { }

						text_single = {
							layoutpolicy_horizontal = expanding
							raw_text = "[GetDataModelSize(HoldingView.GetPotentialBuildings)] options:"
						}

						text_single = {
							layoutpolicy_horizontal = expanding
							name = "prompt"
							text = "[HoldingView.GetTracksViewPrompt]"
							margin_bottom = 10
						}

						text_single = {
							visible = "[IsDataModelEmpty(HoldingView.GetPotentialBuildings)]"
							layoutpolicy_horizontal = expanding
							name = "no_potential_buildings_text"
							text = "NO_POTENTIAL_BUILDINGS_WARNING"
							margin_bottom = 10
						}

						## Construct New Building
						vbox = {
							visible = "[Not(IsDataModelEmpty(HoldingView.GetPotentialBuildings))]"
							layoutpolicy_horizontal = expanding

							vbox = {
								visible = "[Not(HoldingView.IsSelectingBuildingToConstruct)]"
								layoutpolicy_horizontal = expanding
								name = "tracks_grid"
								datamodel = "[HoldingView.GetPotentialBuildings]"
								datacontext = "[HoldingView.GetProvince]"
								datacontext = "[HoldingView.GetProvince.GetCounty.GetCulture]"
								# visible = "[HoldingView.IsSelectingNewBuilding]"

								text_single = {
									raw_text = "Selecting a building will start construction, without a preview!"
									layoutpolicy_horizontal = expanding
									visible = "[EqualTo_string(HoldingView.GetTracksViewPrompt, Localize('REPLACE_BUILDING_PROMPT'))]"
								}

								item = {
									vbox = {
										layoutpolicy_horizontal = expanding

										button_select_building_ocr = {
											visible = "[Not(EqualTo_string(HoldingView.GetTracksViewPrompt, Localize('REPLACE_BUILDING_PROMPT')))]"
											blockoverride "click" {
												onclick = "[GUIPotentialBuildingItem.ShowDetails]"
											}
											blockoverride "preview" {
												raw_text = "Preview."
											}
										}

										button_select_building_ocr = {
											visible = "[EqualTo_string(HoldingView.GetTracksViewPrompt, Localize('REPLACE_BUILDING_PROMPT'))]"
											blockoverride "click" {
												enabled = "[GUIPotentialBuildingItem.CanConstruct]"
												onclick = "[GUIPotentialBuildingItem.Construct]"
											}
											blockoverride "preview" {
												raw_text = "Construct."
											}
										}

										hbox = {
											name = "dynamic_content"
											layoutpolicy_horizontal = expanding
											margin = {5 5}
											visible = no# "[Not(GetVariableSystem.Exists('hide_building_desc'))]"

											vbox = {
												spacing = 8

												hbox = {
													layoutpolicy_horizontal = expanding
													margin_left = 10

													text_label_left = {
														layoutpolicy_horizontal = expanding
														datacontext = "[GUIPotentialBuildingItem.GetBuilding]"
														text = CV_BUILDING_LEVEL_AND_NAME
														autoresize = no
													}
												}

												text_multi = {
													layoutpolicy_horizontal = expanding
													layoutpolicy_vertical = expanding
													autoresize = yes
													max_width = 330
													min_width = 330
													text = "[GUIPotentialBuildingItem.GetBuilding.GetEffectDescriptionAtProvince( Character.Self, Province.Self )]"
													margin = { 15 10 }

													background = {
														using = Background_Frame
													}
												}
											}

											text_multi = {
												layoutpolicy_horizontal = expanding
												layoutpolicy_vertical = expanding
												margin = {5 0}
												margin_top = 30
												text = "[GUIPotentialBuildingItem.GetBuilding.GetTypeDescription]"
												default_format = "#F"
												autoresize = yes
												max_width = 280
												min_width = 280
											}
										}
									}
								}
							}
						}
					}

					vbox = {
						layoutpolicy_horizontal = expanding
						vbox = {
							visible = "[HoldingView.IsSelectingBuildingToConstruct]"
							layoutpolicy_horizontal = expanding
							alwaystransparent = no

							## Upgrade Building
							vbox = {
								name = "upgrade"
								datacontext = "[HoldingView.GetTrack]"
								layoutpolicy_horizontal = expanding
								#minimumsize = { 0 700 }


								vbox = {
									datacontext = "[HoldingView.GetTrack]"
									visible = "[GUITrackItem.IsConstructing]"
									layoutpolicy_horizontal = expanding
									margin_bottom = 5
									text_single = {
										layoutpolicy_horizontal = expanding
										text = "HOLDING_VIEW_IN_PROGRESS"
									}

									hbox = {
										spacing = 3
										layoutpolicy_horizontal = expanding

										button_text = {
											shortcut = increase_speed_2
											blockoverride "text" {
												raw_text = "Abort construction, X."
											}
											blockoverride "extra" {
												text_single = {
													raw_text = " Disabled."
													visible = "[Not(GUITrackItem.CanCancel)]"
												}
											}
											visible = "[GUITrackItem.CanShowCancel]"
											enabled = "[GUITrackItem.CanCancel]"
											onclick = "[GUITrackItem.Cancel]"
											tooltip = "[GUITrackItem.GetCancelTooltip]"
										}

										text_single = {
											raw_text = "[GUITrackItem.GetConstructTimeLeft]."
										}
										expand = {}
									}
								}

								hbox = {
									layoutpolicy_horizontal = expanding
									spacing = 10

									hbox = {
										layoutpolicy_horizontal = expanding

										text_single = {
											raw_text = "[GUITrackItem.GetSelectedBuilding.GetName], [GUITrackItem.GetSelectedBuilding.GetTypeName] Type."
										}

										building_in_vassal_warning_hbox = {
										}

										expand = { }
									}

									buttons_window_control = {
										blockoverride "button_close"
										{
											onclick = "[HoldingView.CloseSubwindows]"
										}
									}
								}

								vbox = {
									layoutpolicy_horizontal = expanding
									# layoutpolicy_vertical = expanding
									spacing = 5

									vbox = {
										layoutpolicy_horizontal = expanding
										visible = "[Not(GUITrackItem.IsConstructing)]"
										margin_bottom = 10
										# layoutpolicy_horizontal = expanding
										button_primary_text = {
											layoutpolicy_horizontal = expanding
											blockoverride "text" {
												raw_text = "[SelectLocalization(EqualTo_int32(GUITrackItem.GetNextBuilding.GetLevel, '(int32)1'),'CONSTRUCT','UPGRADE')]"
											}
											blockoverride "disabled" {
												visible = "[Not(GUITrackItem.CanConstructNextBuilding)]"
												tooltip = "[GUITrackItem.GetNextBuildingTooltip]"

											}
											blockoverride "hotkey" {
												visible = "[GUITrackItem.CanConstructNextBuilding]"
											}
											onclick = "[GUITrackItem.OnClick]"
											enabled = "[GUITrackItem.CanConstructNextBuilding]"
											visible = "[GUITrackItem.HasNextBuilding]"
										}
										hbox = {
											layoutpolicy_horizontal = expanding
											visible = "[GUITrackItem.HasNextBuilding]"
											spacing = 3

											text_single = {
												raw_text = "Cost:"
											}

											hbox = {
												spacing = 3
												hbox = {
													datacontext = "[GUITrackItem.GetNextGoldCost]"
													visible = "[GUITrackItem.HasNextGoldCost]"
													spacing = 3
													text_single = {
														raw_text = "[ValueBreakdown.GetValue],"
														tooltip_visible = "[ValueBreakdown.HasTooltip]"

														tooltipwidget = {
															widget_value_breakdown_tooltip = { }
														}
													}
													text_single = {
														visible = "[LessThan_CFixedPoint(GetPlayer.GetGold, ValueBreakdown.GetFixedPointValue)]"
														raw_text = "need [Subtract_CFixedPoint(ValueBreakdown.GetFixedPointValue, GetPlayer.GetGold)|0] more."
													}
												}

												hbox = {
													spacing = 3
													datacontext = "[GUITrackItem.GetNextPrestigeCost]"
													visible = "[GUITrackItem.HasNextPrestigeCost]"

													text_single = {
														raw_text = "[ValueBreakdown.GetValue],"
														tooltip_visible = "[ValueBreakdown.HasTooltip]"

														tooltipwidget = {
															widget_value_breakdown_tooltip = { }
														}
													}

													text_single = {
														visible = "[LessThan_CFixedPoint(GetPlayer.GetPrestige, ValueBreakdown.GetFixedPointValue)]"
														raw_text = "need [Subtract_CFixedPoint(ValueBreakdown.GetFixedPointValue, GetPlayer.GetPrestige)|0] more."
													}
												}


												hbox = {
													layoutpolicy_horizontal = expanding
													datacontext = "[GUITrackItem.GetNextPietyCost]"
													visible = "[GUITrackItem.HasNextPietyCost]"
													spacing = 3

													text_single = {
														raw_text = "[ValueBreakdown.GetValue],"
														tooltip_visible = "[ValueBreakdown.HasTooltip]"

														tooltipwidget = {
															widget_value_breakdown_tooltip = { }
														}
													}

													text_single = {
														visible = "[LessThan_CFixedPoint(GetPlayer.GetPiety, ValueBreakdown.GetFixedPointValue)]"
														raw_text = "need [Subtract_CFixedPoint(ValueBreakdown.GetFixedPointValue, GetPlayer.GetPiety)|0] more."
													}

													expand = { }
												}

												text_single = {
													margin_top = 2
													layoutpolicy_horizontal = expanding
													datacontext = "[GUITrackItem.GetNextConstructionTime]"
													raw_text = "Will take [ValueBreakdown.GetValue]."
													tooltip_visible = "[ValueBreakdown.HasTooltip]"

													tooltipwidget = {
														widget_value_breakdown_tooltip = { }
													}
												}
											}

											expand = { }
										}

										button_text = {
											layoutpolicy_horizontal = expanding
											name = "back_button"
											blockoverride "text" {
												raw_text = "Go back, B."
											}
											visible = "[And(EqualTo_int32(GUITrackItem.GetNextBuilding.GetLevel,'(int32)1'), Not(GUITrackItem.IsConstructing))]"
											onclick = "[GUITrackItem.GoBack]"
											oversound = "event:/SFX/UI/Generic/sfx_ui_generic_pointer_over"
											clicksound = "event:/SFX/UI/Generic/sfx_ui_generic_close"
											shortcut = "go_back"
											# using = close_window_ocr
										}

										button_text = {
											layoutpolicy_horizontal = expanding
											shortcut = increase_speed_2
											blockoverride "text" {
												raw_text = "Replace building, X."
											}
											onclick = "[GUITrackItem.Replace]"
											# tooltip = "[GUITrackItem.GetReplaceTooltip]"
											visible = "[And(GUITrackItem.IsCurrentBuildingSelected, GUITrackItem.CanReplace)]"
										}

										expand = { }
									}

									# next level
									vbox = {
										layoutpolicy_horizontal = expanding
										visible = "[And(And(GUITrackItem.HasNextBuilding, Not(GUITrackItem.IsNextBuildingSelected)), GUITrackItem.IsCurrentBuildingSelected)]"
										datacontext = "[GUITrackItem.GetNextBuilding]"

										text_single = {
											layoutpolicy_horizontal = expanding
											raw_text = "Will upgrade to [Building.GetNameNoTooltip]."
										}

										hbox = {
											layoutpolicy_horizontal = expanding

											text_multi = {
												datacontext = "[HoldingView.GetProvince.GetCounty.GetCulture]"
												layoutpolicy_horizontal = expanding
												autoresize = yes
												max_width = 700
												min_width = 330
												raw_text = "Effects on [Building.GetEffectDescriptionAtProvince( Character.Self, HoldingView.GetProvince)]"
											}

											expand = {}
										}

										hbox = {
											layoutpolicy_horizontal = expanding

											text_multi = {
												visible = "[Not(GetVariableSystem.Exists('hide_building_desc'))]"
												layoutpolicy_horizontal = expanding
												autoresize = yes
												max_width = 700
												min_width = 330
												raw_text = "[Building.GetDescription]."
											}

											expand = {}
										}


										vbox = {
											visible = "[And(And(GreaterThan_int32(GUITrackItem.GetSelectedBuilding.GetLevel,GUITrackItem.GetCurrentBuilding.GetLevel),GreaterThan_int32(GUITrackItem.GetSelectedBuilding.GetLevel,'(int32)1')), Not(GUITrackItem.IsNextBuildingSelected))]"
											layoutpolicy_horizontal = expanding
											margin_left = 10
											margin_bottom = 5
											# spacing = 5

											text_label_left = {
												layoutpolicy_horizontal = expanding
												text = "UPGRADE_COST"
											}

											hbox = {
												layoutpolicy_horizontal = expanding
												spacing = 10
												# margin = { 10 10 }

												hbox = {
													spacing = 10

													text_single = {
														datacontext = "[GUITrackItem.GetSelectedGoldCost]"
														visible = "[GUITrackItem.HasSelectedGoldCost]"
														text = "[ValueBreakdown.GetValue]"
														align = left
														tooltip_visible = "[ValueBreakdown.HasTooltip]"

														tooltipwidget = {
															widget_value_breakdown_tooltip = { }
														}

														background = {
															visible = "[LessThan_CFixedPoint(GetPlayer.GetGold, ValueBreakdown.GetFixedPointValue)]"
															using = Status_Bad
														}
													}

													text_single = {
														datacontext = "[GUITrackItem.GetSelectedPrestigeCost]"
														visible = "[GUITrackItem.HasSelectedPrestigeCost]"
														text = "[ValueBreakdown.GetValue]"
														align = left
														tooltip_visible = "[ValueBreakdown.HasTooltip]"

														tooltipwidget = {
															widget_value_breakdown_tooltip = { }
														}
													}

													text_single = {
														datacontext = "[GUITrackItem.GetSelectedPietyCost]"
														visible = "[GUITrackItem.HasSelectedPietyCost]"
														text = "[ValueBreakdown.GetValue]"
														align = left
														tooltip_visible = "[ValueBreakdown.HasTooltip]"

														tooltipwidget = {
															widget_value_breakdown_tooltip = { }
														}
													}

													text_single = {
														datacontext = "[GUITrackItem.GetSelectedConstructionTime]"
														raw_text = "[ValueBreakdown.GetValue]."
														align = left
														tooltip_visible = "[ValueBreakdown.HasTooltip]"

														tooltipwidget = {
															widget_value_breakdown_tooltip = { }
														}
													}
												}

												expand = { }
											}

											text_single = {
												raw_text = "Warning, can't construct. See tooltip."
												tooltip = "[GUITrackItem.GetSelectedBuildingBlockReasons]"
												visible = "[Not(GUITrackItem.CanConstructSelectedBuilding)]"
												align = left
												layoutpolicy_horizontal = expanding
											}
										}
									}

									# current building
									vbox = {
										layoutpolicy_horizontal = expanding
										# visible = "[GUITrackItem.IsCurrentBuildingSelected]"
										datacontext = "[GUITrackItem.GetSelectedBuilding]"

										hbox = {
											spacing = 3
											layoutpolicy_horizontal = expanding

											text_single = {
												visible = "[GUITrackItem.IsCurrentBuildingSelected]"
												raw_text = "Current building,"
											}

											text_single = {
												visible = "[Not(GUITrackItem.IsCurrentBuildingSelected)]"
												raw_text = "Previewing"
											}

											text_single = {
												raw_text = "[Building.GetNameNoTooltip]"
											}

											expand = { }
										}

										hbox = {
											layoutpolicy_horizontal = expanding

											text_multi = {
												datacontext = "[HoldingView.GetProvince.GetCounty.GetCulture]"
												layoutpolicy_horizontal = expanding
												autoresize = yes
												max_width = 700
												min_width = 330
												raw_text = "Effects on [Building.GetEffectDescriptionAtProvince( Character.Self, HoldingView.GetProvince)]"
											}

											expand = {}
										}

										hbox = {
											layoutpolicy_horizontal = expanding

											text_multi = {
												visible = "[Not(GetVariableSystem.Exists('hide_building_desc'))]"
												layoutpolicy_horizontal = expanding
												autoresize = yes
												max_width = 700
												min_width = 330
												raw_text = "[Building.GetDescription]."
											}

											expand = {}
										}


										vbox = {
											visible = "[And(And(GreaterThan_int32(GUITrackItem.GetSelectedBuilding.GetLevel,GUITrackItem.GetCurrentBuilding.GetLevel),GreaterThan_int32(GUITrackItem.GetSelectedBuilding.GetLevel,'(int32)1')), Not(GUITrackItem.IsNextBuildingSelected))]"
											layoutpolicy_horizontal = expanding
											margin_left = 10
											margin_bottom = 5
											# spacing = 5

											text_label_left = {
												layoutpolicy_horizontal = expanding
												text = "UPGRADE_COST"
											}

											hbox = {
												layoutpolicy_horizontal = expanding
												spacing = 10
												# margin = { 10 10 }

												hbox = {
													spacing = 10

													text_single = {
														datacontext = "[GUITrackItem.GetSelectedGoldCost]"
														visible = "[GUITrackItem.HasSelectedGoldCost]"
														text = "[ValueBreakdown.GetValue]"
														align = left
														tooltip_visible = "[ValueBreakdown.HasTooltip]"

														tooltipwidget = {
															widget_value_breakdown_tooltip = { }
														}
													}

													text_single = {
														datacontext = "[GUITrackItem.GetSelectedPrestigeCost]"
														visible = "[GUITrackItem.HasSelectedPrestigeCost]"
														text = "[ValueBreakdown.GetValue]"
														align = left
														tooltip_visible = "[ValueBreakdown.HasTooltip]"

														tooltipwidget = {
															widget_value_breakdown_tooltip = { }
														}
													}

													text_single = {
														datacontext = "[GUITrackItem.GetSelectedPietyCost]"
														visible = "[GUITrackItem.HasSelectedPietyCost]"
														text = "[ValueBreakdown.GetValue]"
														align = left
														tooltip_visible = "[ValueBreakdown.HasTooltip]"

														tooltipwidget = {
															widget_value_breakdown_tooltip = { }
														}
													}

													text_single = {
														datacontext = "[GUITrackItem.GetSelectedConstructionTime]"
														raw_text = "[ValueBreakdown.GetValue]."
														align = left
														tooltip_visible = "[ValueBreakdown.HasTooltip]"

														tooltipwidget = {
															widget_value_breakdown_tooltip = { }
														}
													}
												}

												expand = { }
											}

											text_single = {
												raw_text = "Warning, can't construct. See tooltip."
												tooltip = "[GUITrackItem.GetSelectedBuildingBlockReasons]"
												visible = "[Not(GUITrackItem.CanConstructSelectedBuilding)]"
												align = left
												layoutpolicy_horizontal = expanding
											}
										}
									}
								}

								button_text = {
									layoutpolicy_horizontal = expanding
									onclick = "[GetVariableSystem.Toggle('hide_building_desc')]"
									blockoverride "text" {
										raw_text = "[Select_CString(GetVariableSystem.Exists('hide_building_desc'), 'Show', 'Hide')] descriptions, Shift D."
									}
									shortcut = mapmode_house_secondary
								}

								text_single = {
									raw_text = "All building levels:"
									layoutpolicy_horizontal = expanding
								}

								vbox = {
									layoutpolicy_horizontal = expanding
									margin_bottom = 10

									### PREVIOUS BUILDINGS
									vbox = {
										name = "level_track_previous"
										datamodel = "[GUITrackItem.GetPreLevelItems]"
										layoutpolicy_horizontal = expanding

										item = {
											button_text = {
												layoutpolicy_horizontal = expanding
												blockoverride "text" {
													raw_text = "[BuildingLevelItem.GetBuilding.GetNameNoTooltip]"
												}
												blockoverride "extra" {
													text_single = {
														raw_text = ", selected"
														visible = "[BuildingLevelItem.IsSelected]"
														align = left
													}
												}
												blockoverride "dot" { }
												onclick = "[BuildingLevelItem.OnClick]"
											}
										}
									}

									### CURRENT BUILDING

									button_text = {
										layoutpolicy_horizontal = expanding
										blockoverride "text" {
											raw_text = "[GUITrackItem.GetCurrentBuilding.GetNameNoTooltip]"
										}
										blockoverride "extra" {
											text_single = {
												raw_text = ", selected"
												visible = "[GUITrackItem.IsCurrentBuildingSelected]"
												align = left
											}
										}
										blockoverride "dot" { }
										visible = "[GUITrackItem.HasCurrentBuilding]"
										onclick = "[GUITrackItem.OnCurrentBuildingClick]"
									}


									### NEXT BUILDING

									button_text = {
										layoutpolicy_horizontal = expanding
										blockoverride "text" {
											raw_text = "[GUITrackItem.GetNextBuilding.GetNameNoTooltip]"
										}
										blockoverride "extra" {
											text_single = {
												raw_text = ", selected"
												visible = "[GUITrackItem.IsNextBuildingSelected]"
												align = left
											}
										}
										blockoverride "dot" { }
										visible = "[GUITrackItem.HasNextBuilding]"
										onclick = "[GUITrackItem.OnNextBuildingClick]"
									}

									#Post Track
									### LEVEL TRACK
									vbox = {
										layoutpolicy_horizontal = expanding
										name = "level_track_next"
										datamodel = "[GUITrackItem.GetPostLevelItems]"

										item = {
											button_text = {
												layoutpolicy_horizontal = expanding
												blockoverride "text" {
													raw_text = "[BuildingLevelItem.GetBuilding.GetNameNoTooltip]"
												}
												blockoverride "extra" {
													text_single = {
														raw_text = ", selected"
														visible = "[BuildingLevelItem.IsSelected]"
														align = left
													}
												}
												blockoverride "dot" { }
												onclick = "[BuildingLevelItem.OnClick]"
											}
										}
									}

									expand = { }
								}
							}
						}

						expand = { }
					}

					expand = { }
				}
			}
		}
	}

	holding_tracks_view_old = {}

	# button = {
	# 	using = close_window_ocr
	# 	onclick = "[GetVariableSystem.Clear('county_tabs')]"
	# 	onclick = "[GetVariableSystem.Clear('holding_tabs')]"
	# 	onclick = "[HoldingView.CloseHoldingConstruction]"
	# 	# onclick = "[HoldingView.Close]"
	# }
}

######################################################
############ HOLDING TYPE SELECTION VIEW #############
######################################################

window = {
	name = "holding_type_selection_view"
	movable = yes
	layer = top
	parentanchor = bottom|hcenter
	position = { 40 0 } #40
	using = Animation_ShowHide_Quick
	using = TooltipFocus

	using = Window_Background_Subwindow
	allow_outside = yes

	vbox = {
		using = ocr
		set_parent_size_to_minimum = yes
		margin = { 4 4 }
		margin_bottom = 15
		spacing = 15

		header_pattern = {
			layoutpolicy_horizontal = expanding
			size = { 0 30 }

			blockoverride "header_text"
			{
				text = "CREATE_NEW_HOLDING_HEADING"
			}

			blockoverride "button_close"
			{
				onclick = "[HoldingView.CloseHoldingConstruction]"
			}
		}

		building_in_vassal_warning_hbox = { }

		flowcontainer = {
			name = "holding_types"
			datamodel = "[HoldingView.GetHoldingTypeItems]"
			layoutpolicy_horizontal = expanding
			ignoreinvisible = yes
			direction = vertical
			spacing = 5
			margin_left = 5

			button_text = {
				layoutpolicy_horizontal = expanding
			    blockoverride "text" {
			        raw_text = "[Select_CString(GetVariableSystem.Exists('hide_holding_desc'), 'Hide', 'Show')] descriptions, Shift D."
			    }
				shortcut = mapmode_house_secondary
				onclick = "[GetVariableSystem.Toggle('hide_holding_desc')]"
			}
			# margin = { 10 10 }

			item = {
				button_standard = {
					size = { 600 148 }
					enabled = "[HoldingTypeItem.CanConstructBuilding]"
					onclick = "[HoldingTypeItem.OnClick]"
					datacontext = "[HoldingTypeItem.GetProvince]"

					flowcontainer = {
						ignoreinvisible = yes
						direction = vertical
						resizeparent = yes
						margin = { 10 5 }
						spacing = 5

						button_text = {
							tooltip = "[HoldingTypeItem.GetTooltip]"
							alwaystransparent = yes

						    blockoverride "text" {
								raw_text = "Build [HoldingTypeItem.GetHoldingType.GetName]."
						    }
							blockoverride "disabled" {
								visible = "[Not(HoldingTypeItem.CanConstructBuilding)]"
							}
							visible = "[Not(GetVariableSystem.Exists('hide_holding_desc'))]"
						}

						flowcontainer = {
							ignoreinvisible = yes
							direction = vertical
							visible = "[GetVariableSystem.Exists('hide_holding_desc')]"
							# layoutpolicy_horizontal = expanding

							text_multi = {
								raw_text = "[HoldingTypeItem.GetTooltip]."
								max_width = 700
								min_width = 700
								autoresize = yes
								alwaystransparent = yes
							}

							text_multi = {
								name = "wrong_type"
								max_width = 700
								min_width = 700
								autoresize = yes
								visible = "[Not(HoldingTypeItem.IsValidForPlayer)]"
								size = { 35 35 }
								raw_text = "HOLDING_SELECTION_VIEW_WRONG_HOLDING_TYPE"
								alwaystransparent = yes
							}
						}
					}
				}
			}
		}
	}

	holding_type_selection_view_old = {}
}

######################################################
################ TYPES AND TEMPLATES #################
######################################################

types OCR {

	type widget_building_text = button {
		size = { @building_width 20 }
		allow_outside = yes
		onclick = "[GUIBuildingItem.OnClick]"
		down = "[GUIBuildingItem.IsHighlighted]"
		enabled = "[GUIBuildingItem.IsBuildingButtonEnabled]"

		vbox = {
			hbox = {
				layoutpolicy_horizontal = expanding
				spacing = 5

				text_single = {
					raw_text = "Upgrade"
					visible = "[GUIBuildingItem.CanUpgrade]"
				}

				text_single = {
					raw_text = "Empty. Preview."
					visible = "[And(Not(GUIBuildingItem.IsBuildNewIconShown), Not(GUIBuildingItem.HasLevel))]"
				}

				text_single = {
					text = "[GUIBuildingItem.GetCurrentOrConstrucingBuilding.GetNameNoTooltip]"
					visible = "[GUIBuildingItem.HasLevel]"
				}

				text_single = {
					visible = "[GUIBuildingItem.HasLevel]"
					raw_text = "[GUIBuildingItem.GetCurrentOrConstrucingBuilding.GetLevel]."
				}

				text_single = {
					raw_text = "Button disabled."
					visible = "[Not(GUIBuildingItem.IsBuildingButtonEnabled)]"
				}

				block "normal" {
					text_single = {
						raw_text = "Build new, Enter."
						visible = "[And(And(GUIBuildingItem.IsBuildNewIconShown, GUIBuildingItem.IsBuildingButtonEnabled), Not(GUIBuildingItem.HasLevel))]"

						button = {
							onclick = "[GUIBuildingItem.OnClick]"
							shortcut = confirm
						}
					}
				}

				block "special" {
					text_single = {
						raw_text = "Build new."
						visible = "[And(And(GUIBuildingItem.IsBuildNewIconShown, GUIBuildingItem.IsBuildingButtonEnabled), Not(GUIBuildingItem.HasLevel))]"
					}
				}

				text_single = {
					raw_text = "Construction: [GUIBuildingItem.GetConstructingProgress|0]%."
					tooltip = "[GUIBuildingItem.GetTooltip]"
					visible = "[GUIBuildingItem.IsConstructing]"
				}

				text_single = {
					raw_text = "Building disabled."
					visible = "[GUIBuildingItem.IsBuildingDisabled]"
				}

				text_single = {
					visible = "[GUIBuildingItem.HasLevel]"
					raw_text = "Tooltip."
					tooltip = "[GUIBuildingItem.GetTooltip]"
				}
				expand = { }
			}

			expand = { }
		}
	}

	type button_sea = button_text {
		blockoverride "text" {
			raw_text = "[Scope.GetProvince.GetName],"
		}
		blockoverride "extra" {
			block "sea_info_pre" {}
			block "direction" {
				text_single = {
					visible = "[Not(ObjectsEqual(Province.Self, Scope.GetProvince))]"
					raw_text = "[DistanceTo(Province, Scope.GetProvince)|0] [DaysTo(Province, Scope.GetProvince)] [Direction(Province, Scope.GetProvince)][AddTextIf(IsIndexFirst, ' from here')],"
				}
				# for debug
				# text_single = {
				# 	raw_text = "Y: [Scope.Var('pos_y').GetValue]"
				# }
				text_single = {
					visible = "[ObjectsEqual(Province.Self, Scope.GetProvince)]"
					raw_text = "here"
				}
			}
			block "sea_info" {}
		}
		block "click" {
			# onclick = "[CloseGameView('holding_view')]"
			onclick = "[Scope.GetProvince.PanCameraTo]"
			onclick = "[GetVariableSystem.Clear(AddTextIf(Not(ShowAddFlag('sgui_flag', 'close_adjacencies')), 'county_tabs'))]"
			onclick = "[HoldingView.Close]"
			onclick = "[Set('extra_window', 'window_sea')]"
			onclick = "[ClickAdd('window_sea', GetPlayer, Scope.GetProvince)]"
			onclick = "[GetScriptedGui('province_adjacencies').Execute( GuiScope.SetRoot( Scope.GetProvince.MakeScope ).AddScope( 'player', GetPlayer.MakeScope).End )]"
			onclick = "[GetScriptedGui('find_closest').Execute( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('target', Scope.GetProvince.MakeScope).End )]"
			onrightclick = "[Scope.GetProvince.PanCameraTo]"
		}
	}

	type button_sea_far = button_sea {
		blockoverride "direction" {
			text_single = {
				visible = "[Not(ObjectsEqual(Province.Self, Scope.GetProvince))]"
				raw_text = "[DistanceTo(Province, Scope.GetProvince)|0] [DaysTo(Province, Scope.GetProvince)] [Direction(Province, Scope.GetProvince)] [AddTextIf(IsIndexFirst, 'from here')]"
			}
			text_single = {
				visible = "[ObjectsEqual(Province.Self, Scope.GetProvince)]"
				raw_text = "here"
			}
		}
		blockoverride "dot" {

		}
	}

	type adjacent_county_button = button_text {
		block "datacontext" {
			# datacontext = "[HoldingView.GetProvince]"
			datacontext = "[Scope.Title]"
		}
		blockoverride "extra" {
			spacing = 3

			text_single = {
				raw_text = "Hostile,"
				visible = "[GetScriptedGui('is_hostile_county').IsShown( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope( 'target', Title.GetProvince.MakeScope ).End )]"
			}

			text_single = {
				visible = "[GreaterThan_CFixedPoint( GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('province', Title.GetProvince.MakeScope).ScriptValue('enemies_in_the_county'), '(CFixedPoint)0' )]"
				raw_text = "[GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('province', Title.GetProvince.MakeScope).ScriptValue('enemies_in_the_county')] enemies,"
			}

			text_single = {
				raw_text = "[Title.GetBaseNameNoTierNoTooltip], "
			}
			# text_single = {
			# 	raw_text = "[Scope.Title.Custom('county_direction')]."
			# }
			block "distance" {}

			container = {
				ignoreinvisible = yes
				block "county_distance" {
					visible = no
				}
				text_single = {
					datacontext = "[HoldingView.GetProvince]"
					visible = "[Not(ObjectsEqual(HoldingView.GetCountyTitle, Scope.Title))]"
					raw_text = "[DistanceTo(Province, Scope.Title.GetProvince)|0] [DaysTo(Province, Scope.Title.GetProvince)]"
				}
			}

			text_single = {
				block "prov_context" {
					datacontext = "[HoldingView.GetProvince]"
				}
				raw_text = "[GuiScope.SetRoot(Province.MakeScope).AddScope('second', Title.GetProvince.MakeScope).Custom('province_direction')],"
			}

			text_single = {
				visible = "[Title.GetProvince.HasActiveSiege]"
				raw_text = "Sieged,"
			}


			text_single = {
				raw_text = "your county,"
				visible = "[ObjectsEqual(Title.GetHolder, GetPlayer)]"
			}

			text_single = {
				visible = "[And(ObjectsEqual(Title.GetHolder.GetTopLiege, GetPlayer), Not(ObjectsEqual(Title.GetHolder, GetPlayer)))]"

				raw_text = "in your realm,"
			}

			flowcontainer = {
				ignoreinvisible = yes
				using = not_wasteland_locr
				datacontext = "[Title.GetHolder]"
				spacing = 3
				flowcontainer = {
					ignoreinvisible = yes
					visible = "[Not(Or(ObjectsEqual(Title.GetHolder.GetTopLiege, GetPlayer), ObjectsEqual(Title.GetHolder, GetPlayer)))]"
					spacing = 3
					text_single = {
						# visible = "[Not(ObjectsEqual(Title.GetHolder.GetTopLiege, Title.GetHolder))]"
						raw_text = "in"
					}
					# text_single = {
					# 	visible = "[ObjectsEqual(Title.GetHolder.GetTopLiege, Title.GetHolder)]"
					# 	raw_text = "of"
					# }

					text_single = {
						raw_text = "[Title.GetHolder.GetTopLiege.GetPrimaryTitle.GetNameNoTierNoTooltip],"
					}
				}

				text_single = {
					block "holder" {
						visible = "[Not(ObjectsEqual(Title.GetHolder, GetPlayer))]"
					}
					raw_text = "held by [Title.GetHolder.GetFirstNameNoTooltip] of [Title.GetHolder.GetPrimaryTitle.GetNameNoTierNoTooltip]."
				}

				text_single = {
					visible = "[Is('culture_counties')]"
					raw_text = "[Title.GetCountyData.GetFaith.GetAdjective], [Title.GetCountyData.GetCulture.GetName]."
				}
			}

			text_wasteland_locr = {}


			block "county_extra" { }
			# [Scope.Title.GetHolder.GetTopLiege.RealmSize] counties.
		}
		block "click" {
			# onclick = "[CloseGameView('holding_view')]"
			onclick = "[OpenGameViewData('holding_view', Scope.Title.GetProvince.Self)]"
			onclick = "[DefaultOnCoatOfArmsRightClick(Title.GetID)]"
			onclick = "[GetVariableSystem.ClearIf('county_tabs', Not(ShowAddFlag('sgui_flag', 'close_adjacencies')))]"
			onclick = "[PdxGuiTriggerAllAnimations('adjacent_counties')]"
			onrightclick = "[DefaultOnCoatOfArmsRightClick(Title.GetID)]"
		}
	}

	type building_in_vassal_warning_hbox = hbox
	{
		name = "vassal_warning"
		visible = "[Not( ObjectsEqual( HoldingView.GetHolder, GetPlayer ) )]"
		layoutpolicy_horizontal = expanding
		margin = { 5 0 }

		text_single = {
			text = "HOLDING_VIEW_BUILDING_IN_VASSAL"
			layoutpolicy_horizontal = expanding
		}
	}

	type county_task_button = button_text {
		layoutpolicy_horizontal = expanding
		datacontext = "[HoldingView.GetCountyTitle]"

		visible = "[ScriptedGui.IsShown( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('county', Title.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End )]"

		blockoverride "disabled" {
			visible = "[Not(ScriptedGui.IsValid( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('county', Title.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End ))]"
		}

		enabled = "[ScriptedGui.IsValid( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('county', Title.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End )]"

		tooltip = "[ScriptedGui.BuildTooltip( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('county', Title.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End )]"

		tooltip_visible = "[Not(ScriptedGui.IsValid( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('county', Title.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End ))]"

		onclick = "[ScriptedGui.Execute( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('county', Title.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End )]"
	}

	type court_task_button = button_text {
		layoutpolicy_horizontal = expanding

		visible = "[ScriptedGui.IsShown( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('target_character', HoldingView.GetCountyTitle.GetHolder.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End )]"

		blockoverride "disabled" {
			visible = "[Not(ScriptedGui.IsValid( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('target_character', HoldingView.GetCountyTitle.GetHolder.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End ))]"
		}

		enabled = "[ScriptedGui.IsValid( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('target_character', HoldingView.GetCountyTitle.GetHolder.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End )]"

		tooltip = "[ScriptedGui.BuildTooltip( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('target_character', HoldingView.GetCountyTitle.GetHolder.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End )]"

		tooltip_visible = "[Not(ScriptedGui.IsValid( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('target_character', HoldingView.GetCountyTitle.GetHolder.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End ))]"

		onclick = "[ScriptedGui.Execute( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('target_character', HoldingView.GetCountyTitle.GetHolder.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End )]"
	}

	type active_task_hbox = hbox {
		layoutpolicy_horizontal = expanding
		datacontext = "[HoldingView.GetCountyTitle]"
		datacontext = "[Character.GetActiveCouncilTask]"
		visible = "[ScriptedGui.IsShown( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('county', Title.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End )]"

		spacing = 3

		tooltipwidget = {
			council_task_progress_breakdown_widget = { }
		}

		text_single = {
			block "task" {
				raw_text = "Converting [Title.GetCountyData.GetFaith.GetAdjective] faith."
			}
		}

		text_single = {
			raw_text = "[ActiveCouncilTask.GetETA],"
		}

		text_single = {
			raw_text = "[ActiveCouncilTask.GetProgress|0]%."
			visible = "[ActiveCouncilTask.GetTaskType.IsPercentageTask]"
		}

		text_single = {
			raw_text = "[ActiveCouncilTask.GetProgress|0]%."
			visible = "[ActiveCouncilTask.GetTaskType.IsPercentageTask]"
		}

		text_single = {
			raw_text = "[Character.GetFirstNameNoTooltip],"
		}

		text_single = {
			block "skill" {
				raw_text = "[Character.GetSkill('learning')] learning."
			}
		}

		expand = { }
	}

	type active_court_task_hbox = hbox {
		layoutpolicy_horizontal = expanding
		datacontext = "[HoldingView.GetCountyTitle]"
		datacontext = "[Character.GetActiveCouncilTask]"
		visible = "[ScriptedGui.IsShown( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('county', Title.MakeScope ).AddScope('target_character', HoldingView.GetCountyTitle.GetHolder.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End )]"

		spacing = 3

		tooltipwidget = {
			council_task_progress_breakdown_widget = { }
		}

		text_single = {
			block "task" {
				raw_text = "Finding secrets in [HoldingView.GetCountyTitle.GetHolder.GetFirstNamePossessiveOrMyNoTooltip] court."
			}
		}

		text_single = {
			raw_text = "[ActiveCouncilTask.GetETA],"
		}

		text_single = {
			raw_text = "[ActiveCouncilTask.GetProgress|0]%."
		}

		text_single = {
			raw_text = "[Character.GetFirstNameNoTooltip],"
		}

		text_single = {
			block "skill" {
				raw_text = "[Character.GetSkill('learning')] intrigue."
			}
		}

		expand = { }
	}

	type button_holding = button_text {
		# Province is the origin
		# Scope.GetProvince is the button's province
		datacontext = "[Scope.GetProvince.GetHolding]"
		onclick = "[Scope.GetProvince.PanCameraTo]"
		onclick = "[GetVariableSystem.Clear('county_tabs')]"
		onclick = "[GetVariableSystem.Clear('extra_window')]"
		onclick = "[OpenGameViewData('holding_view', Scope.GetProvince)]"
		onrightclick = "[Scope.GetProvince.PanCameraTo]"
		blockoverride "text" {
			raw_text = "[Select_CString(Holding.IsEmpty, Scope.GetProvince.GetTerrain.GetNameNoTooltip, Holding.GetPrimaryBuildingType.GetTypeName)] of [Holding.GetNameNoTooltip],"
		}
		blockoverride "extra" {
			block "direction" {
				text_single = {
					raw_text = "[GuiScope.SetRoot(Province.MakeScope).AddScope('second', Scope.GetProvince.MakeScope).Custom('province_direction')],"
				}
			}
			block "distance" {
				text_single = {
					datacontext = "[Scope.GetProvince]"
					visible = "[Not(ObjectsEqual(HoldingView.GetProvince, Province.Self))]"
					raw_text = "[DistanceTo(HoldingView.GetProvince, Province)|0] [DaysTo(HoldingView.GetProvince, Province)] [Direction(HoldingView.GetProvince, Province)]"
				}
			}
			text_single = {
				datacontext = "[Scope.GetProvince.GetCounty.GetTitle.GetHolder.GetTopLiege]"
				visible = "[Not(ObjectsEqual(Character.Self, GetPlayer))]"
				raw_text = "in [Character.GetPrimaryTitle.GetNameNoTierNoTooltip]."
			}
			block "held_by" {
				text_single = {
					datacontext = "[Scope.GetProvince.GetCounty.GetTitle]"
					visible = "[Not(ObjectsEqual(Title.GetHolder, GetPlayer))]"
					raw_text = "held by [Title.GetHolder.GetFirstNameNoTooltip]."
				}
			}
			text_single = {
				datacontext = "[Scope.GetProvince.GetCounty.GetTitle.GetHolder.GetTopLiege]"
				visible = "[ObjectsEqual(Character.Self, GetPlayer)]"
				raw_text = "in your realm."
			}
		}
	}

	type button_shores = button_text {
		# onclick = "[GetVariableSystem.Set('county_tabs', 'adjacent counties')]"
		visible = "[Or(DataModelHasItems( Province.MakeScope.GetList('adjacent_seas') ), DataModelHasItems( Province.MakeScope.GetList('adjacent_rivers') ))]"
		blockoverride "text" {
			margin_left = -3
			raw_text = "on shores of"
		}
		blockoverride "extra" {
			flowcontainer = {
				ignoreinvisible = yes
				visible = "[DataModelHasItems(Province.MakeScope.GetList('adjacent_seas'))]"
				spacing = 3

				flowcontainer = {
					datamodel = "[DataModelFirst(Province.MakeScope.GetList('adjacent_seas'), '(int32)1')]"
					visible = "[EqualTo_int32(GetDataModelSize(Province.MakeScope.GetList('adjacent_seas')), '(int32)1')]"

					item = {
						flowcontainer = {
							spacing = 3
							text_single = {
								raw_text = "[Scope.GetProvince.GetName]"
							}
						}
					}
				}

				text_single = {
					visible = "[GreaterThan_int32(GetDataModelSize(Province.MakeScope.GetList('adjacent_seas')), '(int32)1')]"
					raw_text = "[GetDataModelSize(Province.MakeScope.GetList('adjacent_seas'))] seas"
				}

				text_single = {
					block "and" {
						visible = "[Or(DataModelHasItems(Province.MakeScope.GetList('adjacent_counties')), DataModelHasItems(Province.MakeScope.GetList('adjacent_rivers')))]"
					}
					raw_text = "and"
				}
			}

			flowcontainer = {
				ignoreinvisible = yes
				visible = "[DataModelHasItems(Province.MakeScope.GetList('adjacent_rivers'))]"
				spacing = 3

				flowcontainer = {
					datamodel = "[DataModelFirst(Province.MakeScope.GetList('adjacent_rivers'), '(int32)1')]"
					visible = "[EqualTo_int32(GetDataModelSize(Province.MakeScope.GetList('adjacent_rivers')), '(int32)1')]"

					item = {
						flowcontainer = {
							spacing = 3
							text_single = {
								raw_text = "[Scope.GetProvince.GetName]"
							}
						}
					}
				}

				text_single = {
					visible = "[EqualTo_int32(GetDataModelSize(Province.MakeScope.GetList('adjacent_rivers')), '(int32)1')]"
					raw_text = "river"
				}

				text_single = {
					visible = "[GreaterThan_int32(GetDataModelSize(Province.MakeScope.GetList('adjacent_rivers')), '(int32)1')]"
					raw_text = "[GetDataModelSize(Province.MakeScope.GetList('adjacent_rivers'))] rivers"
				}

			}
			dot_l = { }
		}
	}
}

types CountyViewTypes
{
	type widget_building_item = widget {
		size = { 55 55 }
		enabled = "[GUIBuildingItem.IsBuildingButtonEnabled]"
		tooltip = "[GUIBuildingItem.GetTooltip]"
		using = tooltip_ne

		button_standard = {
			name = "building_button"
			size = { 100% 100% }
			onclick = "[GUIBuildingItem.OnClick]"
			down = "[GUIBuildingItem.IsHighlighted]"

			button_icon = {
				name = "build_new_icon"
				visible = "[And(And(GUIBuildingItem.IsBuildNewIconShown, GUIBuildingItem.IsBuildingButtonEnabled), Not(GUIBuildingItem.HasLevel))]"
				parentanchor = center
				size = { 28 28 }
				alpha = 0.7
				texture = "gfx/interface/icons/flat_icons/plus.dds"
				alwaystransparent = yes
			}

			icon_building = {
				name = "building_icon"
				visible = "[Not( GUIBuildingItem.CanUpgrade )]"
				parentanchor = center
				size = { 45 40 }
				texture = "[GUIBuildingItem.GetCurrentOrConstrucingBuilding.GetTypeIcon]"
			}

			highlight_icon_building = {
				name = "building_icon_can_upgrade"
				visible = "[GUIBuildingItem.CanUpgrade]"
				parentanchor = center
				size = { 45 40 }
				texture = "[GUIBuildingItem.GetCurrentOrConstrucingBuilding.GetTypeIcon]"
			}

			text_single= {
				visible = "[And( GUIBuildingItem.HasLevel, Not( GUIBuildingItem.IsConstructing ) ) ]"
				text = "[GUIBuildingItem.GetCurrentOrConstrucingBuilding.GetLevel]"
				parentanchor = bottom|right
				position = { -6 -2 }
				fontsize = 15
				default_format = "#low;bold"
				align = nobaseline

				background = {
					using = Background_Area_ExtraDark
					margin = { 5 0 }
				}
			}

			warning_icon = {
				name = "reduced_by_fixable_situation"
				visible = "[GUIBuildingItem.IsBuildingDisabled]"
				position = { 3 3 }
				size = { 20 20 }

			}
		}

		icon = {
			name = "building_slot"
			size = { 100% 100% }
			using = Background_Area
			visible = "[GUIBuildingItem.IsBuildingSlotShown]"
		}

		flowcontainer = {
			visible = "[And( GUIBuildingItem.HasLevel, GUIBuildingItem.IsConstructing ) ]"
			parentanchor = bottom|hcenter
			position = { 0 -3 }
			direction = vertical
			ignoreinvisible = yes

			widget = {
				size = { 15 15 }
				parentanchor = right

				text_single= {
					visible = "[GUIBuildingItem.HasLevel]"
					parentanchor = center
					position = { -1 0 }

					text = "[GUIBuildingItem.GetCurrentOrConstrucingBuilding.GetLevel]"
					fontsize = 15
					default_format = "#low;bold"
					align = nobaseline

					background = {
						using = Background_Area_ExtraDark
						margin = { 5 0 }
					}
				}
			}

			progressbar_standard = {
				name = "construct_progressbar"
				visible = "[GUIBuildingItem.IsConstructing]"
				parentanchor = hcenter
				alwaystransparent = yes
				size = { 51 10 }
				value = "[GUIBuildingItem.GetConstructingProgress]"
				direction = horizontal
			}
		}
	}

	type building_in_vassal_warning_hbox = hbox
	{
		name = "vassal_warning"
		visible = "[Not( ObjectsEqual( HoldingView.GetHolder, GetPlayer ) )]"

		coa_title_tiny = {
			datacontext = "[HoldingView.GetHolder.GetPrimaryTitle]"
		}

		text_multi = {
			autoresize = yes
			text = "HOLDING_VIEW_BUILDING_IN_VASSAL"
		}
	}

	# Requires County and CountyDataBreakdowns data context
	type county_control_tooltip_container = container
	{
		using = GeneralTooltipSetup
		alwaystransparent = no

		object_tooltip_pop_out = {
			blockoverride "title_text"
			{
				margin = { 0 8 }
				text = "COUNTY_CONTROL_TOOLTIP_HEADER"
				default_format = "#T"
			}

			blockoverride "concept_link"
			{
				visible = no
			}

			blockoverride "main_description"
			{
				vbox = {
					layoutpolicy_horizontal = expanding

					cooltip_paragraph = {
						text = "[County.GetCountyControlEffectsDesc]"
					}

					spacer = {
						size = { 0 15 }
					}

					cooltip_paragraph = {
						datacontext = "[CountyDataBreakdowns.AccessControl( County.Self )]"

						text = "VALUE_BREAKDOWN_TEXT_LINK"

						tooltip_visible = "[ValueBreakdown.HasTooltip]"

						tooltipwidget = {
							widget_value_breakdown_tooltip = {}
						}
					}
				}
			}
		}
	}

	# Requires County and CountyDataBreakdowns data context
	type county_development_tooltip_container = container
	{
		using = GeneralTooltipSetup
		alwaystransparent = no

		object_tooltip_pop_out = {
			blockoverride "title_text"
			{
				margin = { 0 8 }
				text = "COUNTY_DEVELOPMENT_TOOLTIP_HEADER"
				default_format = "#T"
			}

			blockoverride "concept_link"
			{
				visible = no
			}

			blockoverride "main_description"
			{
				vbox = {
					layoutpolicy_horizontal = expanding

					datacontext = "[County.GetCount]"
					datacontext = "[Character.GetGovernment]"

					cooltip_paragraph = {
						visible = "[Not( GovernmentType.IsAffectedByDevelopment )]"
						text = "COUNTY_DEVELOPMENT_IGNORED_DESC"
					}

					cooltip_paragraph = {
						text = "[County.GetCountyDevelopmentEffectsDesc]"
					}

					spacer = {
						size = { 0 15 }
					}

					cooltip_paragraph = {
						text = "[County.GetDevelopmentProgressOutOfMax]"
					}

					cooltip_paragraph = {
						datacontext = "[CountyDataBreakdowns.AccessDevelopmentChange( County.Self )]"

						text = "VALUE_BREAKDOWN_TEXT_LINK"

						tooltip_visible = "[ValueBreakdown.HasTooltip]"

						tooltipwidget = {
							widget_value_breakdown_tooltip = {}
						}
					}
				}
			}
		}
	}

	# Requires County and CountyDataBreakdowns data context
	type county_fertility_tooltip_container = container
	{
		using = GeneralTooltipSetup
		alwaystransparent = no

		object_tooltip_pop_out = {
			blockoverride "title_text"
			{
				margin = { 0 8 }
				text = "COUNTY_FERTILITY_TOOLTIP_HEADER"
				default_format = "#T"
			}

			blockoverride "concept_link"
			{
				visible = no
			}

			blockoverride "main_description"
			{
				vbox = {
					layoutpolicy_horizontal = expanding

					cooltip_paragraph = {
						text = "PROJECTED_COUNTY_FERTILITY_EQUILIBRIUM"
					}

					cooltip_paragraph = {
						datacontext = "[CountyDataBreakdowns.AccessFertilityChange( County.Self )]"
						datacontext = "[HoldingView.AccessCountyBreakdowns]"

						text = "VALUE_BREAKDOWN_TEXT_LINK"

						tooltip_visible = "[ValueBreakdown.HasTooltip]"
						using = tooltip_se

						tooltipwidget = {
							widget_value_breakdown_tooltip = {}
						}
					}
				}
			}
		}
	}
}


types CountyViewTypes
{
	type button_select_building_ocr = button_text {
		layoutpolicy_horizontal = expanding
		tooltip = "[GUIPotentialBuildingItem.GetTooltip]"
		block "click" {
		}
		blockoverride "num" {

		}
		shortcuts_list = {
		}

		blockoverride "extra" {

			text_single = {
				margin_left = -3
				raw_text = "[GUIPotentialBuildingItem.GetBuilding.GetTypeName]."
			}

			text_single = {
				visible = "[Not(GUIPotentialBuildingItem.CanConstruct)]"
				raw_text = "Disabled,"
			}


			flowcontainer = {
				ignoreinvisible = yes
				spacing = 3
				text_single = {
					raw_text = "Costs"
				}

				flowcontainer = {
					ignoreinvisible = yes
					margin_bottom = 1

					flowcontainer = {
						ignoreinvisible = yes
						spacing = 3
						datacontext = "[GUIPotentialBuildingItem.GetGoldCost]"
						visible = "[GUIPotentialBuildingItem.HasGoldCost]"

						text_single = {
							# layoutpolicy_horizontal = expanding
							raw_text = "[ValueBreakdown.GetValue],"
							tooltip_visible = "[ValueBreakdown.HasTooltip]"

							tooltipwidget = {
								widget_value_breakdown_tooltip = { }
							}
						}

						text_single = {
							visible = "[LessThan_CFixedPoint(GetPlayer.GetGold, ValueBreakdown.GetFixedPointValue)]"
							raw_text = "need [Subtract_CFixedPoint(ValueBreakdown.GetFixedPointValue, GetPlayer.GetGold)|0] more."
						}
					}

					flowcontainer = {
						ignoreinvisible = yes
						spacing = 3
						datacontext = "[GUIPotentialBuildingItem.GetPrestigeCost]"
						visible = "[GUIPotentialBuildingItem.HasPrestigeCost]"

						text_single = {
							raw_text = "[ValueBreakdown.GetValue],"
							tooltip_visible = "[ValueBreakdown.HasTooltip]"

							tooltipwidget = {
								widget_value_breakdown_tooltip = { }
							}
						}

						text_single = {
							visible = "[LessThan_CFixedPoint(GetPlayer.GetPrestige, ValueBreakdown.GetFixedPointValue)]"
							raw_text = "need [Subtract_CFixedPoint(ValueBreakdown.GetFixedPointValue, GetPlayer.GetPrestige)|0] more."
						}

					}

					flowcontainer = {
						ignoreinvisible = yes
						datacontext = "[GUIPotentialBuildingItem.GetPietyCost]"
						visible = "[GUIPotentialBuildingItem.HasPietyCost]"
						spacing = 3

						text_single = {
							raw_text = "[ValueBreakdown.GetValue],"
							tooltip_visible = "[ValueBreakdown.HasTooltip]"

							tooltipwidget = {
								widget_value_breakdown_tooltip = { }
							}
						}

						text_single = {
							visible = "[LessThan_CFixedPoint(GetPlayer.GetPiety, ValueBreakdown.GetFixedPointValue)]"
							raw_text = "need [Subtract_CFixedPoint(ValueBreakdown.GetFixedPointValue, GetPlayer.GetPiety)|0] more."
						}
					}
				}

				text_single = {
					datacontext = "[GUIPotentialBuildingItem.GetConstructionTime]"
					raw_text = "will take [ValueBreakdown.GetValue]."
					tooltip_visible = "[ValueBreakdown.HasTooltip]"

					tooltipwidget = {
						widget_value_breakdown_tooltip = { }
					}
				}
			}

			text_single = {
				block "preview" {}
			}
		}
	}

	type flow_crossing_ocr = flowcontainer {
		ignoreinvisible = yes
		direction = vertical
		name = "list"

		item = {
			button_text = {
				datacontext = "[Scope.GetProvince.GetHolding]"
				blockoverride "pre" {
					flowcontainer = {
						ignoreinvisible = yes
						spacing = 3
						visible = "[IsIndexFirst]"

						text_single = {
							raw_text = "Has"
						}

						text_single = {
							visible = "[EqualTo_int32(PdxGuiWidget.AccessParent.AccessParent.AccessParent.AccessParent.CountVisibleChildren, '(int32)1')]"
							raw_text = "a"
						}

						text_single = {
							visible = "[GreaterThan_int32(PdxGuiWidget.AccessParent.AccessParent.AccessParent.AccessParent.CountVisibleChildren, '(int32)1')]"
							raw_text = "[PdxGuiWidget.AccessParent.AccessParent.AccessParent.AccessParent.CountVisibleChildren]"
						}

						text_single = {
							block "bridge" {
								raw_text = "bridge"
							}
						}

						text_single = {
							margin_left = -3
							raw_text = "[AddTextIf(GreaterThan_int32(PdxGuiWidget.AccessParent.AccessParent.AccessParent.AccessParent.CountVisibleChildren, '(int32)1'), 's, one')] to"
						}
					}

					text_single = {
						visible = "[Not(IsIndexFirst)]"
						raw_text = "and to"
					}
				}
				blockoverride "extra" {
					# text_single = {
					# 	raw_text = "[Scope.GetProvince.GetCounty.GetName] county,"
					# }
					text_single = {
						margin_left = -3
						raw_text = "the [Direction(Province, Scope.GetProvince)],"
					}

					text_single = {
						raw_text = "[AddTextIf(Not(Holding.IsEmpty), Concatenate(Holding.GetPrimaryBuildingType.GetTypeName, ' of '))][Holding.GetNameNoTooltip],"
					}

					text_single = {
						visible = "[ObjectsEqual(Scope.GetProvince.GetCounty.GetCount.GetTopLiege, Province.GetCounty.GetCount.GetTopLiege)]"
						raw_text = "same realm."
					}
					text_single = {
						visible = "[Not(ObjectsEqual(Scope.GetProvince.GetCounty.GetCount.GetTopLiege, Province.GetCounty.GetCount.GetTopLiege))]"
						raw_text = "in [Scope.GetProvince.GetCounty.GetCount.GetTopLiege.GetPrimaryTitle.GetNameNoTooltip]."
					}
				}
				onclick = "[OpenGameViewData('holding_view', Scope.GetProvince)]"
				onclick = "[DefaultOnCoatOfArmsRightClick(Scope.GetProvince.GetTitle.GetID)]"
				onclick = "[PdxGuiTriggerAllAnimations('adjacent_counties')]"
			}
		}
	}
}
